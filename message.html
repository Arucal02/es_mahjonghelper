<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç«™å†…ç•™è¨€åŒº - ESéº»å°†å½¹ç§æŸ¥è¯¢åŠ©æ‰‹</title>
    <!-- Tailwind CSS v3 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <!-- Vis.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css">
    <!-- Valineè¯„è®ºç³»ç»Ÿ -->
    <script src="//unpkg.com/valine/dist/Valine.min.js"></script>

    <!-- å¼•å…¥æ•°æ®æ–‡ä»¶ -->
    <script src="../main/data.js"></script>
    
    <style>
        /* Valineè¯„è®ºåŒºæ ·å¼åŒ¹é…åŸæœ‰ç•Œé¢é£æ ¼ */
        #valine-yaku-select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            margin-bottom: 10px;
            font-size: 14px;
        }
        
        #valine-yaku-comments, #valine-admin-comments {
            margin-top: 20px;
        }
        
        .vcomment-item {
            transition: all 0.3s ease;
        }
        
        .vcomment-item:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        /* Valineè¾“å…¥æ¡†æ ·å¼åŒ¹é… */
        .vinput-group {
            margin: 10px 0;
        }
        
        .vinput-group input, .vinput-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 14px;
        }
        
        .vinput-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        /* Valineå ä½ç¬¦æ ·å¼ */
        .vplaceholder {
            color: #999;
            font-size: 14px;
        }
        
        /* Valineæäº¤æŒ‰é’®æ ·å¼ */
        .vsubmit {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .vsubmit:hover {
            background-color: #45a049;
        }
        
        /* Valineè¯„è®ºç»Ÿè®¡æ ·å¼ */
        .vc-count {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }
        
        /* Valineåˆ†é¡µæ ·å¼ */
        .vpage {
            text-align: center;
            margin-top: 20px;
        }
        
        /* è¯„è®ºè¾“å…¥åŒºæ ·å¼ */
        .comment-input-area {
            transition: all 0.3s ease;
        }
        
        .comment-input-area:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        /* å·²ç•™è¨€å±•ç¤ºåŒºæ ·å¼ */
        .comment-list-area {
            transition: all 0.3s ease;
        }
        
        .comment-list-area:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        /* Valineåˆ†é¡µæ ·å¼ */
        .vpage a {
            display: inline-block;
            padding: 5px 10px;
            margin: 0 2px;
            border: 1px solid #ddd;
            border-radius: 4px;
            color: #333;
            text-decoration: none;
        }
        
        .vpage a:hover {
            background-color: #f0f0f0;
        }
        
        .vpage .active {
            background-color: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }
    </style>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#7e22ce', // ç´«è‰²
                        secondary: '#3b82f6', // è“è‰²
                        success: '#16a34a', // ç»¿è‰²
                        danger: '#dc2626', // çº¢è‰²
                        neutral: '#64748b', // ç°è‰²
                        dark: '#1e293b',
                        light: '#f8fafc'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-up': 'slideUp 0.5s ease-in-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .scrollbar-hide::-webkit-scrollbar {
                display: none;
            }
            .scrollbar-hide {
                -ms-overflow-style: none;
                scrollbar-width: none;
            }
            .card-hover {
                transition: all 0.3s ease;
            }
            .card-hover:hover {
                transform: translateY(-5px);
                box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            }
            .yaku-select {
                width: 100%;
                padding: 0.5rem 1rem;
                background-color: rgba(255, 255, 255, 0.8);
                border: 1px solid #d1d5db;
                border-radius: 0.5rem;
                outline: none;
                transition: all 0.2s ease;
            }
            .yaku-select:focus {
                border-color: #6b7280;
                box-shadow: 0 0 0 2px rgba(107, 114, 128, 0.5);
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-5xl">
        <!-- æ ‡é¢˜åŒºåŸŸ -->
        <header class="mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">ç«™å†…ç•™è¨€åŒº</h1>
            <p class="text-gray-600">åˆ†äº«ESäººé™…å…³ç³»ï¼Œä¹Ÿå¯å‘ç«™é•¿æå‡ºåŠŸèƒ½å»ºè®®</p>
            
            <!-- é¡µé¢ç´¢å¼•å®šä½ -->
            <nav class="mt-4 bg-white rounded-lg shadow-sm p-5">
                <h2 class="font-medium text-gray-700 mb-3">é¡µé¢å¯¼èˆª</h2>
                <ul class="flex flex-wrap gap-6">
                    <li>
                        <a href="#yaku-comment-section" class="text-primary hover:text-primary/80 transition-colors flex items-center">
                            <i class="fa fa-comment mr-1"></i>
                            ESäººé™…å…³ç³»è¯„è®º
                        </a>
                    </li>
                    <li>
                        <a href="#relationship-network" class="text-primary hover:text-primary/80 transition-colors flex items-center">
                            <i class="fa fa-sitemap mr-1"></i>
                            å½¹ç§äººé™…å…³ç³»ç½‘
                        </a>
                    </li>
                    <li>
                        <a href="#valine-admin-comments" class="text-primary hover:text-primary/80 transition-colors flex items-center">
                            <i class="fa fa-edit mr-1"></i>
                            ç»™ç«™é•¿ç•™è¨€
                        </a>
                    </li>
                </ul>
            </nav>
        </header>
        
        <!-- ç•™è¨€æ³¨æ„äº‹é¡¹å…¬å‘Šæ  -->
        <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-8 rounded-r-lg shadow-sm">
            <div class="flex items-center">
                <i class="fa fa-exclamation-triangle text-yellow-400 mr-3 text-xl"></i>
                <div>
                    <h3 class="font-medium text-yellow-800 text-lg">ç•™è¨€æ³¨æ„äº‹é¡¹</h3>
                    <div class="text-yellow-700 mt-1 text-sm">
                        <p>ğŸ˜‹ ç•™è¨€åŠŸèƒ½æ—¨åœ¨æ±‡æ€»å¤§å®¶åƒè¿‡çš„é¦™é¦™é¥­ï¼Œå¸®åŠ©èŒæ–°å¿«é€Ÿäº†è§£æŸä¸€å°å¶åƒ/ç»„åˆ/å›¢ä½“ï¼Œæ¬¢è¿å„ä½å¤§å¨å‰æ¥åšé¥­ğŸ‘©â€ğŸ³ã€‚</p>
                        <p class="mt-1">â” ç¦æ­¢åœ¨ç•™è¨€åŒºå†…ç•™ä¸‹ä¸å‹å–„ã€å¼•æˆ˜ã€ESæ— å…³ã€æ¶‰åŠäººèº«æ”»å‡»ç­‰ä¸€ç³»åˆ—å‘è¨€ï¼Œå¦‚ç»å‘ç°ä¼šè¿›è¡Œåˆ é™¤å¤„ç†ã€‚</p>
                        <p class="mt-1">â” è¯·éµå®ˆç¤¾åŒºè§„èŒƒï¼Œå…±åŒç»´æŠ¤è‰¯å¥½çš„äº¤æµç¯å¢ƒã€‚</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- è¿”å›æŒ‰é’® -->
        <div class="mb-8">
            <a href="index.html" class="bg-primary hover:bg-primary/90 text-white font-medium px-6 py-2 rounded-lg transition-all flex items-center">
                <i class="fa fa-arrow-left mr-2"></i>
                è¿”å›é¦–é¡µ
            </a>
        </div>
        

        
        <!-- ESäººé™…å…³ç³»è¯„è®º -->
        <div id="yaku-comment-section" class="bg-white rounded-xl shadow-md p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <i class="fa fa-comment mr-3 text-primary"></i>
                ESäººé™…å…³ç³»è¯„è®º
            </h2>
            
            <p class="mb-4 text-gray-600">é€‰æ‹©å½¹ç§åå±•å¼€è¯„è®ºåŒºï¼›é‚®ç®±ä¸ºéå¿…å¡«ï¼Œè‹¥å¡«å†™ä¼šç”Ÿæˆé‚®ç®±å¯¹åº”å¤´åƒï¼Œä¸”å½“è¯„è®ºè¢«å›å¤æ—¶ä¼šå‘è¯¥é‚®ç®±å‘é€æé†’</p>
            
            <div class="mb-6">
                <label for="valine-yaku-select" class="block text-gray-700 font-medium mb-2">é€‰æ‹©å½¹ç§</label>
                <select id="valine-yaku-select" class="yaku-select" onchange="switchYakuComment()">
                    <option value="">è¯·é€‰æ‹©å½¹ç§</option>
                    <!-- è¿™é‡Œä¼šé€šè¿‡JavaScriptåŠ¨æ€åŠ è½½å½¹ç§åˆ—è¡¨ -->
                </select>
            </div>
            
            <!-- è¯„è®ºè¾“å…¥åŒº - é»˜è®¤éšè— -->
            <div class="comment-input-area bg-gray-50 p-6 rounded-lg mb-6 border border-gray-200" style="display: none;">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">å‘è¡¨è¯„è®º</h3>
                <div id="valine-input"></div>
            </div>
            
            <!-- å·²ç•™è¨€å±•ç¤ºåŒº - é»˜è®¤éšè— -->
            <div class="comment-list-area bg-gray-50 p-6 rounded-lg border border-gray-200" style="display: none;">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">æœ€æ–°ç•™è¨€</h3>
                <div id="valine-list"></div>
            </div>
        </div>
        
        <!-- å½¹ç§äººé™…å…³ç³»ç½‘ -->
        <div id="relationship-network" class="bg-white rounded-xl shadow-md p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <i class="fa fa-sitemap mr-3 text-primary"></i>
                å½¹ç§äººé™…å…³ç³»ç½‘
            </h2>
            
            <!-- äººå‘˜é€‰æ‹© -->
            <div class="mb-6">
                <label for="person-select" class="block text-gray-700 font-medium mb-2">é€‰æ‹©äººå‘˜æŸ¥çœ‹ä»–çš„äººé™…å…³ç³»</label>
                <select id="person-select" class="yaku-select">
                    <option value="">è¯·é€‰æ‹©äººå‘˜</option>
                    <!-- è¿™é‡Œä¼šé€šè¿‡JavaScriptåŠ¨æ€åŠ è½½äººå‘˜åˆ—è¡¨ -->
                </select>
            </div>
            
            <!-- è„‘å›¾å®¹å™¨ -->
            <div id="network" class="w-full h-[600px] border border-gray-200 rounded-lg overflow-hidden"></div>
        </div>
        
        <!-- ç»™ç«™é•¿ç•™è¨€åŒº -->
        <div id="admin-message-section" class="bg-white rounded-xl shadow-md p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <i class="fa fa-edit mr-3 text-primary"></i>
                ç»™ç«™é•¿ç•™è¨€
            </h2>
            
            <div id="valine-admin-comments">
                <!-- Valineè¯„è®ºåŒºå°†åœ¨è¿™é‡Œåˆå§‹åŒ– -->
            </div>
        </div>
        

    </div>
    
    <!-- é¡µè„š -->
    <footer class="bg-white py-4 px-4 border-t border-gray-200">
        <div class="container mx-auto max-w-5xl text-center text-gray-600 text-sm">
            <p>ESéº»å°†å½¹ç§æŸ¥è¯¢åŠ©æ‰‹ Â© 2025</p>
            <p>æƒ³ä¸€èµ·å‚ä¸åˆ°ç«™å†…å»ºè®¾å¯è”ç³»ï¼šaruai@foxmail.com</p>
        </div>
    </footer>
    
    <script>
        

        



        
        // æ¸²æŸ“ç•™è¨€åˆ—è¡¨åŠŸèƒ½å·²è¢«Valineè¯„è®ºç³»ç»Ÿæ›¿æ¢
        

        
        // å…¨å±€å˜é‡
        let network, allPersons = [];
        
        // Valineè¯„è®ºç³»ç»Ÿåˆå§‹åŒ–
        let currentValine = null;
        
        // åˆå§‹åŒ–å½¹ç§è¯„è®ºåŒº
        function initValine(yakuName) {
            if (currentValine) {
                currentValine.destroy();
            }
            
            // æ¸…ç©ºåŸæœ‰å†…å®¹
            document.getElementById('valine-input').innerHTML = '';
            document.getElementById('valine-list').innerHTML = '';
            
            // åˆå§‹åŒ–æ–°çš„Valineå®ä¾‹ï¼Œæ‹†åˆ†è¾“å…¥å’Œåˆ—è¡¨
            currentValine = new Valine({
                el: '#valine-input', // è¾“å…¥æ¡†æ¸²æŸ“åˆ°è¿™ä¸ªå®¹å™¨
                listEl: '#valine-list', // è¯„è®ºåˆ—è¡¨æ¸²æŸ“åˆ°è¿™ä¸ªå®¹å™¨
                appId: 'YOUR_LEAN_CLOUD_APP_ID',
                appKey: 'YOUR_LEAN_CLOUD_APP_KEY',
                placeholder: `è¯·è¾“å…¥å¯¹ã€Œ${yakuName}ã€çš„çœ‹æ³•...`,
                path: `/yaku/${yakuName}`, // æŒ‰å½¹ç§åŒºåˆ†è¯„è®º
                recordIP: true,
                visitor: true,
                avatar: 'mm',
                meta: ['nick', 'mail', 'link'],
                requiredFields: ['nick'],
                lang: 'zh-CN'
            });
        }
        
        // åˆ‡æ¢å½¹ç§è¯„è®º
        function switchYakuComment() {
            const yakuSelect = document.getElementById('valine-yaku-select');
            const selectedYaku = yakuSelect.value;
            
            if (selectedYaku) {
                // æ˜¾ç¤ºè¯„è®ºè¾“å…¥åŒºå’Œå·²ç•™è¨€å±•ç¤ºåŒº
                document.querySelector('.comment-input-area').style.display = 'block';
                document.querySelector('.comment-list-area').style.display = 'block';
                
                // åˆå§‹åŒ–Valineè¯„è®ºåŒº
                initValine(selectedYaku);
            } else {
                // éšè—è¯„è®ºè¾“å…¥åŒºå’Œå·²ç•™è¨€å±•ç¤ºåŒº
                document.querySelector('.comment-input-area').style.display = 'none';
                document.querySelector('.comment-list-area').style.display = 'none';
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.onload = function() {
            // åˆå§‹åŒ–å½¹ç§è¯„è®ºåŒº
            const yakuSelect = document.getElementById('valine-yaku-select');
            if (yakuSelect && yakuSelect.value) {
                // æ˜¾ç¤ºè¯„è®ºè¾“å…¥åŒºå’Œå·²ç•™è¨€å±•ç¤ºåŒº
                document.querySelector('.comment-input-area').style.display = 'block';
                document.querySelector('.comment-list-area').style.display = 'block';
                
                initValine(yakuSelect.value);
            }
        };
        
        // ç»™ç«™é•¿ç•™è¨€åŒºValineåˆå§‹åŒ–
        const valineAdmin = new Valine({
            el: '#valine-admin-comments',
            appId: 'YOUR_LEAN_CLOUD_APP_ID',
            appKey: 'YOUR_LEAN_CLOUD_APP_KEY',
            placeholder: 'ç•™ä¸‹ä½ å¯¹ç½‘ç«™çš„å»ºè®®æˆ–åé¦ˆ...',
            path: '/message.html?admin',
            recordIP: true,
            visitor: true,
            avatar: 'mm',
            meta: ['nick', 'mail', 'link'],
            requiredFields: ['nick'],
            lang: 'zh-CN'
        });
        
        // äº‹ä»¶ç›‘å¬ - åˆå¹¶æ‰€æœ‰åˆå§‹åŒ–ä»£ç åˆ°ä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨
        document.addEventListener('DOMContentLoaded', function() {
            console.log('é¡µé¢DOMåŠ è½½å®Œæˆ');
            console.log('esMahjongDataæ˜¯å¦å­˜åœ¨:', typeof esMahjongData !== 'undefined');
            console.log('esMahjongDataé•¿åº¦:', esMahjongData ? esMahjongData.length : 0);
            
            // åŠ è½½å½¹ç§åˆ—è¡¨å’Œäººå‘˜åˆ—è¡¨
            loadYakuList();
            loadPersonList();
            
            // äººå‘˜é€‰æ‹©å˜åŒ–æ—¶æ¸²æŸ“è„‘å›¾
            const personSelect = document.getElementById('person-select');
            if (personSelect) {
                personSelect.addEventListener('change', function() {
                    const person = this.value;
                    if (person) {
                        renderNetwork(person);
                    } else {
                        const container = document.getElementById('network');
                        container.innerHTML = '<p class="text-gray-500 text-center py-16">è¯·é€‰æ‹©äººå‘˜æŸ¥çœ‹äººé™…å…³ç³»è„‘å›¾</p>';
                        if (network) {
                            network.destroy();
                            network = null;
                        }
                    }
                });
            }
        });
        
        // åŠ è½½æ‰€æœ‰å½¹ç§
        function loadYakuList() {
            console.log('loadYakuListè¢«è°ƒç”¨');
            const select = document.getElementById('valine-yaku-select');
            console.log('valine-yaku-select:', select);
            if (!select) return;
            
            // ä»esMahjongDataä¸­æå–æ‰€æœ‰å”¯ä¸€å½¹ç§åç§°
            const yakuSet = new Set();
            
            esMahjongData.forEach(yaku => {
                if (yaku.name && yaku.name.trim() !== '') {
                    yakuSet.add(yaku.name);
                }
            });
            
            const yakuList = Array.from(yakuSet).sort();
            console.log('yakuList:', yakuList);
            
            // å¡«å……å½¹ç§é€‰æ‹©ä¸‹æ‹‰æ¡†
            select.innerHTML = '<option value="">è¯·é€‰æ‹©å½¹ç§</option>';
            yakuList.forEach(yaku => {
                const option = document.createElement('option');
                option.value = yaku;
                option.textContent = yaku;
                select.appendChild(option);
            });
            console.log('loadYakuListæ‰§è¡Œå®Œæˆ');
        }
        
        // åŠ è½½æ‰€æœ‰äººå‘˜
        function loadPersonList() {
            console.log('loadPersonListè¢«è°ƒç”¨');
            const select = document.getElementById('person-select');
            console.log('person-select:', select);
            if (!select) return;
            
            // ä»esMahjongDataä¸­æå–æ‰€æœ‰å”¯ä¸€äººå‘˜ï¼Œè¿‡æ»¤æ‰äº‹åŠ¡æ‰€å’Œå›¢ä½“
            const personSet = new Set();
            const officeGroupNames = new Set(['STAR PRO', 'NEW DIMENSION', 'COSMIC PRODUCTION', 'COS PRO', 'NEW DI', 'Rhythm Link', 'Rhythm Linkï¼ˆæå­æ—ï¼‰', 'fine', 'Trickstar', 'æµæ˜Ÿé˜Ÿ', 'ALKALOID', 'UNDEAD', 'Undead', 'Knights', 'knights', 'Valkyrie', '2wink', 'Switch', 'switch', 'MaM', 'mam', 'MAM', 'Crazy:B', 'Eden', 'DoubleFace', 'Ra*bits', 'Special for Princess!ï¼ˆSpriï¼‰']);
            
            esMahjongData.forEach(yaku => {
                // æ£€æŸ¥yaku.membersæ˜¯å¦å­˜åœ¨ä¸”æ˜¯æ•°ç»„
                if (yaku.members && Array.isArray(yaku.members)) {
                    yaku.members.forEach(member => {
                        // è¿‡æ»¤æ‰ç©ºæˆå‘˜ã€å ä½ç¬¦ä»¥åŠäº‹åŠ¡æ‰€å’Œå›¢ä½“åç§°
                        if (member && member !== '-' && member.trim() !== '' && !officeGroupNames.has(member)) {
                            personSet.add(member);
                        }
                    });
                }
            });
            
            allPersons = Array.from(personSet).sort();
            console.log('allPersons:', allPersons);
            
            // å¡«å……äººå‘˜é€‰æ‹©ä¸‹æ‹‰æ¡†
            select.innerHTML = '<option value="">è¯·é€‰æ‹©äººå‘˜</option>';
            allPersons.forEach(person => {
                const option = document.createElement('option');
                option.value = person;
                option.textContent = person;
                select.appendChild(option);
            });
            console.log('loadPersonListæ‰§è¡Œå®Œæˆ');
        }
        
        // ç”Ÿæˆè„‘å›¾æ•°æ®
        function generateNetworkData(selectedPerson) {
            if (!selectedPerson) return { nodes: [], edges: [] };
            
            // åˆ†ç±»é¢œè‰²æ˜ å°„ - ä½¿ç”¨æ›´ç¾è§‚çš„é…è‰²æ–¹æ¡ˆ
            const categoryColors = {
                'è¿½å¿†æ ¡å›­': '#FF6B6B',
                'æ´—ç‰Œ': '#4ECDC4',
                'å…„å¼Ÿ': '#45B7D1',
                'é˜Ÿé•¿': '#96CEB4',
                'äº‹åŠ¡æ‰€ä»£è¡¨': '#FFEAA7',
                'å®¿èˆ': '#DDA0DD',
                'å…¶ä»–': '#98D8C8'
            };
            
            // å®šä¹‰éœ€è¦è¿‡æ»¤çš„äº‹åŠ¡æ‰€å’Œå›¢ä½“åç§°
            const officeGroupNames = new Set(['STAR PRO', 'NEW DIMENSION', 'COSMIC PRODUCTION', 'COS PRO', 'NEW DI', 'Rhythm Link', 'Rhythm Linkï¼ˆæå­æ—ï¼‰', 'fine', 'Trickstar', 'æµæ˜Ÿé˜Ÿ', 'ALKALOID', 'UNDEAD', 'Undead', 'Knights', 'knights', 'Valkyrie', '2wink', 'Switch', 'switch', 'MaM', 'mam', 'MAM', 'Crazy:B', 'Eden', 'DoubleFace', 'Ra*bits', 'Special for Princess!ï¼ˆSpriï¼‰']);
            
            const nodes = [];
            const edges = [];
            const addedNodes = new Set();
            
            // æ·»åŠ ä¸­å¿ƒèŠ‚ç‚¹ï¼ˆé€‰ä¸­çš„äººå‘˜ï¼‰- æ ·å¼ç±»ä¼¼ç¤ºä¾‹å›¾çš„ä¸­å¿ƒäººç‰©
            nodes.push({
                id: selectedPerson,
                label: selectedPerson,
                color: {
                    background: '#1E3A8A', // æ·±è“è‰² - æ›´åè°ƒçš„ä¸»è‰²è°ƒ
                    border: '#1E3A8A',
                    highlight: {
                        background: '#3B82F6',
                        border: '#2563EB'
                    }
                },
                size: 45, // å¢å¤§ä¸­å¿ƒèŠ‚ç‚¹
                font: { 
                    size: 18, 
                    color: '#ffffff', // ç™½è‰²æ–‡å­—ï¼Œæé«˜å¯è¯»æ€§
                    face: 'Arial',
                    weight: 'bold'
                },
                shape: 'circle',
                shadow: {
                    enabled: true,
                    color: 'rgba(0,0,0,0.4)',
                    size: 15
                },
                borderWidth: 4 // åŠ ç²—è¾¹æ¡†
            });
            addedNodes.add(selectedPerson);
            
            // ä¸ºæ¯ä¸ªå½¹ç§ç±»å‹åˆ›å»ºä¸€ä¸ªåˆ†ç»„èŠ‚ç‚¹
            const categoryNodes = new Map();
            
            // éå†æ‰€æœ‰å½¹ç§ï¼Œæ‰¾åˆ°ä¸é€‰ä¸­äººå‘˜ç›¸å…³çš„å½¹ç§
            esMahjongData.forEach(yaku => {
                // ç¡®ä¿yaku.memberså­˜åœ¨
                if (yaku.members && yaku.members.includes(selectedPerson)) {
                    // ç¡®ä¿å½¹ç§ç±»å‹èŠ‚ç‚¹å­˜åœ¨
                    if (!categoryNodes.has(yaku.category)) {
                        const categoryId = `category_${yaku.category}`;
                        categoryNodes.set(yaku.category, categoryId);
                        nodes.push({
                            id: categoryId,
                            label: yaku.category,
                            color: {
                                background: '#9B59B6', // ç´«è‰² - äºŒçº§æ ‡ç­¾
                                border: '#7B1FA2',
                                highlight: {
                                    background: '#7B1FA2',
                                    border: '#6A1B9A'
                                }
                            },
                            size: 80, // è°ƒæ•´å°ºå¯¸
                            font: {
                                size: 12,
                                color: '#ffffff',
                                face: 'Arial',
                                weight: 'bold'
                            },
                            shape: 'box',
                            shadow: {
                                enabled: true,
                                color: 'rgba(0,0,0,0.3)',
                                size: 10
                            },
                            margin: 8,
                            widthConstraint: {
                                minimum: 70,
                                maximum: 150
                            },
                            borderWidth: 2
                        });
                        addedNodes.add(categoryId);
                    }
                    
                    const categoryId = categoryNodes.get(yaku.category);
                    
                    // æ·»åŠ å½¹ç§èŠ‚ç‚¹ - ç®€åŒ–æ ·å¼
                    const yakuId = `yaku_${yaku.name}`;
                    if (!addedNodes.has(yakuId)) {
                        // å½¹ç§èŠ‚ç‚¹ä¸éœ€è¦åœ¨å›¾ä¸­æ˜¾ç¤ºï¼Œåªéœ€è¦è¿æ¥å…³ç³»
                        // æˆ‘ä»¬å¯ä»¥å°†å½¹ç§ä½œä¸ºè¾¹çš„æ ‡ç­¾ï¼Œè¿™æ ·æ›´ç®€æ´
                        addedNodes.add(yakuId);
                    }
                    
                    // æ·»åŠ è¾¹ï¼šäººå‘˜ -> å½¹ç§ç±»å‹
                    edges.push({
                        from: selectedPerson,
                        to: categoryId,
                        color: {
                            color: '#3B82F6', // æµ…è“è‰² - ä¸ä¸€çº§æ ‡ç­¾åè°ƒ
                            highlight: '#2563EB',
                            opacity: 0.7
                        },
                        width: 3,
                        smooth: true,
                        arrowStrikethrough: false
                    });
                    
                    // ç§»é™¤å½¹ç§èŠ‚ç‚¹ï¼Œæ‰€ä»¥ä¸å†éœ€è¦è¿™æ¡è¾¹
                    
                    // æ·»åŠ è¾¹ï¼šå½¹ç§ç±»å‹ -> å…¶ä»–æˆå‘˜ï¼Œç›´æ¥è¿æ¥ï¼Œè·³è¿‡å½¹ç§èŠ‚ç‚¹
                    yaku.members.forEach(member => {
                        // è¿‡æ»¤æ‰ç©ºæˆå‘˜ã€å ä½ç¬¦ã€é€‰ä¸­äººå‘˜ä»¥åŠäº‹åŠ¡æ‰€å’Œå›¢ä½“åç§°
                        if (member && member !== '-' && member !== selectedPerson && member.trim() !== '' && !officeGroupNames.has(member)) {
                            if (!addedNodes.has(member)) {
                                nodes.push({
                                    id: member,
                                    label: member,
                                    color: {
                                        background: '#3498DB', // è“è‰² - ä¸‰çº§æ ‡ç­¾
                                        border: '#2980B9',
                                        highlight: {
                                            background: '#2196F3',
                                            border: '#1976D2'
                                        }
                                    },
                                    size: 25, // è°ƒæ•´æˆå‘˜èŠ‚ç‚¹å¤§å°
                                    font: {
                                        size: 11,
                                        color: '#ffffff',
                                        face: 'Arial',
                                        weight: 'bold'
                                    },
                                    shape: 'circle',
                                    shadow: {
                                        enabled: true,
                                        color: 'rgba(0,0,0,0.2)',
                                        size: 8
                                    },
                                    borderWidth: 2
                                });
                                addedNodes.add(member);
                            }
                            
                            edges.push({
                                from: categoryId,
                                to: member,
                                color: {
                                    color: '#6c757d',
                                    highlight: '#495057',
                                    opacity: 0.7
                                },
                                width: 2,
                                smooth: {
                                    type: 'curvedCCW',
                                    roundness: 0.3
                                },
                                style: 'solid',
                                arrowStrikethrough: false,
                                label: yaku.name, // åœ¨è¾¹ä¸Šæ˜¾ç¤ºå½¹ç§åç§°
                                font: {
                                    size: 10,
                                    color: '#555555',
                                    face: 'Arial'
                                },
                                labelHighlightBold: true
                            });
                        }
                    });
                }
            });
            
            return { nodes, edges };
        }
        
        // æ¸²æŸ“è„‘å›¾
        function renderNetwork(selectedPerson) {
            const container = document.getElementById('network');
            const data = generateNetworkData(selectedPerson);
            
            // æ£€æŸ¥æ•°æ®æ˜¯å¦ä¸ºç©º
            if (!data.nodes || data.nodes.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-16">æœªæ‰¾åˆ°è¯¥äººå‘˜çš„äººé™…å…³ç³»æ•°æ®</p>';
                if (network) {
                    network.destroy();
                    network = null;
                }
                return;
            }
            
            const options = {
                // ç”»å¸ƒæ ·å¼
                width: '100%',
                height: '100%',
                background: {
                    color: 'rgba(255, 255, 255, 1)'
                },
                
                // èŠ‚ç‚¹æ ·å¼
                nodes: {
                    borderWidth: 2,
                    borderWidthSelected: 3,
                    shadow: {
                        enabled: true,
                        size: 10,
                        x: 3,
                        y: 3,
                        color: 'rgba(0,0,0,0.2)'
                    },
                    chosen: {
                        node: function(values, id, selected, hovering) {
                            values.shadow = true;
                            if (hovering) {
                                values.shadow.size = 15;
                            }
                        }
                    }
                },
                
                // è¾¹æ ·å¼
                edges: {
                    smooth: {
                        type: 'cubicBezier',
                        forceDirection: 'vertical',
                        roundness: 0.4
                    },
                    color: {
                        opacity: 0.8
                    },
                    arrows: {
                        to: {
                            enabled: true,
                            scaleFactor: 0.8
                        }
                    },
                    chosen: {
                        edge: function(values, id, selected, hovering) {
                            if (hovering) {
                                values.width = values.width * 1.5;
                                values.color.opacity = 1;
                            }
                        }
                    }
                },
                
                // ç‰©ç†å¼•æ“ - ä¼˜åŒ–é…ç½®ä»¥è·å¾—æ›´åƒç¤ºä¾‹å›¾çš„å¸ƒå±€
                physics: {
                    barnesHut: {
                        gravitationalConstant: -50000, // å¢åŠ å¼•åŠ›ä½¿èŠ‚ç‚¹æ›´é›†ä¸­
                        centralGravity: 0.7, // å¢åŠ ä¸­å¿ƒå¼•åŠ›
                        springLength: 150, // ç¼©çŸ­å¼¹ç°§é•¿åº¦
                        springConstant: 0.05,
                        damping: 0.15,
                        avoidOverlap: 0.8 // å¢åŠ é¿å…é‡å çš„å€¼
                    },
                    maxVelocity: 15,
                    minVelocity: 0.1,
                    solver: 'barnesHut',
                    timestep: 0.3,
                    adaptiveTimestep: true
                },
                
                // ç¦ç”¨å±‚æ¬¡å¸ƒå±€ï¼Œæ”¹ç”¨åŠ¨æ€åŠ›å¯¼å‘å¸ƒå±€æ›´é€‚åˆå…³ç³»å›¾
                layout: {
                    randomSeed: 42, // å›ºå®šéšæœºç§å­ä»¥è·å¾—ä¸€è‡´çš„å¸ƒå±€
                    improvedLayout: true
                },
                
                // äº¤äº’è®¾ç½®
                interaction: {
                    hover: true,
                    hoverConnectedEdges: true,
                    selectable: true,
                    selectConnectedEdges: true,
                    zoomView: true,
                    dragView: true,
                    dragNodes: true,
                    multiselect: true,
                    keyboard: {
                        enabled: true
                    },
                    tooltipDelay: 200,
                    hideEdgesOnDrag: false
                },
                
                // é…ç½®é€‰é¡¹
                configure: {
                    enabled: false
                }
            };
            
            if (network) {
                network.destroy();
            }
            
            network = new vis.Network(container, data, options);
            
            // æ·»åŠ ç¼©æ”¾æ§åˆ¶
            network.on('afterDrawing', function() {
                // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ è‡ªå®šä¹‰ç¼©æ”¾æ§åˆ¶
            });
            
            // ç½‘ç»œç¨³å®šåè‡ªåŠ¨è°ƒæ•´è§†å›¾å¤§å°
            network.once('stabilized', function() {
                network.fit();
            });
        }
        
        // æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨å·²æ•´åˆåˆ°DOMContentLoadedäº‹ä»¶ä¸­
        
        // Valineè¯„è®ºç³»ç»Ÿåˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // ä¸ºValineè¯„è®ºåŒºåŠ¨æ€åŠ è½½å½¹ç§åˆ—è¡¨
            const valineYakuSelect = document.getElementById('valine-yaku-select');
            if (valineYakuSelect) {
                // ä»data.jsä¸­æå–å½¹ç§åç§°å¹¶å»é‡
                const yakuNames = [...new Set(esMahjongData.map(item => item.name))].sort();
                yakuNames.forEach(yaku => {
                    const option = document.createElement('option');
                    option.value = yaku;
                    option.textContent = yaku;
                    valineYakuSelect.appendChild(option);
                });
            }
            
        });
    </script>
  
  <!-- è¿”å›é¡¶éƒ¨/åº•éƒ¨æ¼‚æµ®çª— -->
  <div class="fixed right-4 bottom-4 flex flex-col gap-2 z-50 opacity-20 hover:opacity-100 transition-opacity duration-300">
    <button id="scrollToTop" class="bg-primary text-white rounded-full p-3 shadow-lg hover:bg-primary/90 transition-colors duration-300">
      <i class="fas fa-arrow-up"></i>
    </button>
    <button id="scrollToBottom" class="bg-primary text-white rounded-full p-3 shadow-lg hover:bg-primary/90 transition-colors duration-300">
      <i class="fas fa-arrow-down"></i>
    </button>
  </div>
  
  <script>
    // è¿”å›é¡¶éƒ¨/åº•éƒ¨åŠŸèƒ½
    document.getElementById('scrollToTop').addEventListener('click', function() {
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
    });
    
    document.getElementById('scrollToBottom').addEventListener('click', function() {
      window.scrollTo({
        top: document.body.scrollHeight,
        behavior: 'smooth'
      });
    });
  </script>

    </body>
</html>