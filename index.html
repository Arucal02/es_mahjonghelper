<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ESéº»å°†å½¹ç§æŸ¥è¯¢åŠ©æ‰‹</title>
  <!-- Tailwind CSS v3 -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  <!-- å¼•å…¥æ•°æ®æ–‡ä»¶ -->
  <script src="data.js"></script>
  <!-- PWAç›¸å…³æ ‡ç­¾ -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#4a5568">
<meta name="description" content="å¶åƒæ¢¦å¹»ç¥­éº»å°†èƒ¡ç‰ŒåŠ©æ‰‹">
<meta name="author" content="Aruai">
<meta name="publisher" content="Aruai">

<!-- iOSæ”¯æŒ -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="ESéº»å°†èƒ¡ç‰ŒåŠ©æ‰‹">
<link rel="apple-touch-icon" href="./es_mahjong_url.png">
<link rel="apple-touch-icon" href="./es_mahjong_url.png" sizes="180x180">

<!-- å¼•å…¥manifest -->
<link rel="manifest" href="./manifest.json">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#7e22ce', // ç´«è‰²
            secondary: '#3b82f6', // è“è‰²
            success: '#16a34a', // ç»¿è‰²
            danger: '#dc2626', // çº¢è‰²
            neutral: '#64748b', // ç°è‰²
            dark: '#1e293b',
            light: '#f8fafc'
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
          },
          animation: {
            'fade-in': 'fadeIn 0.5s ease-in-out',
            'slide-up': 'slideUp 0.5s ease-in-out',
            'pulse-success': 'pulseSuccess 2s infinite',
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' },
            },
            slideUp: {
              '0%': { transform: 'translateY(20px)', opacity: '0' },
              '100%': { transform: 'translateY(0)', opacity: '1' },
            },
            pulseSuccess: {
              '0%, 100%': { backgroundColor: '#16a34a' },
              '50%': { backgroundColor: '#22c55e' },
            }
          }
        }
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .scrollbar-hide::-webkit-scrollbar {
        display: none;
      }
      .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      .card-hover {
        transition: all 0.3s ease;
      }
      .card-hover:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      }
      .member-tag {
        @apply px-2 py-1 rounded-full text-xs mr-1 mb-1;
      }
      .member-tag-completed {
        @apply bg-success/20 text-success;
      }
      .member-tag-pending {
        @apply bg-neutral/20 text-neutral;
      }
    }
  </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen">
  <div class="container mx-auto px-4 py-8 max-w-5xl">
    <!-- æ ‡é¢˜åŒºåŸŸ -->
    <header class="mb-8">
      <div class="flex items-center justify-between mb-2">
        <!-- æ¸¸æˆè§„åˆ™æŒ‰é’® -->
        <button id="rule-btn" class="bg-secondary hover:bg-secondary/90 text-white font-medium px-4 py-2 rounded-lg transition-all flex items-center">
          <i class="fa fa-info-circle mr-2"></i> æ¸¸æˆè§„åˆ™
        </button>
        <!-- å ä½å…ƒç´ ä¿æŒæ ‡é¢˜å±…ä¸­ -->
        <div class="w-[140px] flex justify-end">
          <a href="message.html" class="bg-transparent border-2 border-primary text-primary hover:bg-primary/10 font-medium px-4 py-2 rounded-lg transition-all flex items-center">
            <i class="fa fa-comment-dots mr-2"></i> ç•™è¨€
          </a>
        </div>
      </div>
      <div class="text-center">
        <div class="flex items-center justify-center mb-2">
          <img src="./es_mahjong_yz.png" alt="ESéº»å°†åŠ©æ‰‹" class="h-12 w-12 mr-3">
          <h1 class="text-4xl font-bold text-gray-800">ESéº»å°†å½¹ç§æŸ¥è¯¢åŠ©æ‰‹</h1>
        </div>
        <p class="text-gray-600">å¸®åŠ©ä½ å¿«é€ŸæŸ¥è¯¢å’Œç­›é€‰è§’è‰²ä¹‹é—´çš„ç»„åˆå…³ç³»ï¼Œä¼˜åŒ–æ‰‹ç‰Œç­–ç•¥</p>
        <p class="text-sm text-primary mt-2">èƒ¡ç‰Œæ¡ä»¶ï¼šæ¯ä¸ªå½¹ç§éœ€å‡‘å¤Ÿå…¶ä¸­çš„ä¸‰å¼ ç‰Œä¸”è¦å‡‘é½ä¸‰ä¸ªå½¹ç§ï¼Œå½¹ç§é—´äººå‘˜æ— é‡å </p>
      </div>
    </header>

    <!-- è¾“å…¥åŒºåŸŸ -->
    <section class="bg-white rounded-xl shadow-md p-6 mb-8">
      <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
        <i class="fa fa-users mr-3 text-primary"></i>
        é€‰æ‹©æˆå‘˜
      </h2>
      <div class="relative">
        <div class="flex items-end">
          <div class="relative flex-1">
            <input type="text" id="member-input" placeholder="è¾“å…¥æˆå‘˜åç§°..." class="w-full px-4 py-2 pr-10 bg-white/80 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
            <button id="add-member-btn" type="button" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-primary hover:text-primary/80">
              <i class="fa fa-plus-circle"></i>
            </button>
            <div id="suggestions" class="absolute z-10 w-full bg-white border border-gray-300 rounded-lg shadow-lg mt-1 max-h-60 overflow-y-auto scrollbar-hide hidden"></div>
          </div>
          <button id="usage-btn" class="bg-primary hover:bg-primary/90 text-white font-medium px-6 py-2 rounded-lg transition-all flex items-center justify-center ml-2">
            <i class="fa fa-book mr-2"></i> ä½¿ç”¨è¯´æ˜
          </button>
        </div>
      </div>
      <p class="text-xs text-gray-500 mt-1">è¯·ç¡®ä¿è¾“å…¥çš„è§’è‰²åç§°ä¸æ•°æ®åº“ä¸­çš„æ ¼å¼ä¸€è‡´ï¼Œä¾‹å¦‚"å¤©åŸç‡éŸ³"è€Œé"å¤©åŸç£·éŸ³"<br>æ³¨æ„ï¼Œè¾“å…¥äº‹åŠ¡æ‰€ç‰Œè‹±æ–‡æ—¶éœ€è¦ä½¿ç”¨å¤§å†™</p>
    </section>

    <!-- å·²é€‰æˆå‘˜æ ‡ç­¾ -->
    <div class="mb-2">
      <h3 class="text-lg font-medium text-gray-700">å½“å‰æ‰‹ç‰Œæ± </h3>
    </div>
    <div id="selected-members" class="mb-4 flex flex-wrap gap-2 min-h-[40px] border border-dashed border-gray-300 rounded-lg p-2"></div>
    <div class="text-right mb-2">
      <span id="selected-count" class="text-sm text-gray-500">å·²é€‰äººæ•°: 0</span>
    </div>
    
    <!-- æ¸…é™¤æŒ‰é’® -->
    <div class="mb-8 text-right">
      <button id="clear-btn" class="text-gray-500 hover:text-gray-700 text-sm flex items-center">
        <i class="fa fa-times-circle mr-1"></i> æ¸…é™¤æ‰€æœ‰
      </button>
    </div>

    <!-- ä½¿ç”¨è¯´æ˜æ¨¡æ€æ¡† -->
    <div id="usage-modal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4">
      <div class="bg-white rounded-xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto">
        <div class="bg-primary text-white p-6 rounded-t-xl">
          <div class="flex items-center justify-between">
            <h3 class="text-2xl font-bold">ESéº»å°†å½¹ç§æŸ¥è¯¢åŠ©æ‰‹ - ä½¿ç”¨è¯´æ˜</h3>
            <button id="close-usage-modal" class="text-white hover:text-gray-200 text-2xl">
              <i class="fa fa-times"></i>
            </button>
          </div>
        </div>
        <div class="p-6">
          <div class="mb-6">
            <h4 class="text-xl font-semibold text-gray-800 mb-3">åŠŸèƒ½ä»‹ç»</h4>
            <p class="text-gray-600 mb-4">æœ¬å·¥å…·å¸®åŠ©ä½ å¿«é€ŸæŸ¥è¯¢å’Œç­›é€‰è§’è‰²ä¹‹é—´çš„ç»„åˆå…³ç³»ï¼Œä¼˜åŒ–æ‰‹ç‰Œç­–ç•¥ï¼Œæ‰¾åˆ°æœ€ä½³çš„èƒ¡ç‰Œæ–¹æ¡ˆã€‚</p>
            <p class="text-gray-600 mb-4">è½¯ä»¶é‡‡ç”¨å®æ—¶æ›´æ–°æœºåˆ¶ï¼Œå½“ä½ æ·»åŠ æˆ–ç§»é™¤æˆå‘˜æ—¶ï¼Œä¼šè‡ªåŠ¨æ›´æ–°æ¨èå†…å®¹ï¼Œæ— éœ€æ‰‹åŠ¨ç‚¹å‡»æŸ¥è¯¢æŒ‰é’®ã€‚</p>
          </div>
          
          <div class="mb-6">
            <h4 class="text-xl font-semibold text-gray-800 mb-3">ä½¿ç”¨æ­¥éª¤</h4>
            <ol class="list-decimal list-inside space-y-3 text-gray-600">
              <li>åœ¨æœç´¢æ¡†å†…è¾“å…¥æˆå‘˜åç§°å…³é”®è¯ï¼ˆå¦‚"å¤©åŸ"ã€"ç‡éŸ³"ç­‰ï¼‰</li>
              <li>ä»ä¸‹æ‹‰å»ºè®®åˆ—è¡¨ä¸­ç‚¹å‡»æˆå‘˜åç§°ï¼Œå°†å…¶æ·»åŠ åˆ°æ‰‹ç‰Œæ± </li>
              <li>é‡å¤ä¸Šè¿°æ­¥éª¤ï¼Œæ·»åŠ è‡³å°‘1åæˆå‘˜ï¼ˆå»ºè®®æ·»åŠ 2-4åæˆå‘˜ä»¥è·å¾—æ›´å‡†ç¡®çš„æ¨èï¼‰</li>
              <li>ç³»ç»Ÿä¼šè‡ªåŠ¨åˆ†æå¹¶æ˜¾ç¤ºæ¨èçš„å½¹ç§ç»„åˆå’Œèƒ¡ç‰Œå»ºè®®</li>
              <li>ä½ å¯ä»¥ç‚¹å‡»"æ¨¡æ‹Ÿæ›¿æ¢"æŒ‰é’®æ¥å°è¯•ä¸åŒçš„æˆå‘˜ç»„åˆ</li>
              <li>å¦‚éœ€é‡æ–°å¼€å§‹ï¼Œå¯ä»¥ç‚¹å‡»"æ¸…é™¤æ‰€æœ‰"æŒ‰é’®</li>
            </ol>
          </div>
          
          <div class="bg-green-50 p-4 rounded-lg border border-green-200 mb-6">
            <h4 class="text-lg font-semibold text-green-800 mb-2">å°æŠ€å·§</h4>
            <p class="text-gray-600">å¦‚æœä¸çŸ¥é“è¯¥é€‰ä»€ä¹ˆæˆå‘˜ï¼Œå¯ä»¥å…ˆé€‰æ‹©ä¸€ä¸ªå®Œæ•´çš„å½¹ç§ï¼Œç„¶åå†æ ¹æ®æ¨èè¿›è¡Œè°ƒæ•´ã€‚è¿™æ ·æ›´å®¹æ˜“æ‰¾åˆ°é«˜åˆ†çš„èƒ¡ç‰Œç»„åˆï¼</p>
          </div>
          
          <div class="mb-6">
            <h4 class="text-xl font-semibold text-gray-800 mb-3">èƒ¡ç‰Œè§„åˆ™</h4>
            <div class="bg-gray-50 p-4 rounded-lg">
              <p class="text-gray-600 mb-2"><strong>åŸºæœ¬æ¡ä»¶ï¼š</strong>éœ€è¦å‡‘é½ä¸‰ä¸ªä¸åŒçš„å½¹ç§ï¼Œä¸”æ¯ä¸ªå½¹ç§éœ€å‡‘å¤Ÿå…¶ä¸­çš„ä¸‰å¼ ç‰Œã€‚</p>
              <p class="text-gray-600 mb-2"><strong>é‡è¦è§„åˆ™ï¼š</strong>å½¹ç§é—´äººå‘˜æ— é‡å ï¼Œå³åŒä¸€ä¸ªæˆå‘˜ä¸èƒ½åŒæ—¶å‡ºç°åœ¨ä¸¤ä¸ªä¸åŒçš„å½¹ç§ä¸­ã€‚</p>
              <p class="text-gray-600 mb-2"><strong>äº‹åŠ¡æ‰€è§„åˆ™ï¼š</strong>å¦‚æœå½¹ç§åŒ…å«äº‹åŠ¡æ‰€ç‰¹æ®Šå•ä½ï¼ˆå¦‚STAR PROã€NEW DIMENSIONç­‰ï¼‰ï¼Œåˆ™å¿…é¡»åŒæ—¶åŒ…å«å¯¹åº”çš„å›¢ä½“LOGOï¼ˆå¦‚Undeadã€Edenç­‰ï¼‰ã€‚</p>
            </div>
          </div>
          
          <div class="mb-6">
            <h4 class="text-xl font-semibold text-gray-800 mb-3">æ³¨æ„äº‹é¡¹</h4>
            <ul class="list-disc list-inside space-y-2 text-gray-600">
              <li>è¯·ç¡®ä¿è¾“å…¥çš„è§’è‰²åç§°ä¸æ•°æ®åº“ä¸­çš„æ ¼å¼ä¸€è‡´ï¼Œä¾‹å¦‚"å¤©åŸç‡éŸ³"è€Œé"å¤©åŸç£·éŸ³"</li>
              <li>è¾“å…¥äº‹åŠ¡æ‰€ç‰Œè‹±æ–‡æ—¶éœ€è¦ä½¿ç”¨å¤§å†™ï¼Œå¦‚"STAR PRO"</li>
              <li>å»ºè®®ä»å·²æœ‰çš„å½¹ç§ä¸­é€‰æ‹©æˆå‘˜ï¼Œè¿™æ ·æ›´å®¹æ˜“å‡‘é½å®Œæ•´çš„å½¹ç§ç»„åˆ</li>
              <li>æ¯ä¸ªå½¹ç§è‡³å°‘éœ€è¦3åæˆå‘˜æ‰èƒ½å®Œæˆï¼ŒæŸäº›å½¹ç§å¯èƒ½éœ€è¦æ›´å¤šæˆå‘˜</li>
            </ul>
          </div>
          
          <div class="mb-6">
            <h4 class="text-xl font-semibold text-gray-800 mb-3">åŠŸèƒ½è¯¦è§£</h4>
            <div class="space-y-4">
              <div>
                <h5 class="font-medium text-gray-800 mb-1">â‘ æ¨èå½¹ç§</h5>
                <p class="text-gray-600">æ ¹æ®ä½ å·²é€‰çš„æˆå‘˜ï¼Œç³»ç»Ÿä¼šæ¨èæœ€å®¹æ˜“è¾¾æˆçš„å½¹ç§ç»„åˆå’Œæœ€é«˜åˆ†æ•°çš„å½¹ç§ç»„åˆã€‚</p>
              </div>
              <div>
                <h5 class="font-medium text-gray-800 mb-1">â‘¡å‡‘ç‰Œå»ºè®®</h5>
                <p class="text-gray-600">æ˜¾ç¤ºæ‰€æœ‰åŒ…å«ä½ å·²é€‰æˆå‘˜çš„å½¹ç§ï¼Œå¹¶æ ‡è®°æ¯ä¸ªå½¹ç§çš„å®Œæˆè¿›åº¦å’Œæ‰€éœ€æˆå‘˜ã€‚</p>
              </div>
              <div>
                <h5 class="font-medium text-gray-800 mb-1">â‘¢èƒœåˆ©è¿›åº¦</h5>
                <p class="text-gray-600">å®æ—¶æ˜¾ç¤ºä½ å·²å‡‘é½çš„å½¹ç§æ•°é‡å’Œèƒ¡ç‰Œè¿›åº¦ï¼Œå¸®åŠ©ä½ äº†è§£è·ç¦»èƒœåˆ©è¿˜æœ‰å¤šè¿œã€‚</p>
              </div>
              <div>
                <h5 class="font-medium text-gray-800 mb-1">â‘£èƒ¡ç‰Œæ•°æ®ç»Ÿè®¡</h5>
                <p class="text-gray-600">ç³»ç»Ÿä¼šè‡ªåŠ¨è®°å½•ä½ çš„æ€»èƒ¡ç‰Œæ¬¡æ•°å’Œå„ä¸ªå½¹ç§çš„èƒ¡ç‰Œæ¬¡æ•°ï¼Œè¿™äº›ç»Ÿè®¡æ•°æ®å¯ä»¥åœ¨æ•°æ®åº“ç®¡ç†é¡µé¢ä¸­æŸ¥çœ‹ï¼Œå¸®åŠ©ä½ äº†è§£è‡ªå·±çš„æ¸¸æˆåå¥½å’Œæ“…é•¿çš„å½¹ç§ç»„åˆã€‚</p>
              </div>
            </div>
          </div>
          
          <div class="mb-6">
            <h4 class="text-xl font-semibold text-gray-800 mb-3">ç•™è¨€åŠŸèƒ½</h4>
            <div class="space-y-4">
              <div>
                <h5 class="font-medium text-gray-800 mb-1">â‘ è®¿é—®ç•™è¨€é¡µé¢</h5>
                <p class="text-gray-600">ç‚¹å‡»é¡µé¢é¡¶éƒ¨çš„"ç•™è¨€"æŒ‰é’®ï¼Œå³å¯è¿›å…¥ESäººé™…å…³ç³»ç•™è¨€é¡µé¢ã€‚</p>
              </div>
              <div>
                <h5 class="font-medium text-gray-800 mb-1">â‘¡ç•™è¨€ç”¨é€”</h5>
                <p class="text-gray-600">ç•™è¨€åŠŸèƒ½æ—¨åœ¨æ±‡æ€»å¤§å®¶åƒè¿‡çš„"é¦™é¦™é¥­"ï¼Œå¸®åŠ©èŒæ–°å¿«é€Ÿäº†è§£æŸä¸€å°å¶åƒ/ç»„åˆ/å›¢ä½“ã€‚</p>
              </div>
              <div>
                <h5 class="font-medium text-gray-800 mb-1">â‘¢ç•™è¨€è§„åˆ™</h5>
                <p class="text-gray-600">ç¦æ­¢åœ¨ç•™è¨€åŒºå†…ç•™ä¸‹ä¸å‹å–„ã€å¼•æˆ˜ã€ESæ— å…³ã€æ¶‰åŠäººèº«æ”»å‡»ç­‰ä¸€ç³»åˆ—å‘è¨€ï¼Œå¦‚ç»å‘ç°ä¼šè¿›è¡Œåˆ é™¤å¤„ç†ã€‚è¯·éµå®ˆç¤¾åŒºè§„èŒƒï¼Œå…±åŒç»´æŠ¤è‰¯å¥½çš„äº¤æµç¯å¢ƒã€‚</p>
              </div>
              <div>
                <h5 class="font-medium text-gray-800 mb-1">â‘£åˆ é™¤åŠŸèƒ½</h5>
                <p class="text-gray-600">ç‚¹å‡»ç•™è¨€ä¸‹æ–¹çš„åˆ é™¤æŒ‰é’®ï¼ˆåƒåœ¾æ¡¶å›¾æ ‡ï¼‰æ—¶ï¼Œç³»ç»Ÿä¼šå¼¹å‡ºäºŒæ¬¡ç¡®è®¤å¯¹è¯æ¡†ï¼Œç¡®è®¤åæ‰ä¼šæ‰§è¡Œåˆ é™¤æ“ä½œï¼Œé¿å…è¯¯æ“ä½œã€‚</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- æ¨èæ­é…åŒºåŸŸ -->
    <section id="recommendation-section" class="mb-8 hidden">
      <div class="bg-gradient-to-r from-primary/10 to-secondary/10 rounded-xl shadow-md p-6 animate-fade-in">
        <div class="flex items-start">
          <div class="bg-secondary/20 text-secondary p-3 rounded-full mr-4">
            <i class="fa fa-lightbulb-o text-xl"></i>
          </div>
          <div class="w-full">
            <h2 class="text-xl font-bold text-gray-800 mb-2 flex items-center">
              <i class="fa fa-thumbs-up mr-3 text-primary"></i>
              æ¨èå½¹ç§
            </h2>
            
            <!-- å·²å‡‘æˆçš„é…é˜Ÿ -->
            <div id="completed-teams" class="mb-6 hidden">
              <h3 id="completed-teams-title" class="text-lg font-semibold text-success mb-2">ğŸ‰ å·²å‡‘æˆçš„é…é˜Ÿ</h3>
              <div id="completed-teams-content" class="space-y-3"></div>
            </div>
            
            <!-- èƒ¡ç‰Œå»ºè®® -->
            <div id="winning-suggestions" class="mb-6 hidden">
              <h3 class="text-lg font-semibold text-primary mb-2">ğŸ¯ èƒ¡ç‰Œå»ºè®®</h3>
              <div id="winning-suggestions-content" class="space-y-3"></div>
            </div>
            
            <!-- æ¨èæ·»åŠ çš„æˆå‘˜ -->
            <div id="recommended-members">
              <p class="text-gray-600 mb-4">æ ¹æ®ä½ å·²é€‰çš„æˆå‘˜ï¼Œæˆ‘ä»¬æ¨èä»¥ä¸‹æ­é…ä»¥è¾¾æˆæœ€ä½³ç»„åˆï¼š</p>
              <div id="recommendation-content"></div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- å‡‘ç‰Œå»ºè®®åˆ—è¡¨ -->
    <section id="results-section" class="mb-8 hidden">
      <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
        <i class="fa fa-lightbulb-o mr-3 text-primary"></i>
        å‡‘ç‰Œå»ºè®®
      </h2>
      <div id="results-container" class="space-y-4"></div>
    </section>

    <!-- èƒœåˆ©è¿›åº¦æç¤º -->
    <section id="progress-section" class="bg-white rounded-xl shadow-md p-6 mb-8 hidden">
      <div class="flex items-center justify-between">
        <div>
          <h2 class="text-xl font-bold text-gray-800 flex items-center">
            <i class="fa fa-trophy mr-3 text-primary"></i>
            èƒœåˆ©è¿›åº¦
          </h2>
          <p class="text-gray-600">å·²å‡‘é½ <span id="completed-count" class="font-bold text-success">0</span> / 3 ä¸ªå½¹ç§ï¼ˆæ¯ä¸ªå½¹ç§è‡³å°‘3äººï¼Œä¸”å½¹ç§é—´äººå‘˜æ— é‡å ï¼‰</p>
        </div>
        <div class="w-32 h-32 relative">
          <svg class="w-full h-full" viewBox="0 0 100 100">
            <circle cx="50" cy="50" r="45" fill="none" stroke="#e2e8f0" stroke-width="10"></circle>
            <circle id="progress-circle" cx="50" cy="50" r="45" fill="none" stroke="#16a34a" stroke-width="10" stroke-dasharray="282.74" stroke-dashoffset="282.74" transform="rotate(-90 50 50)"></circle>
          </svg>
          <div class="absolute inset-0 flex items-center justify-center">
            <span id="progress-percentage" class="text-2xl font-bold text-primary">0%</span>
          </div>
        </div>
      </div>
    </section>

    <!-- èƒœåˆ©æç¤ºæ¨¡æ€æ¡† -->
    <div id="victory-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
      <div class="bg-white rounded-xl shadow-xl p-8 max-w-md w-full mx-4 animate-slide-up">
        <div class="text-center">
          <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-success/20 text-success text-3xl mb-4">
            <i class="fa fa-trophy"></i>
          </div>
          <h2 class="text-3xl font-bold text-gray-800 mb-2">æ­å–œï¼</h2>
          <p class="text-xl text-gray-600 mb-6">å·²è¾¾æˆèƒœåˆ©æ¡ä»¶ï¼</p>
          <p class="text-gray-500 mb-6">ä½ å·²æˆåŠŸå‡‘é½ 3 ä¸ªå½¹ç§ï¼ˆæ¯ä¸ªå½¹ç§è‡³å°‘3äººï¼Œä¸”å½¹ç§é—´äººå‘˜æ— é‡å ï¼‰</p>
          <button id="close-victory-modal" class="bg-primary hover:bg-primary/90 text-white font-medium px-6 py-2 rounded-lg transition-all">
            ç»§ç»­æ¸¸æˆ
          </button>
        </div>
      </div>
    </div>

    <!-- æ•°æ®åº“ç®¡ç†é“¾æ¥ -->
    <div class="text-center mb-8">
      <a href="database.html" class="inline-flex items-center justify-center bg-secondary hover:bg-secondary/90 text-white font-medium px-6 py-2 rounded-lg transition-all">
        <i class="fa fa-database mr-2"></i> å½¹ç§æ•°æ®åº“ç®¡ç†
      </a>
    </div>
    
    <!-- åº•éƒ¨ä¿¡æ¯ -->
    <footer class="text-center text-gray-500 text-sm mt-12">
      <p>ESéº»å°†å½¹ç§æŸ¥è¯¢åŠ©æ‰‹ Â© 2025</p>
      <p>åˆ¶ä½œï¼šxhsè´¦å·-yuovoï¼›Github@Arucal02</p>
      <p>ç´ æåŠè§„åˆ™æ¥æºï¼šå¶åƒæ¢¦å¹»ç¥­2 & Happy elements K.K</p>
      <p>ç‰¹åˆ«é¸£è°¢ï¼šéº»å‹-å–œæ¬¢æ¶Ÿçº¯çš„å°é»„è€å¸ˆæä¾›çš„è§„åˆ™ä¹¦æ•´ç†</p>
              <p>å°çº¢ä¹¦-10378083769-å¯¹éº»å°†å…¥é—¨ç©æ³•çš„ç¿»è¯‘</p>
    </footer>
  </div>

  <script>
    // å…¨å±€å˜é‡
    let allMembers = new Set();
    let selectedMembersList = [];
    let historyStates = []; // ä¿å­˜å†å²çŠ¶æ€ï¼Œç”¨äºæ’¤é”€åŠŸèƒ½
    
    // DOMå…ƒç´ 
    const memberInput = document.getElementById('member-input');
    const suggestions = document.getElementById('suggestions');
    const addMemberBtn = document.getElementById('add-member-btn');
    const usageBtn = document.getElementById('usage-btn');
    const usageModal = document.getElementById('usage-modal');
    const closeUsageModal = document.getElementById('close-usage-modal');
    const clearBtn = document.getElementById('clear-btn');
    const selectedMembers = document.getElementById('selected-members');
    const resultsSection = document.getElementById('results-section');
    const resultsContainer = document.getElementById('results-container');
    const progressSection = document.getElementById('progress-section');
    const completedCount = document.getElementById('completed-count');
    const progressCircle = document.getElementById('progress-circle');
    const progressPercentage = document.getElementById('progress-percentage');
    const victoryModal = document.getElementById('victory-modal');
    const closeVictoryModal = document.getElementById('close-victory-modal');
    
    // ä»æ•°æ®ä¸­æå–æ‰€æœ‰å”¯ä¸€æˆå‘˜
    function extractAllMembers() {
      const members = new Set();
      esMahjongData.forEach(combination => {
        combination.members.forEach(member => {
          if (member && member !== '-') {
            members.add(member);
          }
        });
      });
      return members;
    }
    
    // æ·»åŠ æˆå‘˜
    function addMember(member) {
      if (!selectedMembersList.includes(member)) {
        selectedMembersList.push(member);
        renderSelectedMembers();
        console.log('å·²æ·»åŠ æˆå‘˜:', member);
        console.log('å½“å‰å·²é€‰æˆå‘˜åˆ—è¡¨:', selectedMembersList);
        
        // è‡ªåŠ¨è§¦å‘æœç´¢ï¼Œæ›´æ–°æ¨èå†…å®¹
        search();
      }
    }
    
    // ç§»é™¤æˆå‘˜
    function removeMember(member) {
      selectedMembersList = selectedMembersList.filter(m => m !== member);
      renderSelectedMembers();
      console.log('å·²ç§»é™¤æˆå‘˜:', member);
      // è‡ªåŠ¨è§¦å‘æœç´¢ï¼Œæ›´æ–°æ¨èå†…å®¹
      search();
    }
    
    // HTMLè½¬ä¹‰å‡½æ•°ï¼Œé˜²æ­¢ç‰¹æ®Šå­—ç¬¦å¯¼è‡´çš„è¯­æ³•é”™è¯¯
    function escapeHtml(text) {
      if (!text) return '';
      return text
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
    }
    
    // ä¸€é”®åº”ç”¨èƒ¡ç‰Œå»ºè®®
    function applyWinningSuggestion(removeMembers, addMembers) {
      console.log('åº”ç”¨èƒ¡ç‰Œå»ºè®®:', removeMembers, addMembers);
      
      // ä¿å­˜å½“å‰çŠ¶æ€åˆ°å†å²è®°å½•
      historyStates.push([...selectedMembersList]);
      
      // å…ˆç§»é™¤æ‰€æœ‰å»ºè®®çš„æˆå‘˜
      removeMembers.forEach(member => {
        removeMember(member);
      });
      
      // ç„¶åæ·»åŠ æ‰€æœ‰å»ºè®®çš„æˆå‘˜
      addMembers.forEach(member => {
        addMember(member);
      });
      
      // è‡ªåŠ¨è§¦å‘æœç´¢ï¼Œæ›´æ–°æ¨èå†…å®¹
      search();
      
      // æ˜¾ç¤ºæ’¤é”€æŒ‰é’®
      const undoBtn = document.getElementById('undo-button');
      if (undoBtn) {
        undoBtn.classList.remove('hidden');
      }
    }
    
    // æ’¤é”€ä¸Šä¸€æ¬¡æ“ä½œçš„å‡½æ•°
    function undoLastOperation() {
      if (historyStates.length > 0) {
        // æ¢å¤ä¸Šä¸€ä¸ªçŠ¶æ€
        selectedMembersList = historyStates.pop();
        
        // é‡æ–°æ¸²æŸ“å·²é€‰æˆå‘˜
        renderSelectedMembers();
        
        // è‡ªåŠ¨è§¦å‘æœç´¢ï¼Œæ›´æ–°æ¨èå†…å®¹
        search();
        
        // å¦‚æœæ²¡æœ‰å†å²è®°å½•äº†ï¼Œéšè—æ’¤é”€æŒ‰é’®
        const undoBtn = document.getElementById('undo-button');
        if (undoBtn && historyStates.length === 0) {
          undoBtn.classList.add('hidden');
        }
      }
    }
    
    // æ¸²æŸ“å·²é€‰æˆå‘˜æ ‡ç­¾
    function renderSelectedMembers() {
      console.log('æ¸²æŸ“å·²é€‰æˆå‘˜ï¼Œåˆ—è¡¨é•¿åº¦:', selectedMembersList.length);
      selectedMembers.innerHTML = selectedMembersList
        .map(member => `
          <div class="bg-primary/10 text-primary px-3 py-1 rounded-full text-sm flex items-center">
            ${member}
            <button class="ml-2 text-primary/70 hover:text-primary" onclick="removeMember('${member}')">
              <i class="fa fa-times"></i>
            </button>
          </div>
        `)
        .join('');
      
      // æ›´æ–°å·²é€‰äººæ•°æ˜¾ç¤º
      document.getElementById('selected-count').textContent = `å·²é€‰äººæ•°: ${selectedMembersList.length}`;
    }
    
    // æˆå‘˜è‡ªåŠ¨å®ŒæˆåŠŸèƒ½
    function setupMemberInput() {
      console.log('è®¾ç½®æˆå‘˜è¾“å…¥åŠŸèƒ½...');
      
      // æˆå‘˜è‡ªåŠ¨å®ŒæˆåŠŸèƒ½
      memberInput.addEventListener('input', function() {
        const inputValue = this.value.trim();
        console.log(`è¾“å…¥å†…å®¹: "${inputValue}"`);
        
        // å¦‚æœè¾“å…¥æ¡†ä¸ºç©ºï¼Œéšè—å»ºè®®
        if (!inputValue) {
          suggestions.classList.add('hidden');
          return;
        }
        
        // è¿‡æ»¤åŒ¹é…çš„æˆå‘˜ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰
        const matchedMembers = Array.from(allMembers).filter(member => 
          member.toLowerCase().includes(inputValue.toLowerCase()) && !selectedMembersList.includes(member)
        );
        
        console.log(`æ‰¾åˆ° ${matchedMembers.length} ä¸ªåŒ¹é…çš„æˆå‘˜`);
        
        // æ˜¾ç¤ºå»ºè®®
        if (matchedMembers.length > 0) {
          suggestions.innerHTML = matchedMembers
            .slice(0, 10)
            .map(member => `<div class="px-4 py-2 hover:bg-gray-100 cursor-pointer">${member}</div>`)
            .join('');
          suggestions.classList.remove('hidden');
          
          // æ·»åŠ ç‚¹å‡»äº‹ä»¶
          suggestions.querySelectorAll('div').forEach(item => {
            item.addEventListener('click', function() {
              const memberName = this.textContent.trim();
              console.log('ç‚¹å‡»å»ºè®®é¡¹:', memberName);
              addMember(memberName);
              memberInput.value = '';
              suggestions.classList.add('hidden');
            });
          });
        } else {
          suggestions.innerHTML = '<div class="px-4 py-2 text-gray-500">æœªæ‰¾åˆ°åŒ¹é…çš„æˆå‘˜</div>';
          suggestions.classList.remove('hidden');
        }
      });
      
      // ç‚¹å‡»æ·»åŠ æŒ‰é’®
      if (addMemberBtn) {
        console.log('ç»‘å®šæ·»åŠ æŒ‰é’®äº‹ä»¶...');
        addMemberBtn.addEventListener('click', function() {
          const inputValue = memberInput.value.trim();
          if (inputValue) {
            console.log('ç‚¹å‡»æ·»åŠ æŒ‰é’®:', inputValue);
            // å°è¯•æ·»åŠ è¾“å…¥çš„æˆå‘˜
            if (allMembers.has(inputValue)) {
              addMember(inputValue);
              memberInput.value = '';
              suggestions.classList.add('hidden');
            } else {
              // å°è¯•æŒ‰é€—å·åˆ†éš”æ·»åŠ å¤šä¸ªæˆå‘˜
              const members = inputValue.split(',').map(m => m.trim()).filter(m => m);
              console.log('æŒ‰é€—å·åˆ†éš”çš„æˆå‘˜åˆ—è¡¨:', members);
              members.forEach(member => {
                if (allMembers.has(member)) {
                  addMember(member);
                } else {
                  console.log('æˆå‘˜ä¸å­˜åœ¨:', member);
                }
              });
              memberInput.value = '';
              suggestions.classList.add('hidden');
            }
          }
        });
      }
      
      // å›è½¦é”®è§¦å‘æ·»åŠ æˆå‘˜
      console.log('ç»‘å®šå›è½¦é”®äº‹ä»¶...');
      memberInput.addEventListener('keypress', function(event) {
        if (event.key === 'Enter') {
          const inputValue = this.value.trim();
          if (inputValue) {
            console.log('å›è½¦é”®æ·»åŠ æˆå‘˜:', inputValue);
            // å°è¯•æ·»åŠ è¾“å…¥çš„æˆå‘˜
            if (allMembers.has(inputValue)) {
              addMember(inputValue);
              this.value = '';
            } else {
              // å°è¯•æŒ‰é€—å·åˆ†éš”æ·»åŠ å¤šä¸ªæˆå‘˜
              const members = inputValue.split(',').map(m => m.trim()).filter(m => m);
              console.log('æŒ‰é€—å·åˆ†éš”çš„æˆå‘˜åˆ—è¡¨:', members);
              members.forEach(member => {
                if (allMembers.has(member)) {
                  addMember(member);
                } else {
                  console.log('æˆå‘˜ä¸å­˜åœ¨:', member);
                }
              });
              this.value = '';
            }
          } else {
            search();
          }
        }
      });
      
      // ç‚¹å‡»é¡µé¢å…¶ä»–åœ°æ–¹éšè—å»ºè®®
      document.addEventListener('click', function(event) {
        if (!memberInput.contains(event.target) && !suggestions.contains(event.target) && !addMemberBtn.contains(event.target)) {
          suggestions.classList.add('hidden');
        }
      });
      
      console.log('æˆå‘˜è¾“å…¥åŠŸèƒ½è®¾ç½®å®Œæˆ');
    }
    
    // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
    function setupEventListeners() {
      // ä½¿ç”¨è¯´æ˜æŒ‰é’®äº‹ä»¶
      usageBtn.addEventListener('click', function() {
        usageModal.classList.remove('hidden');
      });
      
      // å…³é—­ä½¿ç”¨è¯´æ˜æ¨¡æ€æ¡†
      closeUsageModal.addEventListener('click', function() {
        usageModal.classList.add('hidden');
      });
      
      // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
      usageModal.addEventListener('click', function(e) {
        if (e.target === usageModal) {
          usageModal.classList.add('hidden');
        }
      });
      
      // æ¸…é™¤æŒ‰é’®äº‹ä»¶
      clearBtn.addEventListener('click', function() {
        selectedMembersList = [];
        historyStates = []; // æ¸…ç©ºå†å²è®°å½•
        renderSelectedMembers();
        resultsSection.classList.add('hidden');
        progressSection.classList.add('hidden');
        document.getElementById('recommendation-section').classList.add('hidden');
        // éšè—æ’¤é”€æŒ‰é’®
        const undoBtn = document.getElementById('undo-button');
        if (undoBtn) {
          undoBtn.classList.add('hidden');
        }
      });
      
      // å…³é—­èƒœåˆ©æ¨¡æ€æ¡†
      closeVictoryModal.addEventListener('click', function() {
        victoryModal.classList.add('hidden');
      });
    }
    
    // æœç´¢åŠŸèƒ½
    function search() {
      if (selectedMembersList.length === 0) {
        alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªæˆå‘˜');
        return;
      }
      
      // ç­›é€‰åŒ…å«æ‰€é€‰æˆå‘˜çš„å½¹ç§
      const filteredCombinations = esMahjongData.filter(combination => {
        // æ£€æŸ¥å½¹ç§æ˜¯å¦åŒ…å«è‡³å°‘ä¸€ä¸ªæ‰€é€‰æˆå‘˜
        return combination.members.some(member => 
          selectedMembersList.includes(member) && member !== '-'
        );
      });
      
      // ä¸ºæ¯ä¸ªå½¹ç§è®¡ç®—å·²å‡‘é½æˆå‘˜æ•°é‡
      const combinationsWithStatus = filteredCombinations.map(combination => {
        const validMembers = combination.members.filter(m => m !== '-');
        const completedMembers = validMembers.filter(member => 
          selectedMembersList.includes(member)
        );
        const pendingMembers = validMembers.filter(member => 
          !selectedMembersList.includes(member)
        );
        
        // å®šä¹‰äº‹åŠ¡æ‰€ç‰¹æ®Šå•ä½å’Œå¯¹åº”çš„å›¢ä½“LOGO
        const officeUnits = ['STAR PRO', 'NEW DIMENSION', 'COSMIC PRODUCTION', 'Rhythm Linkï¼ˆæå­æ—ï¼‰'];
        const groupLogos = ['Undead', 'ALKALOID', 'Crazy:B', 'Eden', 'fine', 'Valkyrie', '2wink', 'MaM', 'Switch', 'Knights', 'DoubleFace'];
        
        // æ£€æŸ¥äº‹åŠ¡æ‰€ç‰¹æ®Šå•ä½è§„åˆ™
        let meetsOfficeRule = true;
        const hasOfficeUnit = completedMembers.some(member => 
          officeUnits.includes(member)
        );
        const hasGroupLogo = completedMembers.some(member => 
          groupLogos.includes(member)
        );
        
        // å¦‚æœå½¹ç§åŒ…å«äº‹åŠ¡æ‰€ç‰¹æ®Šå•ä½ï¼Œåˆ™å¿…é¡»åŒæ—¶åŒ…å«å›¢ä½“LOGO
        if (hasOfficeUnit && !hasGroupLogo) {
          meetsOfficeRule = false;
        }
        
        // åˆ¤æ–­æ˜¯å¦ä¸ºä¸¤äººå½¹ç§ï¼ˆæ€»æˆå‘˜æ•°ä¸º2ï¼‰
        const isTwoPersonCombination = validMembers.length === 2;
        
        // ä¸¤äººå½¹ç§å®Œæˆæ¡ä»¶ï¼šå‡‘é½æ‰€æœ‰2ä¸ªæˆå‘˜ä¸”ç¬¦åˆäº‹åŠ¡æ‰€è§„åˆ™
        // å…¶ä»–å½¹ç§å®Œæˆæ¡ä»¶ï¼šå‡‘é½è‡³å°‘3ä¸ªæˆå‘˜ä¸”ç¬¦åˆäº‹åŠ¡æ‰€è§„åˆ™
        const isCompleted = (isTwoPersonCombination ? completedMembers.length >= 2 : completedMembers.length >= 3) && meetsOfficeRule;
        
        return {
          ...combination,
          completedMembers,
          pendingMembers,
          completedCount: completedMembers.length,
          totalMembers: validMembers.length,
          isCompleted: isCompleted,
          isTwoPersonCombination: isTwoPersonCombination // æ ‡è®°æ˜¯å¦ä¸ºä¸¤äººå½¹ç§
        };
      });
      
      // æŒ‰å·²å‡‘é½æˆå‘˜æ•°é‡é™åºæ’åˆ—ï¼Œç›¸åŒæ•°é‡æŒ‰åŸå§‹é¡ºåº
      combinationsWithStatus.sort((a, b) => {
        if (a.completedCount !== b.completedCount) {
          return b.completedCount - a.completedCount;
        }
        return filteredCombinations.indexOf(a) - filteredCombinations.indexOf(b);
      });
      
      // ç”Ÿæˆæ¨èæ­é…
      generateRecommendations(combinationsWithStatus);
      
      // æ¸²æŸ“ç»“æœ
      renderResults(combinationsWithStatus);
      
      // æ›´æ–°è¿›åº¦
      updateProgress(combinationsWithStatus);
    }
    
    // ç”Ÿæˆæ¨èæ­é…
    function generateRecommendations(combinations) {
      const recommendationSection = document.getElementById('recommendation-section');
      const recommendationContent = document.getElementById('recommendation-content');
      const completedTeams = document.getElementById('completed-teams');
      const completedTeamsContent = document.getElementById('completed-teams-content');
      const recommendedMembers = document.getElementById('recommended-members');
      const winningSuggestions = document.getElementById('winning-suggestions');
      const winningSuggestionsContent = document.getElementById('winning-suggestions-content');
      
      // æ˜¾ç¤ºå·²å‡‘æˆçš„é…é˜Ÿ
      const allCompletedCombinations = combinations.filter(c => c.isCompleted);
      if (allCompletedCombinations.length > 0) {
        // æ‰¾å‡ºä¸é‡å¤æˆå‘˜çš„æœ€ä¼˜ç»„åˆ
        const optimalCombinations = findOptimalCombinations(allCompletedCombinations);
        
        // æ ¹æ®æœ€ä¼˜ç»„åˆæ•°é‡è®¾ç½®æ ‡é¢˜
        const completedTeamsTitle = document.getElementById('completed-teams-title');
        if (optimalCombinations.length === 3) {
          completedTeamsTitle.textContent = 'ğŸ‰ æ­å–œèƒ¡ç‰Œï¼';
        } else {
          completedTeamsTitle.textContent = 'ğŸ‰ å·²å‡‘æˆçš„é…é˜Ÿ';
        }
        
        // æ¸²æŸ“æœ€ä¼˜ç»„åˆï¼ˆæ”¾åœ¨æœ€å‰é¢ï¼‰
        let completedHtml = '';
        
        if (optimalCombinations.length > 0) {
          completedHtml += `
            <div class="bg-gradient-to-r from-success/10 to-success/5 rounded-lg p-4 border border-success/30 mb-4">
              <div class="flex justify-between items-center mb-3">
                <h4 class="font-medium text-success flex items-center">
                  <i class="fa fa-star mr-2"></i> ä¸»è¦èƒ¡ç‰Œå½¹
                </h4>
                <span class="text-xs bg-success/20 text-success px-2 py-1 rounded-full">
                  æ€»åˆ†: ${optimalCombinations.reduce((sum, c) => sum + c.score, 0)}
                </span>
              </div>
              <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                ${optimalCombinations.map(combination => `
                  <div class="bg-white/70 rounded-lg p-3 border border-success/20">
                    <div class="flex justify-between items-center mb-2">
                      <h5 class="font-medium text-success">${combination.groupName || combination.name}</h5>
                      <span class="text-xs bg-success/20 text-success px-2 py-1 rounded-full">
                        ${combination.category} | ${combination.score}åˆ†
                      </span>
                    </div>
                    <div class="flex flex-wrap">
                      ${combination.completedMembers.map(member => 
                        `<span class="member-tag member-tag-completed">${member}</span>`
                      ).join('')}
                    </div>
                  </div>
                `).join('')}
              </div>
            </div>
          `;
        }
        
        // æ¸²æŸ“å…¶ä»–å·²å‡‘æˆçš„å½¹ç§ï¼ˆåŠ åˆ†å½¹ï¼Œæ’é™¤ä¸»è¦èƒ¡ç‰Œå½¹ä¸­å·²åŒ…å«çš„ï¼‰
        // æ”¶é›†ä¸»è¦èƒ¡ç‰Œå½¹ä¸­å·²ä½¿ç”¨çš„æˆå‘˜
        const usedMembers = new Set();
        optimalCombinations.forEach(combination => {
          combination.completedMembers.forEach(member => usedMembers.add(member));
        });
        
        // è¿‡æ»¤å‡ºæ‰€æœ‰å…¶ä»–å·²å®Œæˆå½¹ç§ï¼ˆåŠ åˆ†å½¹ï¼ŒåŒ…æ‹¬ä¸¤äººå½¹ï¼‰ï¼Œæ— è®ºæ˜¯å¦ä¸ä¸»è¦èƒ¡ç‰Œå½¹æˆå‘˜é‡å 
        // ä½†æ’é™¤ä¸»è¦èƒ¡ç‰Œå½¹ä¸­å·²åŒ…å«çš„å½¹ç§
        const otherCompletedCombinations = allCompletedCombinations.filter(c => 
          !optimalCombinations.some(oc => oc.name === c.name)
        );
        
        if (otherCompletedCombinations.length > 0) {
          completedHtml += `
            <div class="space-y-3">
              ${otherCompletedCombinations.map(combination => `
                <div class="bg-white/50 rounded-lg p-4 border border-success/20">
                  <div class="flex justify-between items-center mb-2">
                    <h4 class="font-medium text-success">${combination.name}</h4>
                    <span class="text-xs bg-success/20 text-success px-2 py-1 rounded-full">
                      ${combination.category} | åŠ åˆ†: ${combination.score}
                    </span>
                  </div>
                  <div class="flex flex-wrap">
                    ${combination.completedMembers.map(member => 
                      `<span class="member-tag member-tag-completed">${member}</span>`
                    ).join('')}
                  </div>
                </div>
              `).join('')}
            </div>
          `;
        }
        
        completedTeamsContent.innerHTML = completedHtml;
        completedTeams.classList.remove('hidden');
      } else {
        completedTeams.classList.add('hidden');
      }
      
      // ç”Ÿæˆèƒ¡ç‰Œå»ºè®®ï¼ˆå½“å·²é€‰æˆå‘˜è¾¾åˆ°æˆ–è¶…è¿‡9ä¸ªï¼Œä½†æœªè¾¾æˆèƒœåˆ©æ¡ä»¶æ—¶ï¼‰
      if (selectedMembersList.length >= 9) {
        recommendedMembers.classList.add('hidden');
        
        // æ£€æŸ¥æ˜¯å¦å·²è¾¾æˆèƒœåˆ©æ¡ä»¶
        const optimalCombinations = findOptimalCombinations(allCompletedCombinations);
        
        // å¦‚æœæœªè¾¾æˆèƒœåˆ©æ¡ä»¶ï¼Œç”Ÿæˆèƒ¡ç‰Œå»ºè®®
        if (optimalCombinations.length < 3) {
          const winningSuggestion = generateWinningSuggestion(combinations);
          
          if (winningSuggestion) {
            // æ£€æŸ¥æ˜¯å¦æœ‰ä¸¤å¥—æ–¹æ¡ˆ
            const hasTwoSuggestions = winningSuggestion.optimal && winningSuggestion.highScore;
            
            if (hasTwoSuggestions) {
              // æ¸²æŸ“ä¸¤å¥—æ–¹æ¡ˆ
              winningSuggestionsContent.innerHTML = `
                <!-- æœ€ä¼˜ç»„åˆæ–¹æ¡ˆ -->
                <div class="mb-4">
                  <div class="bg-gradient-to-r from-primary/10 to-primary/5 rounded-lg p-4 border border-primary/30">
                    <div class="flex items-center mb-3">
                      <div class="bg-primary/20 text-primary p-2 rounded-full mr-3">
                        <i class="fa fa-exchange"></i>
                      </div>
                      <h4 class="font-medium text-primary">ğŸ’¡ æœ€ä¼˜ç»„åˆ (æ›´å®¹æ˜“è¾¾æˆ)</h4>
                    </div>
                    <div class="space-y-3">
                      <div>
                        <p class="text-sm text-gray-600 mb-1">å»ºè®®ç§»é™¤:</p>
                        <div class="flex flex-wrap">
                          ${winningSuggestion.optimal.removeMembers.map(member => `
                            <span class="bg-danger/10 text-danger px-2 py-1 rounded-full text-xs mr-1 mb-1 flex items-center cursor-pointer hover:bg-danger/20 transition-colors">
                              ${escapeHtml(member)}
                              <i class="fa fa-times-circle ml-1" onclick="removeMember('${member.replace(/'/g, "\\'")}');search();"></i>
                            </span>
                          `).join('')}
                        </div>
                      </div>
                      <div>
                        <p class="text-sm text-gray-600 mb-1">å»ºè®®æŠ“å–:</p>
                        <div class="flex flex-wrap">
                          ${winningSuggestion.optimal.addMembers.map(member => `
                            <span class="bg-success/10 text-success px-2 py-1 rounded-full text-xs mr-1 mb-1 flex items-center cursor-pointer hover:bg-success/20 transition-colors">
                              ${escapeHtml(member)}
                              <i class="fa fa-plus-circle ml-1" onclick="addMember('${member.replace(/'/g, "\\'")}');search();"></i>
                            </span>
                          `).join('')}
                        </div>
                      </div>
                      ${winningSuggestion.optimal.newlyCompletedCombination ? `
                      <div class="bg-success/10 p-3 rounded-lg">
                        <p class="text-sm text-gray-600 mb-2">æ›¿æ¢åå¯è¾¾æˆçš„å½¹ç§:</p>
                        <div class="bg-white/80 p-2 rounded-lg border border-success/20">
                          <div class="flex justify-between items-center mb-1">
                            <span class="font-medium text-success">${escapeHtml(winningSuggestion.optimal.newlyCompletedCombination.name)}</span>
                            <span class="bg-success/20 text-success px-2 py-0.5 rounded-full text-xs">+${winningSuggestion.optimal.newlyCompletedCombination.score}åˆ†</span>
                          </div>
                          <div class="flex flex-wrap">
                            ${winningSuggestion.optimal.newlyCompletedCombination.completedMembers.map(member => `
                              <span class="bg-success/10 text-success px-1.5 py-0.5 rounded-full text-xs mr-1 mb-1">
                                ${escapeHtml(member)}
                              </span>
                            `).join('')}
                          </div>
                        </div>
                      </div>
                      ` : ''}
                      <div class="mt-3 flex space-x-2">
                        <button onclick="applyWinningSuggestion([${winningSuggestion.optimal.removeMembers.map(member => `'${member.replace(/'/g, "\\'")}'`).join(', ')}], [${winningSuggestion.optimal.addMembers.map(member => `'${member.replace(/'/g, "\\'")}'`).join(', ')}])" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary/90 transition-colors text-sm">
          <i class="fa fa-check-circle mr-1"></i>æ¨¡æ‹Ÿæ›¿æ¢
        </button>
                        <button id="undo-button" onclick="undoLastOperation()" class="bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300 transition-colors text-sm hidden">
                          <i class="fa fa-undo mr-1"></i>æ’¤é”€
                        </button>
                      </div>
                      <p class="text-sm text-gray-500 mt-2">
                          ${winningSuggestion.optimal.replaceCombination ? 
                            `æ›¿æ¢ã€Œ${escapeHtml(winningSuggestion.optimal.replaceCombination)}ã€åå¯è¾¾æˆ ` : 
                            'æ›¿æ¢åå¯è¾¾æˆ '}
                          <span class="font-medium text-primary">${winningSuggestion.optimal.newScore}</span> åˆ†çš„èƒ¡ç‰Œç»„åˆ (æœ¬æ¬¡éœ€è°ƒæ•´ ${winningSuggestion.optimal.adjustmentsNeeded || 1} å¼ æ‰‹ç‰Œï¼Œå»ºè®®æ¨¡æ‹Ÿæ›¿æ¢æŸ¥çœ‹è¯¦æƒ…)
                        </p>
                    </div>
                  </div>
                </div>
                
                <!-- é«˜åˆ†ç»„åˆæ–¹æ¡ˆ -->
                <div>
                  <div class="bg-gradient-to-r from-secondary/10 to-secondary/5 rounded-lg p-4 border border-secondary/30">
                    <div class="flex items-center mb-3">
                      <div class="bg-secondary/20 text-secondary p-2 rounded-full mr-3">
                        <i class="fa fa-exchange"></i>
                      </div>
                      <h4 class="font-medium text-secondary">ğŸ¯ é«˜åˆ†ç»„åˆ (æ›´é«˜åˆ†æ•°)</h4>
                    </div>
                    <div class="space-y-3">
                      <div>
                        <p class="text-sm text-gray-600 mb-1">å»ºè®®ç§»é™¤:</p>
                        <div class="flex flex-wrap">
                          ${winningSuggestion.highScore.removeMembers.map(member => `
                            <span class="bg-danger/10 text-danger px-2 py-1 rounded-full text-xs mr-1 mb-1 flex items-center cursor-pointer hover:bg-danger/20 transition-colors">
                              ${escapeHtml(member)}
                              <i class="fa fa-times-circle ml-1" onclick="removeMember('${member.replace(/'/g, "\\'")}');search();"></i>
                            </span>
                          `).join('')}
                        </div>
                      </div>
                      <div>
                        <p class="text-sm text-gray-600 mb-1">å»ºè®®æŠ“å–:</p>
                        <div class="flex flex-wrap">
                          ${winningSuggestion.highScore.addMembers.map(member => `
                            <span class="bg-success/10 text-success px-2 py-1 rounded-full text-xs mr-1 mb-1 flex items-center cursor-pointer hover:bg-success/20 transition-colors">
                              ${escapeHtml(member)}
                              <i class="fa fa-plus-circle ml-1" onclick="addMember('${member.replace(/'/g, "\\'")}');search();"></i>
                            </span>
                          `).join('')}
                        </div>
                      </div>
                      ${winningSuggestion.highScore.newlyCompletedCombination ? `
                      <div class="bg-success/10 p-3 rounded-lg">
                        <p class="text-sm text-gray-600 mb-2">æ›¿æ¢åå¯è¾¾æˆçš„å½¹ç§:</p>
                        <div class="bg-white/80 p-2 rounded-lg border border-success/20">
                          <div class="flex justify-between items-center mb-1">
                            <span class="font-medium text-success">${escapeHtml(winningSuggestion.highScore.newlyCompletedCombination.name)}</span>
                            <span class="bg-success/20 text-success px-2 py-0.5 rounded-full text-xs">+${winningSuggestion.highScore.newlyCompletedCombination.score}åˆ†</span>
                          </div>
                          <div class="flex flex-wrap">
                            ${winningSuggestion.highScore.newlyCompletedCombination.completedMembers.map(member => `
                              <span class="bg-success/10 text-success px-1.5 py-0.5 rounded-full text-xs mr-1 mb-1">
                                ${escapeHtml(member)}
                              </span>
                            `).join('')}
                          </div>
                        </div>
                      </div>
                      ` : ''}
                      <div class="mt-3 flex space-x-2">
                        <button onclick="applyWinningSuggestion([${winningSuggestion.highScore.removeMembers.map(member => `'${member.replace(/'/g, "\\'")}'`).join(', ')}], [${winningSuggestion.highScore.addMembers.map(member => `'${member.replace(/'/g, "\\'")}'`).join(', ')}])" class="bg-secondary text-white px-4 py-2 rounded-lg hover:bg-secondary/90 transition-colors text-sm">
          <i class="fa fa-check-circle mr-1"></i>æ¨¡æ‹Ÿæ›¿æ¢
        </button>
                        <button id="undo-button" onclick="undoLastOperation()" class="bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300 transition-colors text-sm hidden">
                          <i class="fa fa-undo mr-1"></i>æ’¤é”€
                        </button>
                      </div>
                      <p class="text-sm text-gray-500 mt-2">
                          ${winningSuggestion.highScore.replaceCombination ? 
                            `æ›¿æ¢ã€Œ${escapeHtml(winningSuggestion.highScore.replaceCombination)}ã€åå¯è¾¾æˆ ` : 
                            'æ›¿æ¢åå¯è¾¾æˆ '}
                          <span class="font-medium text-secondary">${winningSuggestion.highScore.newScore}</span> åˆ†çš„èƒ¡ç‰Œç»„åˆ (æœ¬æ¬¡éœ€è°ƒæ•´ ${winningSuggestion.highScore.adjustmentsNeeded || 1} å¼ æ‰‹ç‰Œï¼Œå»ºè®®æ¨¡æ‹Ÿæ›¿æ¢æŸ¥çœ‹è¯¦æƒ…)
                        </p>
                    </div>
                  </div>
                </div>
              `;
            } else {
              // åªæœ‰ä¸€å¥—æ–¹æ¡ˆï¼ŒæŒ‰åŸæ¥çš„æ–¹å¼æ¸²æŸ“
              const suggestion = winningSuggestion.optimal || winningSuggestion.highScore || winningSuggestion;
              
              winningSuggestionsContent.innerHTML = `
                <div class="bg-gradient-to-r from-primary/10 to-primary/5 rounded-lg p-4 border border-primary/30">
                  <div class="flex items-center mb-3">
                    <div class="bg-primary/20 text-primary p-2 rounded-full mr-3">
                      <i class="fa fa-exchange"></i>
                    </div>
                    <h4 class="font-medium text-primary">æ›¿æ¢å»ºè®®</h4>
                  </div>
                  <div class="space-y-3">
                    <div>
                      <p class="text-sm text-gray-600 mb-1">å»ºè®®ç§»é™¤:</p>
                      <div class="flex flex-wrap">
                        ${suggestion.removeMembers.map(member => `
                          <span class="bg-danger/10 text-danger px-2 py-1 rounded-full text-xs mr-1 mb-1 flex items-center cursor-pointer hover:bg-danger/20 transition-colors">
                            ${escapeHtml(member)}
                            <i class="fa fa-times-circle ml-1" onclick="removeMember('${member.replace(/'/g, "\\'")}');search();"></i>
                          </span>
                        `).join('')}
                      </div>
                    </div>
                    <div>
                      <p class="text-sm text-gray-600 mb-1">å»ºè®®æŠ“å–:</p>
                      <div class="flex flex-wrap">
                        ${suggestion.addMembers.map(member => `
                          <span class="bg-success/10 text-success px-2 py-1 rounded-full text-xs mr-1 mb-1 flex items-center cursor-pointer hover:bg-success/20 transition-colors">
                            ${escapeHtml(member)}
                            <i class="fa fa-plus-circle ml-1" onclick="addMember('${member.replace(/'/g, "\\'")}');search();"></i>
                          </span>
                        `).join('')}
                      </div>
                    </div>
                    ${suggestion.newlyCompletedCombination ? `
                    <div class="bg-success/10 p-3 rounded-lg">
                      <p class="text-sm text-gray-600 mb-2">æ›¿æ¢åå¯è¾¾æˆçš„å½¹ç§:</p>
                      <div class="bg-white/80 p-2 rounded-lg border border-success/20">
                        <div class="flex justify-between items-center mb-1">
                          <span class="font-medium text-success">${escapeHtml(suggestion.newlyCompletedCombination.name)}</span>
                          <span class="bg-success/20 text-success px-2 py-0.5 rounded-full text-xs">+${suggestion.newlyCompletedCombination.score}åˆ†</span>
                        </div>
                        <div class="flex flex-wrap">
                          ${suggestion.newlyCompletedCombination.completedMembers.map(member => `
                            <span class="bg-success/10 text-success px-1.5 py-0.5 rounded-full text-xs mr-1 mb-1">
                              ${escapeHtml(member)}
                            </span>
                          `).join('')}
                        </div>
                      </div>
                    </div>
                    ` : ''}
                    <div class="mt-3 flex space-x-2">
                      <button onclick="applyWinningSuggestion([${suggestion.removeMembers.map(member => `'${member.replace(/'/g, "\\'")}'`).join(', ')}], [${suggestion.addMembers.map(member => `'${member.replace(/'/g, "\\'")}'`).join(', ')}])" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary/90 transition-colors text-sm">
          <i class="fa fa-check-circle mr-1"></i>æ¨¡æ‹Ÿæ›¿æ¢
        </button>
                      <button id="undo-button" onclick="undoLastOperation()" class="bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300 transition-colors text-sm hidden">
                        <i class="fa fa-undo mr-1"></i>æ’¤é”€
                      </button>
                    </div>
                    <p class="text-sm text-gray-500 mt-2">
                        ${suggestion.replaceCombination ? 
                          `æ›¿æ¢ã€Œ${escapeHtml(suggestion.replaceCombination)}ã€åå¯è¾¾æˆ ` : 
                          'æ›¿æ¢åå¯è¾¾æˆ '}
                        <span class="font-medium text-primary">${suggestion.newScore}</span> åˆ†çš„èƒ¡ç‰Œç»„åˆ (æœ¬æ¬¡éœ€è°ƒæ•´ ${suggestion.adjustmentsNeeded || 1} å¼ æ‰‹ç‰Œï¼Œå»ºè®®æ¨¡æ‹Ÿæ›¿æ¢æŸ¥çœ‹è¯¦æƒ…)
                      </p>
                  </div>
                </div>
              `;
            }
            
            winningSuggestions.classList.remove('hidden');
          } else {
            winningSuggestions.classList.add('hidden');
          }
        } else {
          winningSuggestions.classList.add('hidden');
        }
      } else {
        // ç”Ÿæˆæ¨èæ·»åŠ çš„æˆå‘˜
        const recommendedMembersList = generateRecommendedMembers(combinations);
        
        if (recommendedMembersList.length > 0) {
          recommendationContent.innerHTML = `
            <div class="space-y-3 mb-3">
              ${recommendedMembersList.slice(0, 5).map(member => `
                <div class="bg-white/50 rounded-lg p-3 border border-secondary/20">
                  <div class="flex items-center justify-between">
                    <span class="bg-secondary/20 text-secondary px-3 py-1 rounded-full text-sm flex items-center">
                      ${member.name}
                      <button class="ml-2 text-secondary/70 hover:text-secondary" onclick="addMember('${member.name}')">
                        <i class="fa fa-plus-circle"></i>
                      </button>
                    </span>
                    <span class="text-xs text-gray-500">æ¨èæŒ‡æ•°: ${member.score}</span>
                  </div>
                  
                  ${member.combinations.length > 0 ? `
                    <div class="mt-2">
                      <p class="text-xs text-gray-500 mb-1">å¯å¸®åŠ©å®Œæˆ:</p>
                      <div class="flex flex-wrap">
                        ${member.combinations.map(combination => `
                          <span class="bg-primary/10 text-primary px-2 py-0.5 rounded-full text-xs mr-1 mb-1">
                            ${combination.name} (${combination.score}åˆ†)
                          </span>
                        `).join('')}
                      </div>
                    </div>
                  ` : ''}
                </div>
              `).join('')}
            </div>
            <p class="text-sm text-gray-500">
              æ·»åŠ è¿™äº›æˆå‘˜å¯ä»¥å¸®åŠ©ä½ æ›´å¿«å‡‘é½é«˜åŠ åˆ†å½¹ç§ï¼ç‚¹å‡»æˆå‘˜æ ‡ç­¾å³å¯å¿«é€Ÿæ·»åŠ ã€‚
            </p>
          `;
        } else {
          recommendationContent.innerHTML = `
            <div class="bg-white/50 rounded-lg p-4 border border-gray-200 text-center">
              <p class="text-gray-600">æš‚æ— æ¨èæˆå‘˜</p>
              <p class="text-sm text-gray-500 mt-1">è¯·å°è¯•é€‰æ‹©æ›´å¤šæˆå‘˜ä»¥è·å–æ¨è</p>
            </div>
          `;
        }
        
        recommendedMembers.classList.remove('hidden');
        winningSuggestions.classList.add('hidden');
      }
      
      recommendationSection.classList.remove('hidden');
    }
    
    // ç”Ÿæˆæ¨èæˆå‘˜
    function generateRecommendedMembers(combinations) {
      // å®šä¹‰äº‹åŠ¡æ‰€ç‰¹æ®Šå•ä½å’Œå›¢ä½“LOGO
      const officeUnits = ['STAR PRO', 'NEW DIMENSION', 'COSMIC PRODUCTION', 'Rhythm Linkï¼ˆæå­æ—ï¼‰'];
      const groupLogos = ['Undead', 'ALKALOID', 'Crazy:B', 'Eden', 'fine', 'Valkyrie', '2wink', 'MaM', 'Switch', 'Knights', 'DoubleFace'];
      
      // æ”¶é›†æ‰€æœ‰å¯èƒ½çš„æˆå‘˜
      const potentialMembers = new Set();
      combinations.forEach(combination => {
        combination.pendingMembers.forEach(member => {
          if (member && member !== '-') {
            potentialMembers.add(member);
          }
        });
      });
      
      // è®¡ç®—æ¯ä¸ªæˆå‘˜çš„æ¨èåˆ†æ•°
      const memberScores = [];
      potentialMembers.forEach(member => {
        let score = 0;
        const memberCombinations = [];
        
        combinations.forEach(combination => {
          // å¦‚æœæˆå‘˜å¯ä»¥å¸®åŠ©å®Œæˆè¿™ä¸ªå½¹ç§ï¼Œä¸”å½¹ç§å°šæœªå®Œæˆ
          if (combination.pendingMembers.includes(member) && combination.completedCount >= 2 && !combination.isCompleted) {
            // æ£€æŸ¥æ˜¯å¦ç¬¦åˆäº‹åŠ¡æ‰€ç‰¹æ®Šå•ä½è§„åˆ™
            let meetsOfficeRule = true;
            
            // ä¸´æ—¶è®¡ç®—æ·»åŠ å½“å‰æˆå‘˜åçš„completedMembers
            const tempCompletedMembers = [...combination.completedMembers, member];
            
            // æ£€æŸ¥æ˜¯å¦åŒ…å«äº‹åŠ¡æ‰€ç‰¹æ®Šå•ä½
            const hasOfficeUnit = tempCompletedMembers.some(m => officeUnits.includes(m));
            // æ£€æŸ¥æ˜¯å¦åŒ…å«å›¢ä½“LOGO
            const hasGroupLogo = tempCompletedMembers.some(m => groupLogos.includes(m.toLowerCase()) || groupLogos.includes(m));
            
            // å¦‚æœå½¹ç§åŒ…å«äº‹åŠ¡æ‰€ç‰¹æ®Šå•ä½ï¼Œåˆ™å¿…é¡»åŒæ—¶åŒ…å«å›¢ä½“LOGO
            if (hasOfficeUnit && !hasGroupLogo) {
              meetsOfficeRule = false;
            }
            
            // åªæœ‰ç¬¦åˆè§„åˆ™çš„å½¹ç§æ‰è®¡å…¥æ¨èåˆ†æ•°
            if (meetsOfficeRule) {
              // è®¡ç®—åˆ†æ•°ï¼šå½¹ç§åŠ åˆ† * (å·²å®Œæˆæˆå‘˜æ•° / æ€»æˆå‘˜æ•°)
              const contribution = combination.score * (combination.completedCount / combination.totalMembers);
              score += contribution;
              memberCombinations.push({
                name: combination.name,
                score: combination.score
              });
            }
          }
        });
        
        if (score > 0) {
          memberScores.push({
            name: member,
            score: Math.round(score),
            combinations: memberCombinations
          });
        }
      });
      
      // æŒ‰åˆ†æ•°é™åºæ’åˆ—
      memberScores.sort((a, b) => b.score - a.score);
      
      return memberScores;
    }
    
    // ç”Ÿæˆèƒ¡ç‰Œå»ºè®® - åŸºäºç›®æ ‡èƒ¡ç‰Œç»“æœè®¡ç®—ç§»é™¤å»ºè®®
    function generateWinningSuggestion(combinations) {
      // å®šä¹‰äº‹åŠ¡æ‰€ç‰¹æ®Šå•ä½å’Œå›¢ä½“LOGO
      const officeUnits = ['STAR PRO', 'NEW DIMENSION', 'COSMIC PRODUCTION', 'Rhythm Linkï¼ˆæå­æ—ï¼‰'];
      const groupLogos = ['Undead', 'ALKALOID', 'Crazy:B', 'Eden', 'fine', 'Valkyrie', '2wink', 'MaM', 'Switch', 'Knights', 'DoubleFace'];
      
      // æ‰¾å‡ºæ‰€æœ‰å·²å‡‘é½çš„å½¹ç§
      const completedCombinations = combinations.filter(c => c.isCompleted);
      
      // æ‰¾å‡ºæ‰€æœ‰å·²ä½¿ç”¨çš„æˆå‘˜ï¼ˆåœ¨å·²å‡‘é½å½¹ç§ä¸­çš„æˆå‘˜ï¼‰
      const usedMembers = new Set();
      completedCombinations.forEach(c => {
        c.completedMembers.forEach(member => usedMembers.add(member));
      });
      
      // è®¡ç®—å½“å‰æ€»åˆ†
      const currentScore = completedCombinations.reduce((sum, c) => sum + c.score, 0);
      
      // è¾“å‡ºè°ƒè¯•ä¿¡æ¯
      console.log('å½“å‰é€‰æ‹©çš„æˆå‘˜åˆ—è¡¨:', selectedMembersList);
      console.log('å·²å‡‘é½å½¹ç§ä¸­çš„æˆå‘˜:', Array.from(usedMembers));
      console.log('å½“å‰æ€»åˆ†:', currentScore);
      
      // ç”Ÿæˆæ‰€æœ‰å¯èƒ½çš„ç›®æ ‡èƒ¡ç‰Œæ–¹æ¡ˆ
      const potentialTargets = [];
      
      // 1. æ‰¾å‡ºæ‰€æœ‰å¯ä»¥é€šè¿‡æ·»åŠ æˆå‘˜å®Œæˆçš„å½¹ç§ï¼ŒåŒ…æ‹¬é«˜åˆ†å’Œä½åˆ†
      // ä¼˜å…ˆè€ƒè™‘é«˜åˆ†å½¹ç§ï¼Œä½†ä¹Ÿä¸æ’é™¤ä½åˆ†å½¹ç§
      const allPossibleCombinations = combinations
        .filter(c => !c.isCompleted && !c.isTwoPersonCombination)  // æ’é™¤ä¸¤äººå½¹ç§
        .sort((a, b) => b.score - a.score);
      
      for (const combination of allPossibleCombinations) {
        // æ£€æŸ¥æ˜¯å¦ä¸å·²å‡‘é½å½¹ç§æœ‰æˆå‘˜é‡å 
        const hasOverlap = combination.completedMembers.some(m => usedMembers.has(m));
        
        // è®¡ç®—å½“å‰å½¹ç§ä¸­å·²æœ‰çš„æˆå‘˜
        const existingMembers = combination.completedMembers.filter(m => selectedMembersList.includes(m));
        
        // è®¡ç®—è¿˜éœ€è¦æ·»åŠ çš„æˆå‘˜
        const neededMembers = combination.pendingMembers.filter(m => 
          !selectedMembersList.includes(m) && (!hasOverlap || !usedMembers.has(m))
        );
        
        // è€ƒè™‘éœ€è¦æ·»åŠ 1-3ä¸ªæˆå‘˜çš„æƒ…å†µï¼Œæˆ–è€…éœ€è¦æ›¿æ¢æˆå‘˜çš„æƒ…å†µ
        if ((neededMembers.length > 0 && neededMembers.length <= 3) || hasOverlap) {
          // è®¡ç®—å®Œæˆè¿™ä¸ªå½¹ç§åçš„æ½œåœ¨åˆ†æ•°
          let potentialScore = currentScore;
          if (hasOverlap) {
            // å¦‚æœæœ‰é‡å ï¼Œéœ€è¦æ‰¾åˆ°é‡å çš„å½¹ç§å¹¶å‡å»å…¶åˆ†æ•°
            const overlappingCombinations = completedCombinations.filter(c => 
              c.completedMembers.some(m => combination.completedMembers.includes(m))
            );
            overlappingCombinations.forEach(c => {
              potentialScore -= c.score;
            });
          }
          potentialScore += combination.score;
          
          // æ£€æŸ¥æ˜¯å¦ç¬¦åˆäº‹åŠ¡æ‰€ç‰¹æ®Šå•ä½è§„åˆ™
          let meetsOfficeRule = true;
          if (combination.completedMembers.some(m => officeUnits.includes(m)) &&
              !combination.completedMembers.some(m => groupLogos.includes(m.toLowerCase()) || groupLogos.includes(m))) {
            meetsOfficeRule = false;
          }
          
          if (meetsOfficeRule) {
            potentialTargets.push({
              combination: combination,
              neededMembers: neededMembers,
              potentialScore: potentialScore,
              overlapWithExisting: hasOverlap,
              existingMembers: existingMembers,
              // è®¡ç®—å®Œæˆéš¾åº¦ï¼šéœ€è¦æ·»åŠ çš„æˆå‘˜æ•°é‡
              difficulty: neededMembers.length
            });
          }
        }
      }
      
      // å¦‚æœæ²¡æœ‰æ‰¾åˆ°è¶³å¤Ÿçš„é«˜åˆ†å½¹ç§ç›®æ ‡ï¼Œæ·»åŠ ä½åˆ†å½¹ç§ç›®æ ‡
      if (potentialTargets.length < 3) {
        const lowScoreCombinations = combinations
          .filter(c => !c.isCompleted && !c.isTwoPersonCombination && c.score <= 5)
          .sort((a, b) => b.score - a.score);
        
        for (const combination of lowScoreCombinations) {
          // æ£€æŸ¥æ˜¯å¦ä¸å·²å‡‘é½å½¹ç§æœ‰æˆå‘˜é‡å 
          const hasOverlap = combination.completedMembers.some(m => usedMembers.has(m));
          
          // è®¡ç®—å½“å‰å½¹ç§ä¸­å·²æœ‰çš„æˆå‘˜
          const existingMembers = combination.completedMembers.filter(m => selectedMembersList.includes(m));
          
          // è®¡ç®—è¿˜éœ€è¦æ·»åŠ çš„æˆå‘˜
          const neededMembers = combination.pendingMembers.filter(m => 
            !selectedMembersList.includes(m) && (!hasOverlap || !usedMembers.has(m))
          );
          
          // è€ƒè™‘éœ€è¦æ·»åŠ 1-3ä¸ªæˆå‘˜çš„æƒ…å†µï¼Œæˆ–è€…éœ€è¦æ›¿æ¢æˆå‘˜çš„æƒ…å†µ
          if ((neededMembers.length > 0 && neededMembers.length <= 3) || hasOverlap) {
            // è®¡ç®—å®Œæˆè¿™ä¸ªå½¹ç§åçš„æ½œåœ¨åˆ†æ•°
            let potentialScore = currentScore;
            if (hasOverlap) {
              // å¦‚æœæœ‰é‡å ï¼Œéœ€è¦æ‰¾åˆ°é‡å çš„å½¹ç§å¹¶å‡å»å…¶åˆ†æ•°
              const overlappingCombinations = completedCombinations.filter(c => 
                c.completedMembers.some(m => combination.completedMembers.includes(m))
              );
              overlappingCombinations.forEach(c => {
                potentialScore -= c.score;
              });
            }
            potentialScore += combination.score;
            
            // æ£€æŸ¥æ˜¯å¦ç¬¦åˆäº‹åŠ¡æ‰€ç‰¹æ®Šå•ä½è§„åˆ™
            let meetsOfficeRule = true;
            if (combination.completedMembers.some(m => officeUnits.includes(m)) &&
                !combination.completedMembers.some(m => groupLogos.includes(m.toLowerCase()) || groupLogos.includes(m))) {
              meetsOfficeRule = false;
            }
            
            if (meetsOfficeRule) {
              potentialTargets.push({
                combination: combination,
                neededMembers: neededMembers,
                potentialScore: potentialScore,
                overlapWithExisting: hasOverlap,
                existingMembers: existingMembers,
                // è®¡ç®—å®Œæˆéš¾åº¦ï¼šéœ€è¦æ·»åŠ çš„æˆå‘˜æ•°é‡
                difficulty: neededMembers.length
              });
            }
          }
        }
      }
      
      // æŒ‰æ½œåœ¨åˆ†æ•°é™åºæ’åºï¼ˆé«˜åˆ†ä¼˜å…ˆï¼‰
      potentialTargets.sort((a, b) => b.potentialScore - a.potentialScore);
      
      console.log('æ½œåœ¨çš„èƒ¡ç‰Œç›®æ ‡æ–¹æ¡ˆ:', potentialTargets);
      console.log('æ½œåœ¨ç›®æ ‡æ•°é‡:', potentialTargets.length);
      
      // å¦‚æœæ²¡æœ‰æ½œåœ¨ç›®æ ‡ï¼Œè¾“å‡ºè°ƒè¯•ä¿¡æ¯
      if (potentialTargets.length === 0) {
        console.log('æ²¡æœ‰æ½œåœ¨ç›®æ ‡çš„åŸå› :');
        console.log('å½“å‰å·²é€‰æˆå‘˜:', selectedMembersList);
        console.log('å½“å‰å·²å®Œæˆå½¹ç§:', completedCombinations);
        console.log('æ‰€æœ‰å½¹ç§:', combinations);
      }
      
      // è¾…åŠ©å‡½æ•°ï¼šè®¡ç®—å•ä¸ªç›®æ ‡çš„ç§»é™¤å»ºè®®
      function calculateSuggestion(target) {
        const { combination, neededMembers, overlapWithExisting, existingMembers } = target;
        
        // è®¡ç®—éœ€è¦ç§»é™¤çš„æˆå‘˜æ•°é‡
        // å¦‚æœæœ‰é‡å ï¼Œéœ€è¦ç§»é™¤çš„æˆå‘˜æ•°é‡åº”è¯¥è€ƒè™‘åˆ°é‡å çš„å½¹ç§æˆå‘˜
        // ä½†ç›®å‰çš„é€»è¾‘æ˜¯ï¼šç§»é™¤æ•°é‡ = éœ€è¦æ·»åŠ çš„æˆå‘˜æ•°é‡
        const requiredRemovals = neededMembers.length;
        
        // æ‰¾å‡ºæ‰€æœ‰å¯ä»¥ç§»é™¤çš„æˆå‘˜ï¼Œå¹¶æŒ‰ä¼˜å…ˆçº§æ’åº
        // ä¼˜å…ˆçº§ï¼š
        // 1. æ— ç”¨æˆå‘˜ï¼ˆä¸åœ¨ä»»ä½•å·²å‡‘é½å½¹ç§å’Œç›®æ ‡å½¹ç§ä¸­çš„æˆå‘˜ï¼‰
        // 2. ä¸åœ¨å½“å‰å·²å‡‘é½å½¹ç§ä¸­çš„æˆå‘˜ï¼ˆä½†å¯èƒ½åœ¨ç›®æ ‡å½¹ç§ä¸­ï¼‰
        // 3. åœ¨å·²å‡‘é½å½¹ç§ä¸­ä½†è´¡çŒ®åˆ†æ•°è¾ƒä½çš„æˆå‘˜
        // 4. åœ¨å·²å‡‘é½å½¹ç§ä¸­ä½†é‡å è¾ƒå¤šçš„æˆå‘˜
        
        // 1. è®¡ç®—å„ä¸ªæˆå‘˜çš„é‡è¦æ€§å¾—åˆ†
        const memberImportance = new Map();
        
        // é¦–å…ˆï¼Œä¸ºæ‰€æœ‰æˆå‘˜è®¾ç½®åŸºç¡€åˆ†æ•°
        selectedMembersList.forEach(member => {
          memberImportance.set(member, 0);
        });
        
        // 2. ä¸ºå·²å‡‘é½å½¹ç§ä¸­çš„æˆå‘˜åŠ åˆ†ï¼ˆè´¡çŒ®è¶Šå¤§çš„æˆå‘˜åˆ†æ•°è¶Šé«˜ï¼‰
        completedCombinations.forEach(comb => {
          // å½¹ç§åˆ†æ•°è¶Šé«˜ï¼Œæˆå‘˜çš„é‡è¦æ€§è¶Šé«˜
          const memberWeight = comb.score / comb.completedMembers.length;
          comb.completedMembers.forEach(member => {
            memberImportance.set(member, memberImportance.get(member) + memberWeight);
          });
        });
        
        // 3. ä¸ºç›®æ ‡å½¹ç§ä¸­çš„ç°æœ‰æˆå‘˜é¢å¤–åŠ åˆ†
        existingMembers.forEach(member => {
          memberImportance.set(member, memberImportance.get(member) + 10); // ç›®æ ‡å½¹ç§æˆå‘˜é‡è¦æ€§æ›´é«˜
        });
        
        // 4. è®¡ç®—å¯ç§»é™¤æˆå‘˜åˆ—è¡¨ï¼ŒæŒ‰é‡è¦æ€§ä»ä½åˆ°é«˜æ’åº
        const removableMembers = [...selectedMembersList]
          .sort((a, b) => memberImportance.get(a) - memberImportance.get(b));
        
        // 5. è¿‡æ»¤æ‰ä¸èƒ½ç§»é™¤çš„æˆå‘˜ï¼ˆå¦‚æœç§»é™¤ä¼šå¯¼è‡´å·²å‡‘é½å½¹ç§å…¨éƒ¨å¤±æ•ˆï¼‰
        const safeRemovableMembers = [];
        for (const member of removableMembers) {
          // æ¨¡æ‹Ÿç§»é™¤è¯¥æˆå‘˜åï¼Œæ£€æŸ¥æ˜¯å¦è¿˜æœ‰å·²å‡‘é½å½¹ç§
          const tempMembers = selectedMembersList.filter(m => m !== member);
          const remainingCombinations = completedCombinations.filter(c => 
            c.completedMembers.every(m => tempMembers.includes(m))
          );
          
          // åªæœ‰å½“ç§»é™¤è¯¥æˆå‘˜åä»æœ‰å·²å‡‘é½å½¹ç§ï¼Œæˆ–è€…è¯¥æˆå‘˜æ˜¯æ— ç”¨æˆå‘˜æ—¶ï¼Œæ‰å…è®¸ç§»é™¤
          if (remainingCombinations.length > 0 || memberImportance.get(member) === 0) {
            safeRemovableMembers.push(member);
          }
        }
        
        console.log(`ç›®æ ‡å½¹ç§${combination.name}çš„å¯ç§»é™¤æˆå‘˜:`, safeRemovableMembers);
        
        // æ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿçš„å¯ç§»é™¤æˆå‘˜
        if (safeRemovableMembers.length >= requiredRemovals) {
          // é€‰æ‹©é‡è¦æ€§æœ€ä½çš„requiredRemovalsä¸ªæˆå‘˜ç§»é™¤
          const membersToRemove = safeRemovableMembers.slice(0, requiredRemovals);
          
          // æ¨¡æ‹Ÿæ›¿æ¢åçš„æˆå‘˜åˆ—è¡¨
          let tempMembers = [...selectedMembersList];
          
          // ç§»é™¤æˆå‘˜
          membersToRemove.forEach(member => {
            const index = tempMembers.indexOf(member);
            if (index !== -1) {
              tempMembers.splice(index, 1);
            }
          });
          
          // æ·»åŠ éœ€è¦çš„æˆå‘˜
          tempMembers = [...tempMembers, ...neededMembers];
          
          // éªŒè¯æ˜¯å¦èƒ½å®Œæˆç›®æ ‡å½¹ç§
          const canComplete = combination.completedMembers.every(m => tempMembers.includes(m));
          
          if (canComplete) {
            // è®¡ç®—è°ƒæ•´åçš„åˆ†æ•°
            let newScore = currentScore;
            if (overlapWithExisting) {
              // å¦‚æœæœ‰é‡å ï¼Œéœ€è¦æ‰¾åˆ°é‡å çš„å½¹ç§å¹¶å‡å»å…¶åˆ†æ•°
              const overlappingCombinations = completedCombinations.filter(c => 
                c.completedMembers.some(m => combination.completedMembers.includes(m))
              );
              overlappingCombinations.forEach(c => {
                newScore -= c.score;
              });
            }
            newScore += combination.score;
            
            // è®¡ç®—æ›¿æ¢åçš„å½¹ç§ç»„åˆ
            const tempCombinations = [...tempMembers];
            const newCombinations = combinations.filter(c => {
              // æ£€æŸ¥è¯¥å½¹ç§æ˜¯å¦åœ¨æ›¿æ¢åä»ç„¶å®Œæˆ
              if (c.isTwoPersonCombination) return false; // è·³è¿‡ä¸¤äººå½¹ç§
              return c.completedMembers.every(m => tempCombinations.includes(m));
            });
            
            // æ‰¾å‡ºè¢«æ›¿æ¢çš„å½¹ç§
            const replacedCombinations = completedCombinations.filter(c => {
              return !newCombinations.includes(c);
            });
            
            // è®¡ç®—è°ƒæ•´æ¬¡æ•°ï¼šåŒ…å«æœ¬æ¬¡æ›¿æ¢å’Œåç»­å¯èƒ½éœ€è¦çš„è°ƒæ•´
            // æ¯æ¬¡è°ƒæ•´å¯ä»¥æ›¿æ¢ä¸€ä¸ªæˆå‘˜ï¼Œæ›¿æ¢åå¯èƒ½éœ€è¦é¢å¤–è°ƒæ•´æ¥è¾¾æˆæœ€ç»ˆç›®æ ‡
            // è€ƒè™‘åˆ°åç»­å¯èƒ½éœ€è¦çš„é¢å¤–è°ƒæ•´ï¼Œè¿™é‡Œä¼°ç®—æ€»è°ƒæ•´æ¬¡æ•°
            let estimatedTotalAdjustments = requiredRemovals;
            
            // æ¨¡æ‹Ÿæ›¿æ¢åçš„æˆå‘˜åˆ—è¡¨ï¼ˆä½¿ç”¨å·²æœ‰çš„newCombinationså˜é‡ï¼‰
            
            // æ£€æŸ¥æ›¿æ¢åæ˜¯å¦å·²ç»è¾¾æˆèƒœåˆ©æ¡ä»¶ï¼ˆ3ä¸ªå½¹ç§ï¼‰
            const completedAfterReplacement = combinations.filter(c => {
              if (c.isTwoPersonCombination) return false; // è·³è¿‡ä¸¤äººå½¹ç§
              return c.completedMembers.every(m => tempCombinations.includes(m));
            });
            
            // å¦‚æœè¿˜æ²¡æœ‰è¾¾æˆèƒœåˆ©æ¡ä»¶ï¼Œä¼°ç®—è¿˜éœ€è¦çš„é¢å¤–è°ƒæ•´æ¬¡æ•°
            if (completedAfterReplacement.length < 3) {
              // ä¼°ç®—é¢å¤–éœ€è¦çš„è°ƒæ•´æ¬¡æ•°ï¼ˆæ ¹æ®ç¼ºå°‘çš„å½¹ç§æ•°é‡ä¼°ç®—ï¼‰
              const missingCombinations = 3 - completedAfterReplacement.length;
              estimatedTotalAdjustments += missingCombinations * 2; // å‡è®¾æ¯ä¸ªå½¹ç§å¹³å‡éœ€è¦2æ¬¡è°ƒæ•´
            }
            
            // é™åˆ¶æœ€å¤§è°ƒæ•´æ¬¡æ•°ï¼Œé¿å…æ˜¾ç¤ºè¿‡äºå¤æ‚çš„æ•°å€¼
            const adjustmentsNeeded = Math.min(Math.max(1, estimatedTotalAdjustments), 5);
            
            return {
              removeMembers: membersToRemove,
              addMembers: neededMembers,
              newScore: newScore,
              newlyCompletedCombination: combination,
              replaceCombination: replacedCombinations.length > 0 ? replacedCombinations[0].name : undefined,
              difficulty: requiredRemovals, // å®Œæˆéš¾åº¦ï¼šéœ€è¦æ›¿æ¢çš„æˆå‘˜æ•°é‡
              adjustmentsNeeded: adjustmentsNeeded // è¿˜éœ€è°ƒæ•´æ¬¡æ•°ï¼šæ ¹æ®å®é™…éœ€è¦çš„æ›¿æ¢æ¬¡æ•°è®¡ç®—
            };
          }
        }
        
        return null;
      }
      
      // åˆå§‹åŒ–ç»“æœå®¹å™¨
      let optimalSuggestion = null;       // æœ€ä¼˜ç»„åˆï¼ˆæ›´å®¹æ˜“è¾¾æˆï¼‰
      let highestScoreSuggestion = null;  // é«˜åˆ†ç»„åˆï¼ˆåˆ†æ•°æ›´é«˜ï¼‰
      
      // éå†æ¯ä¸ªæ½œåœ¨ç›®æ ‡ï¼Œè®¡ç®—æœ€ä¼˜çš„ç§»é™¤å»ºè®®
      for (const target of potentialTargets) {
        const suggestion = calculateSuggestion(target);
        
        if (suggestion) {
          // æ›´æ–°æœ€ä¼˜ç»„åˆï¼ˆæ›´å®¹æ˜“è¾¾æˆï¼šä¼˜å…ˆè°ƒæ•´æ¬¡æ•°æœ€å°‘ï¼Œå…¶æ¬¡éš¾åº¦æœ€ä½ï¼Œæœ€ååˆ†æ•°æœ€é«˜ï¼‰
          if (!optimalSuggestion) {
            optimalSuggestion = suggestion;
          } else if (suggestion.adjustmentsNeeded < optimalSuggestion.adjustmentsNeeded) {
            optimalSuggestion = suggestion;
          } else if (suggestion.adjustmentsNeeded === optimalSuggestion.adjustmentsNeeded) {
            // å¦‚æœè°ƒæ•´æ¬¡æ•°ç›¸åŒï¼Œé€‰æ‹©éš¾åº¦æœ€ä½çš„
            if (suggestion.difficulty < optimalSuggestion.difficulty) {
              optimalSuggestion = suggestion;
            } else if (suggestion.difficulty === optimalSuggestion.difficulty) {
              // å¦‚æœéš¾åº¦ä¹Ÿç›¸åŒï¼Œé€‰æ‹©åˆ†æ•°æœ€é«˜çš„
              if (suggestion.newScore > optimalSuggestion.newScore) {
                optimalSuggestion = suggestion;
              }
            }
          }
          
          // æ›´æ–°é«˜åˆ†ç»„åˆï¼ˆåˆ†æ•°æœ€é«˜ï¼Œå…¶æ¬¡è°ƒæ•´æ¬¡æ•°æœ€å°‘ï¼‰
          if (!highestScoreSuggestion) {
            highestScoreSuggestion = suggestion;
          } else if (suggestion.newScore > highestScoreSuggestion.newScore) {
            highestScoreSuggestion = suggestion;
          } else if (suggestion.newScore === highestScoreSuggestion.newScore) {
            // å¦‚æœåˆ†æ•°ç›¸åŒï¼Œé€‰æ‹©è°ƒæ•´æ¬¡æ•°æœ€å°‘çš„
            if (suggestion.adjustmentsNeeded < highestScoreSuggestion.adjustmentsNeeded) {
              highestScoreSuggestion = suggestion;
            }
          }
        }
      }
      
      // å¦‚æœæ²¡æœ‰æ‰¾åˆ°å•ä¸ªå½¹ç§æ›¿æ¢æ–¹æ¡ˆï¼Œå°è¯•å¯»æ‰¾å¤šä¸ªå½¹ç§çš„ç»„åˆæ–¹æ¡ˆ
      if (!optimalSuggestion && !highestScoreSuggestion) {
        // å°è¯•å¯»æ‰¾æ‰€æœ‰å¯èƒ½çš„å½¹ç§ç»„åˆï¼Œè€Œä¸ä»…ä»…æ˜¯å•ä¸ªå½¹ç§
        const allPossibleCombinations = combinations
          .filter(c => !c.isCompleted && !c.isTwoPersonCombination)
          .sort((a, b) => b.score - a.score);
        
        // æ£€æŸ¥æ˜¯å¦æœ‰å¯ä»¥é€šè¿‡æ›¿æ¢æˆå‘˜æ¥åŒæ—¶å®Œæˆå¤šä¸ªå½¹ç§çš„æƒ…å†µ
        for (let i = 0; i < allPossibleCombinations.length; i++) {
          for (let j = i + 1; j < allPossibleCombinations.length; j++) {
            const comb1 = allPossibleCombinations[i];
            const comb2 = allPossibleCombinations[j];
            
            // æ£€æŸ¥ä¸¤ä¸ªå½¹ç§æ˜¯å¦æœ‰é‡å æˆå‘˜
            const hasMemberOverlap = comb1.completedMembers.some(m => comb2.completedMembers.includes(m));
            if (hasMemberOverlap) continue;
            
            // è®¡ç®—éœ€è¦æ·»åŠ çš„æˆå‘˜
            const neededMembers1 = comb1.pendingMembers.filter(m => !selectedMembersList.includes(m));
            const neededMembers2 = comb2.pendingMembers.filter(m => !selectedMembersList.includes(m));
            const totalNeededMembers = [...new Set([...neededMembers1, ...neededMembers2])];
            
            // è€ƒè™‘æ›¿æ¢3ä¸ªä»¥å†…æˆå‘˜çš„æƒ…å†µ
            if (totalNeededMembers.length > 0 && totalNeededMembers.length <= 3) {
              // ç¡®å®šéœ€è¦ä¿ç•™çš„æˆå‘˜ï¼šå·²å‡‘é½å½¹ç§ä¸­çš„æˆå‘˜ + ä¸¤ä¸ªç›®æ ‡å½¹ç§ä¸­çš„ç°æœ‰æˆå‘˜
              const membersToKeep = new Set(usedMembers);
              const existingMembers1 = comb1.completedMembers.filter(m => selectedMembersList.includes(m));
              const existingMembers2 = comb2.completedMembers.filter(m => selectedMembersList.includes(m));
              existingMembers1.forEach(m => membersToKeep.add(m));
              existingMembers2.forEach(m => membersToKeep.add(m));
              
              // æ‰¾å‡ºå¯ç§»é™¤çš„æˆå‘˜
              const removableMembers = selectedMembersList.filter(m => !membersToKeep.has(m));
              
              if (removableMembers.length >= totalNeededMembers.length) {
                // é€‰æ‹©å‰totalNeededMembers.lengthä¸ªå¯ç§»é™¤æˆå‘˜
                const membersToRemove = removableMembers.slice(0, totalNeededMembers.length);
                
                // æ¨¡æ‹Ÿæ›¿æ¢åçš„æˆå‘˜åˆ—è¡¨
                let tempMembers = [...selectedMembersList];
                
                // ç§»é™¤æˆå‘˜
                membersToRemove.forEach(member => {
                  const index = tempMembers.indexOf(member);
                  if (index !== -1) {
                    tempMembers.splice(index, 1);
                  }
                });
                
                // æ·»åŠ éœ€è¦çš„æˆå‘˜
                tempMembers = [...tempMembers, ...totalNeededMembers];
                
                // éªŒè¯æ˜¯å¦èƒ½å®Œæˆä¸¤ä¸ªç›®æ ‡å½¹ç§
                const canComplete1 = comb1.completedMembers.every(m => tempMembers.includes(m));
                const canComplete2 = comb2.completedMembers.every(m => tempMembers.includes(m));
                
                if (canComplete1 && canComplete2) {
                  // è®¡ç®—å®é™…çš„æ–°åˆ†æ•°ï¼ˆè€ƒè™‘å¯èƒ½çš„ç»„åˆï¼‰
                  // é‡æ–°è®¡ç®—æ‰€æœ‰å¯èƒ½çš„å½¹ç§ç»„åˆ
                  const newCombinations = combinations.filter(c => {
                    // æ£€æŸ¥è¯¥å½¹ç§æ˜¯å¦åœ¨æ›¿æ¢åä»ç„¶å®Œæˆ
                    if (c.isTwoPersonCombination) return false; // è·³è¿‡ä¸¤äººå½¹ç§
                    return c.completedMembers.every(m => tempMembers.includes(m));
                  });
                  
                  // æ‰¾å‡ºä¸é‡å çš„å½¹ç§ç»„åˆï¼Œæœ€å¤š3ä¸ªï¼Œä»¥è·å–æœ€å¤§åˆ†æ•°
                  const optimalNewCombinations = findOptimalCombinations(newCombinations);
                  
                  // è®¡ç®—æ–°åˆ†æ•°
                  const newScore = optimalNewCombinations.reduce((sum, c) => sum + c.score, 0);
                  
                  // æ‰¾å‡ºè¢«æ›¿æ¢çš„å½¹ç§
                  const replacedCombinations = completedCombinations.filter(c => {
                    return !newCombinations.includes(c);
                  });
                  
                  // åˆ›å»ºå»ºè®®å¯¹è±¡
                  const suggestion = {
                    removeMembers: membersToRemove,
                    addMembers: totalNeededMembers,
                    newScore: newScore,
                    newlyCompletedCombination: comb1,  // è¿”å›ç¬¬ä¸€ä¸ªå½¹ç§ä½œä¸ºä¸»è¦å»ºè®®
                    additionalCompletedCombination: comb2,  // è¿”å›ç¬¬äºŒä¸ªå½¹ç§ä½œä¸ºé¢å¤–ä¿¡æ¯
                    replaceCombination: replacedCombinations.length > 0 ? "éƒ¨åˆ†ç°æœ‰å½¹ç§" : undefined,
                    difficulty: totalNeededMembers.length // å®Œæˆéš¾åº¦ï¼šéœ€è¦æ›¿æ¢çš„æˆå‘˜æ•°é‡
                  };
                  
                  // æ›´æ–°æœ€ä¼˜ç»„åˆï¼ˆæ›´å®¹æ˜“è¾¾æˆï¼šéš¾åº¦æœ€ä½ï¼‰
                  if (!optimalSuggestion || suggestion.difficulty < optimalSuggestion.difficulty) {
                    optimalSuggestion = suggestion;
                  }
                  
                  // æ›´æ–°é«˜åˆ†ç»„åˆï¼ˆåˆ†æ•°æœ€é«˜ï¼‰
                  if (!highestScoreSuggestion || suggestion.newScore > highestScoreSuggestion.newScore) {
                    highestScoreSuggestion = suggestion;
                  }
                }
              }
            }
          }
        }
      }
      
      // æ„å»ºè¿”å›ç»“æœï¼ŒåŒ…å«ä¸¤å¥—æ–¹æ¡ˆ
      const result = {};
      
      if (optimalSuggestion) {
        result.optimal = optimalSuggestion;
      }
      
      if (highestScoreSuggestion) {
        result.highScore = highestScoreSuggestion;
      }
      
      // å¦‚æœä¸¤å¥—æ–¹æ¡ˆç›¸åŒï¼Œåˆ™åªè¿”å›ä¸€å¥—
      if (result.optimal && result.highScore && 
          JSON.stringify(result.optimal) === JSON.stringify(result.highScore)) {
        console.log('ä¸¤å¥—æ–¹æ¡ˆç›¸åŒï¼Œåªè¿”å›ä¸€å¥—');
        return result.optimal;
      }
      
      console.log('æœ€ç»ˆè¿”å›ç»“æœ:', result);
      console.log('æ˜¯å¦æœ‰æœ€ä¼˜å»ºè®®:', !!result.optimal);
      console.log('æ˜¯å¦æœ‰é«˜åˆ†å»ºè®®:', !!result.highScore);
      
      return Object.keys(result).length > 0 ? result : null;
    }
    
    // æ¸²æŸ“ç»“æœ
    function renderResults(combinations) {
      resultsContainer.innerHTML = combinations
        .map(combination => `
          <div class="bg-white rounded-xl shadow-md p-6 card-hover">
            <div class="flex justify-between items-center mb-4">
              <div>
                <h3 class="text-xl font-bold text-gray-800">${escapeHtml(combination.name)}</h3>
                <div class="flex items-center mt-1">
                  <span class="bg-gray-100 text-gray-800 px-2 py-1 rounded-full text-xs">${escapeHtml(combination.category)}</span>
                  <span class="bg-primary/10 text-primary px-2 py-1 rounded-full text-xs ml-2">+${combination.score}åˆ†</span>
                </div>
              </div>
              <div class="bg-primary/10 text-primary px-3 py-1 rounded-full text-sm">
                å·²å‡‘ ${combination.completedCount}/${combination.totalMembers} äºº
              </div>
            </div>
            
            <div class="mb-4">
              <h4 class="text-sm font-medium text-gray-700 mb-2">æˆå‘˜åˆ—è¡¨:</h4>
              <div class="flex flex-wrap">
                ${combination.completedMembers.map(member => 
                  `<span class="member-tag member-tag-completed">${escapeHtml(member)}</span>`
                ).join('')}
                ${combination.pendingMembers.map(member => 
                  `<span class="member-tag member-tag-pending">${escapeHtml(member)}</span>`
                ).join('')}
              </div>
            </div>
            
            <div class="flex justify-between items-center">
              <div>
                <span class="text-sm font-medium text-gray-700">è¿˜éœ€: </span>
                <span class="text-sm ${combination.pendingMembers.length > 0 ? 'text-neutral' : 'text-success'}">
                  ${combination.pendingMembers.length > 0 
                    ? `${combination.pendingMembers.length} äºº (${combination.pendingMembers.map(member => escapeHtml(member)).join(', ')})` 
                    : 'å·²å‡‘é½ï¼'}
                </span>
              </div>
              ${combination.isCompleted ? `
                <div class="bg-success/20 text-success px-3 py-1 rounded-full text-sm font-medium">
                  âœ“ å·²å‡‘é½
                </div>
              ` : ''}
            </div>
          </div>
        `)
        .join('');
      
      resultsSection.classList.remove('hidden');
    }
    
    // æ›´æ–°è¿›åº¦
    function updateProgress(combinations) {
      // æ‰¾å‡ºæ‰€æœ‰å·²å‡‘é½çš„å½¹ç§
      const allCompletedCombinations = combinations.filter(c => c.isCompleted);
      
      // è®¡ç®—ä¸é‡å¤æˆå‘˜çš„å½¹ç§ç»„åˆ
      const optimalCombinations = findOptimalCombinations(allCompletedCombinations);
      const count = optimalCombinations.length;
      const percentage = Math.min(100, Math.round((count / 3) * 100));
      
      completedCount.textContent = count;
      progressPercentage.textContent = `${percentage}%`;
      
      // æ›´æ–°è¿›åº¦ç¯
      const circumference = 2 * Math.PI * 45;
      const offset = circumference - (percentage / 100) * circumference;
      progressCircle.style.strokeDashoffset = offset;
      
      progressSection.classList.remove('hidden');
      
      // æ£€æŸ¥æ˜¯å¦è¾¾æˆèƒœåˆ©æ¡ä»¶ï¼ˆ3ä¸ªä¸é‡å¤æˆå‘˜çš„å½¹ç§ï¼‰
      if (count >= 3) {
        // è®¡ç®—èƒ¡ç‰ŒåŸºç¡€åˆ†æ•°ï¼ˆ3ä¸ªéä¸¤äººå½¹ç§çš„æ€»åˆ†ï¼‰
        const baseScore = optimalCombinations.reduce((sum, c) => sum + c.score, 0);
        
        // è®¡ç®—ä¸¤äººå½¹ç§çš„åŠ åˆ†ï¼ˆæ‰€æœ‰å·²å®Œæˆçš„ä¸¤äººå½¹ç§çš„æ€»åˆ†ï¼‰
        const twoPersonBonus = allCompletedCombinations
          .filter(c => c.isTwoPersonCombination)
          .reduce((sum, c) => sum + c.score, 0);
        
        // è®¡ç®—æ€»åˆ†æ•°
        const totalScore = baseScore + twoPersonBonus;
        
        // ä¿å­˜èƒ¡ç‰Œæ•°æ®åˆ°localStorage
        saveWinningData(optimalCombinations, allCompletedCombinations, totalScore);
        
        // æ›´æ–°èƒœåˆ©æ¨¡æ€æ¡†çš„å†…å®¹
        const victoryContent = victoryModal.querySelector('.text-center');
        victoryContent.innerHTML = `
          <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-success/20 text-success text-3xl mb-4">
            <i class="fa fa-trophy"></i>
          </div>
          <h2 class="text-3xl font-bold text-gray-800 mb-2">æ­å–œï¼</h2>
          <p class="text-xl text-gray-600 mb-6">å·²è¾¾æˆèƒœåˆ©æ¡ä»¶ï¼</p>
          <p class="text-gray-500 mb-6">ä½ å·²æˆåŠŸå‡‘é½ 3 ä¸ªå½¹ç§ï¼ˆæ¯ä¸ªå½¹ç§è‡³å°‘3äººï¼Œä¸”å½¹ç§é—´äººå‘˜æ— é‡å ï¼‰</p>
          <div class="bg-gray-100 rounded-xl p-6 mb-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">å¾—åˆ†è¯¦æƒ…</h3>
            <div class="flex justify-between items-center mb-2">
              <span class="text-gray-600">åŸºç¡€èƒ¡ç‰Œåˆ†æ•°</span>
              <span class="text-lg font-bold text-primary">${baseScore} åˆ†</span>
            </div>
            ${twoPersonBonus > 0 ? `
            <div class="flex justify-between items-center mb-2">
              <span class="text-gray-600">ä¸¤äººå½¹ç§åŠ åˆ†</span>
              <span class="text-lg font-bold text-success">+${twoPersonBonus} åˆ†</span>
            </div>
            <div class="border-t border-gray-300 my-3"></div>
            ` : ''}
            <div class="flex justify-between items-center">
              <span class="text-gray-800 font-semibold">æ€»åˆ†æ•°</span>
              <span class="text-2xl font-bold text-primary">${totalScore} åˆ†</span>
            </div>
          </div>
          <div class="flex justify-center gap-4">
            <button id="close-victory-modal" class="bg-primary hover:bg-primary/90 text-white font-medium px-6 py-2 rounded-lg transition-all">
              ç»§ç»­æ¸¸æˆ
            </button>
            <button id="undo-hand-btn" class="bg-secondary hover:bg-secondary/90 text-white font-medium px-6 py-2 rounded-lg transition-all">
              <i class="fa fa-undo mr-1"></i> æ’¤å›è‡³ä¸Šä¸€æ­¥
            </button>
          </div>
        `;
        
        // é‡æ–°ç»‘å®šå…³é—­æŒ‰é’®äº‹ä»¶
        const closeBtn = document.getElementById('close-victory-modal');
        closeBtn.addEventListener('click', function() {
          victoryModal.classList.add('hidden');
        });
        
        // ç»‘å®šæ’¤å›æŒ‰é’®äº‹ä»¶
        const undoHandBtn = document.getElementById('undo-hand-btn');
        undoHandBtn.addEventListener('click', function() {
          // æ¢å¤åˆ°ä¸Šä¸€æ¬¡æ“ä½œçš„çŠ¶æ€
          if (historyStates.length > 0) {
            // æ¢å¤åˆ°ä¸Šä¸€æ¬¡æ‰‹ç‰ŒçŠ¶æ€
            selectedMembersList = historyStates.pop();
            renderSelectedMembers();
            
            // éšè—èƒœåˆ©æ¨¡æ€æ¡†
            victoryModal.classList.add('hidden');
            
            // é‡æ–°æœç´¢å½¹ç§ç»„åˆ
            search();
            
            // ç¡®ä¿æ’¤é”€æŒ‰é’®æ­£ç¡®æ˜¾ç¤º
            const undoBtn = document.getElementById('undo-button');
            if (undoBtn) {
              if (historyStates.length > 0) {
                undoBtn.classList.remove('hidden');
              } else {
                undoBtn.classList.add('hidden');
              }
            }
          }
        });
        
        // ä¿å­˜èƒ¡ç‰Œæ•°æ®åˆ°localStorage
        saveWinningData(optimalCombinations, allCompletedCombinations, totalScore);
        
        // æ˜¾ç¤ºèƒœåˆ©æç¤º
        victoryModal.classList.remove('hidden');
      }
    }
    
    // ä¿å­˜èƒ¡ç‰Œæ•°æ®åˆ°localStorage
    function saveWinningData(optimalCombinations, allCompletedCombinations, totalScore) {
      // è·å–ç°æœ‰çš„èƒ¡ç‰Œæ•°æ®
      let winningData = JSON.parse(localStorage.getItem('winningStatistics')) || {
        yakuCounts: {}, // æ¯ä¸ªå½¹ç§çš„èƒ¡ç‰Œæ¬¡æ•°
        allWins: [], // æ‰€æœ‰èƒ¡ç‰Œè®°å½•
        totalWins: 0 // æ€»èƒ¡ç‰Œæ¬¡æ•°
      };
      
      // æ›´æ–°å½¹ç§èƒ¡ç‰Œæ¬¡æ•°
      optimalCombinations.forEach(yaku => {
        // å¯¹äºå¤§å‹å½¹ç§çš„å°ç»„ï¼Œä½¿ç”¨åŸå§‹å½¹ç§åç§°è¿›è¡Œç»Ÿè®¡
        const yakuName = yaku.originalName || yaku.name;
        if (winningData.yakuCounts[yakuName]) {
          winningData.yakuCounts[yakuName]++;
        } else {
          winningData.yakuCounts[yakuName] = 1;
        }
      });
      
      // ä¿å­˜å®Œæ•´çš„èƒ¡ç‰Œè®°å½•
      const winRecord = {
        id: Date.now(),
        timestamp: new Date().toISOString(),
        mainYaku: optimalCombinations.map(yaku => ({
          name: yaku.originalName || yaku.name,
          score: yaku.score
        })),
        bonusYaku: allCompletedCombinations.filter(yaku => !optimalCombinations.some(main => 
          (main.originalName || main.name) === (yaku.originalName || yaku.name)
        )).map(yaku => ({
          name: yaku.originalName || yaku.name,
          score: yaku.score
        })),
        totalScore: totalScore,
        selectedMembers: [...selectedMembersList] // èƒ¡ç‰Œæ—¶çš„æ‰‹ç‰Œ
      };
      
      winningData.allWins.push(winRecord);
      winningData.totalWins++;
      
      // ä¿å­˜åˆ°localStorage
      localStorage.setItem('winningStatistics', JSON.stringify(winningData));
    }
    
    // æ‰¾å‡ºä¸é‡å¤æˆå‘˜çš„æœ€ä¼˜ç»„åˆ
    function findOptimalCombinations(combinations) {
      // å®šä¹‰äº‹åŠ¡æ‰€ç‰¹æ®Šå•ä½å’Œå¯¹åº”çš„å›¢ä½“LOGO
      const officeUnits = ['STAR PRO', 'NEW DIMENSION', 'COSMIC PRODUCTION', 'Rhythm Linkï¼ˆæå­æ—ï¼‰'];
      const groupLogos = ['Undead', 'ALKALOID', 'Crazy:B', 'Eden', 'fine', 'Valkyrie', '2wink', 'MaM', 'Switch', 'Knights', 'DoubleFace'];
      
      // ç­›é€‰å‡ºéä¸¤äººå½¹ç§çš„å·²å®Œæˆå½¹ç§ï¼ˆä¸¤äººå½¹ç§ä¸èƒ½ç›´æ¥å‚ä¸èƒ¡ç‰Œï¼‰
      const nonTwoPersonCombinations = combinations.filter(c => !c.isTwoPersonCombination);
      
      // ç”Ÿæˆæ‰€æœ‰å¯èƒ½çš„3äººç»„åˆ
      function generateCombinations(arr, k) {
        function combine(subset, start) {
          if (subset.length === k) {
            result.push([...subset]);
            return;
          }
          for (let i = start; i < arr.length; i++) {
            subset.push(arr[i]);
            combine(subset, i + 1);
            subset.pop();
          }
        }
        const result = [];
        combine([], 0);
        return result;
      }
      
      // æ‰©å±•å¤§å‹å½¹ç§ï¼ˆ6äººæˆ–ä»¥ä¸Šï¼‰ä¸ºå¤šä¸ªå°ç»„
      const expandedCombinations = [];
      for (const combination of nonTwoPersonCombinations) {
        // ä½¿ç”¨å½¹ç§å®šä¹‰çš„æ€»æˆå‘˜æ•°æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦åˆ†ç»„
        // ä½†äº‹åŠ¡æ‰€Unitç±»å‹çš„å½¹ç§ä¸èƒ½æ‹†åˆ†ï¼Œå¿…é¡»ä¿æŒå®Œæ•´
        if (combination.totalMembers >= 6 && combination.category !== 'äº‹åŠ¡æ‰€Unit') {
          // è·å–å½¹ç§å®šä¹‰çš„æ‰€æœ‰æœ‰æ•ˆæˆå‘˜
          const validMembers = combination.members.filter(m => m !== '-');
          
          // ç”Ÿæˆæ‰€æœ‰å¯èƒ½çš„3äººç»„åˆ
          const allThreeMemberCombinations = generateCombinations(validMembers, 3);
          
          // ä¸ºæ¯ä¸ªç»„åˆç”Ÿæˆä¸€ä¸ªæ¡ç›®
          allThreeMemberCombinations.forEach((groupMembers, index) => {
            // æ£€æŸ¥å½“å‰å°ç»„æœ‰å¤šå°‘æˆå‘˜å·²è¢«é€‰æ‹©
            const completedGroupMembers = groupMembers.filter(member => 
              combination.completedMembers.includes(member)
            );
            
            // åªæœ‰å½“å°ç»„ä¸­æ»¡3ä¸ªæˆå‘˜è¢«é€‰æ‹©æ—¶æ‰åŠ å…¥æ‰©å±•åˆ—è¡¨ï¼ˆå‚ä¸èƒ¡ç‰Œçš„ç»„åˆä¸€å®šæ˜¯ä¸‰äººçš„ï¼‰
            if (completedGroupMembers.length >= 3) {
              expandedCombinations.push({
                ...combination,
                originalName: combination.name, // ä¿å­˜åŸå§‹å½¹ç§åç§°ç”¨äºç»Ÿè®¡
                groupName: `${combination.name} (ç»„${index + 1})`, // å°ç»„åç§°ä»…ç”¨äºæ˜¾ç¤º
                completedMembers: completedGroupMembers,
                pendingMembers: groupMembers.filter(member => 
                  !combination.completedMembers.includes(member)
                ),
                totalMembers: groupMembers.length,
                // å°ç»„å®Œæˆæ¡ä»¶ï¼šæ»¡3ä¸ªæˆå‘˜å·²è¢«é€‰æ‹©ä¸”ç¬¦åˆäº‹åŠ¡æ‰€è§„åˆ™
                isCompleted: completedGroupMembers.length >= 3
              });
            }
          });
        } else {
          expandedCombinations.push(combination);
        }
      }

      // æŒ‰åŠ åˆ†é«˜ä½æ’åº
      const sortedCombinations = [...expandedCombinations].sort((a, b) => b.score - a.score);
      
      // ä½¿ç”¨å›æº¯ç®—æ³•å¯»æ‰¾æœ€ä¼˜ç»„åˆ
      let bestCombination = [];
      let bestScore = 0;
      let bestMemberCount = 0;
      
      function backtrack(index, currentCombination, usedMembers) {
        // è®¡ç®—å½“å‰ç»„åˆçš„æ€»åˆ†å’Œæˆå‘˜æ•°
        const totalScore = currentCombination.reduce((sum, c) => sum + c.score, 0);
        const totalMembers = usedMembers.size;
        
        // å¦‚æœå½“å‰ç»„åˆå·²ç»è¾¾åˆ°3ä¸ªå½¹ç§ï¼Œæ£€æŸ¥æ˜¯å¦æ˜¯æœ€ä¼˜è§£
        if (currentCombination.length === 3) {
          // ä¼˜å…ˆé€‰æ‹©æ€»åˆ†é«˜çš„ç»„åˆï¼Œå…¶æ¬¡é€‰æ‹©æˆå‘˜æ•°å¤šçš„ç»„åˆ
          if (totalScore > bestScore || 
              (totalScore === bestScore && totalMembers > bestMemberCount)) {
            bestScore = totalScore;
            bestMemberCount = totalMembers;
            bestCombination = [...currentCombination];
          }
          return;
        }
        
        // å¦‚æœå·²ç»éå†å®Œæ‰€æœ‰å½¹ç§ï¼Œæ£€æŸ¥å½“å‰ç»„åˆæ˜¯å¦æ¯”å·²æœ‰æœ€ä¼˜è§£æ›´å¥½
        if (index >= sortedCombinations.length) {
          if (currentCombination.length > 0 && 
              (totalScore > bestScore || 
               (totalScore === bestScore && totalMembers > bestMemberCount))) {
            bestScore = totalScore;
            bestMemberCount = totalMembers;
            bestCombination = [...currentCombination];
          }
          return;
        }
        
        // å°è¯•ä¸é€‰æ‹©å½“å‰å½¹ç§
        backtrack(index + 1, currentCombination, usedMembers);
        
        // å°è¯•é€‰æ‹©å½“å‰å½¹ç§ï¼ˆå¦‚æœæˆå‘˜ä¸é‡å¤ä¸”ç¬¦åˆç‰¹æ®Šè§„åˆ™ï¼‰
        const currentCombinationMembers = new Set();
        sortedCombinations[index].completedMembers.forEach(member => {
          currentCombinationMembers.add(member);
        });
        
        // æ£€æŸ¥æ˜¯å¦æœ‰é‡å¤æˆå‘˜
        let hasDuplicate = false;
        for (const member of currentCombinationMembers) {
          if (usedMembers.has(member)) {
            hasDuplicate = true;
            break;
          }
        }
        
        // æ£€æŸ¥æ˜¯å¦ç¬¦åˆäº‹åŠ¡æ‰€ç‰¹æ®Šå•ä½è§„åˆ™
        let followsOfficeRule = true;
        const hasOfficeUnit = Array.from(currentCombinationMembers).some(member => 
          officeUnits.includes(member)
        );
        const hasGroupLogo = Array.from(currentCombinationMembers).some(member => 
          groupLogos.includes(member)
        );
        
        // å¦‚æœå½¹ç§åŒ…å«äº‹åŠ¡æ‰€ç‰¹æ®Šå•ä½ï¼Œåˆ™å¿…é¡»åŒæ—¶åŒ…å«å›¢ä½“LOGO
        if (hasOfficeUnit && !hasGroupLogo) {
          followsOfficeRule = false;
        }
        
        if (!hasDuplicate && followsOfficeRule) {
          // æ·»åŠ å½“å‰å½¹ç§çš„æˆå‘˜åˆ°å·²ä½¿ç”¨é›†åˆ
          const newUsedMembers = new Set(usedMembers);
          currentCombinationMembers.forEach(member => {
            newUsedMembers.add(member);
          });
          
          // é€’å½’è°ƒç”¨
          backtrack(index + 1, [...currentCombination, sortedCombinations[index]], newUsedMembers);
        }
      }
      
      // å¼€å§‹å›æº¯
      backtrack(0, [], new Set());
      
      // å¦‚æœæ²¡æœ‰æ‰¾åˆ°ç»„åˆï¼Œå°è¯•æ‰¾å•ä¸ªå½¹ç§
      if (bestCombination.length === 0 && sortedCombinations.length > 0) {
        return [sortedCombinations[0]];
      }
      
      return bestCombination;
    }
    
    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
      console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–...');
      
      // æå–æ‰€æœ‰æˆå‘˜
      allMembers = extractAllMembers();
      console.log('æå–åˆ°', allMembers.size, 'ä¸ªæˆå‘˜');
      
      // è®¾ç½®æˆå‘˜è¾“å…¥åŠŸèƒ½
      setupMemberInput();
      
      // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
      setupEventListeners();
      
      console.log('åˆå§‹åŒ–å®Œæˆï¼');
    });
    
    // å…¨å±€é”™è¯¯å¤„ç†
    window.addEventListener('error', function(e) {
      console.error('å…¨å±€é”™è¯¯:', e.error);
      console.error('é”™è¯¯ä½ç½®:', e.filename, e.lineno, e.colno);
      console.error('é”™è¯¯æ¶ˆæ¯:', e.message);
    });
  </script>
  
  <!-- æ¸¸æˆè§„åˆ™æ¨¡æ€æ¡† -->
  <div id="rules-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-xl shadow-xl p-6 max-w-3xl w-full max-h-[90vh] overflow-y-auto mx-4 animate-slide-up">
      <div class="flex justify-between items-start mb-6">
        <h2 class="text-2xl font-bold text-gray-800">æ¸¸æˆè§„åˆ™è¯´æ˜</h2>
        <button id="close-rules-modal" class="text-gray-500 hover:text-gray-700 text-xl">
          <i class="fa fa-times"></i>
        </button>
      </div>
      
      <div class="space-y-6 text-gray-700">
        <section>
          <h3 class="text-xl font-semibold text-primary mb-3">å¼€å§‹å‰çš„å‡†å¤‡</h3>
          <div class="space-y-4 pl-4">
            <div>
              <h4 class="font-medium text-lg mb-2">1. å†³å®šåº„å®¶</h4>
              <ul class="list-disc pl-6 space-y-1">
                <li>é€šè¿‡ çŒœæ‹³ å†³å®šè°æ˜¯åº„å®¶ã€‚</li>
                <li>æ¯å±€æ¸¸æˆç»“æŸåï¼Œåº„å®¶é¡ºæ—¶é’ˆè½®æ¢ä¸€æ¬¡ã€‚</li>
              </ul>
            </div>
            
            <div>
              <h4 class="font-medium text-lg mb-2">2. æ‘†ç‰Œ</h4>
              <ul class="list-disc pl-6 space-y-1">
                <li>æ‰€æœ‰çš„ç‰ŒèƒŒé¢æœä¸‹æ´—åŒ€ã€‚å››äººå›´åæˆæ–¹å½¢ã€‚</li>
                <li>æ¯äººé¢å‰éƒ½è¦æ‘†å‡ºä¸¤å±‚çš„"ç‰Œå±±"ï¼š</li>
                <li class="list-none pl-6">- åº„å®¶ï¼šä¸€å±‚11å¼  Ã— 2æ’ï¼ˆå…±22å¼ ï¼‰</li>
                <li class="list-none pl-6">- å…¶ä½™ä¸‰äººï¼šä¸€å±‚10å¼  Ã— 2æ’ï¼ˆå…±20å¼ ï¼‰</li>
              </ul>
            </div>
            
            <div>
              <h4 class="font-medium text-lg mb-2">3. åˆ†ç‰Œ</h4>
              <ul class="list-disc pl-6 space-y-1">
                <li>ä»åº„å®¶å³è¾¹å¼€å§‹ï¼Œåº„å®¶èµ·é¡ºæ—¶é’ˆæ–¹å‘ï¼Œæ¯æ¬¡ç»™æ¯ä½ç©å®¶å‘2å¼ ç‰Œã€‚</li>
                <li>é™¤åº„å®¶å¤–æ¯äººå…±æ”¶åˆ°8å¼ ç‰Œï¼Œåº„å®¶æ”¶åˆ°9å¼ ç‰Œã€‚</li>
                <li>æ‰€æœ‰ç©å®¶æŠŠæ‰‹ç‰Œç†å¥½ï¼Œä¸è¦è®©åˆ«äººçœ‹åˆ°ã€‚</li>
              </ul>
            </div>
          </div>
        </section>
        
        <hr class="border-gray-200">
        
        <section>
          <h3 class="text-xl font-semibold text-primary mb-3">è·èƒœæ–¹å¼</h3>
          <p class="mb-2">æ¸¸æˆç›®æ ‡æ˜¯é€šè¿‡æ‘¸ç‰Œä¸æ¢ç‰Œï¼Œä½¿è‡ªå·±çš„ 9å¼ æ‰‹ç‰Œ ç»„æˆå¦‚ä¸‹ç‰¹å®šçš„ç‰Œå‹ã€‚</p>
          <div class="space-y-4 pl-4">
            <div>
              <h4 class="font-medium text-lg mb-2">1. äº‹åŠ¡æ‰€ç»„åˆ</h4>
              <p>9å¼ ç‰Œå…¨éƒ¨å±äºåŒä¸€äº‹åŠ¡æ‰€ï¼ˆå«äº‹åŠ¡æ‰€Logoã€ç»„åˆLogoåŠè¯¥äº‹åŠ¡æ‰€æˆå‘˜ï¼‰ã€‚</p>
            </div>
            
            <div>
              <h4 class="font-medium text-lg mb-2">2. Unitç»„åˆ</h4>
              <p>9å¼ ç‰Œç»„æˆã€Œ3+3+3ã€çš„ç»“æ„ã€‚</p>
              <p>æ¯ç»„ä¸‰å¼ ä¸ºä¸€ç»„ï¼ˆç§°ä¸º"ã‚»ãƒƒãƒˆ"ï¼‰ï¼Œ1ã‚»ãƒƒãƒˆå¯ä»¥æ˜¯ï¼š</p>
              <ul class="list-disc pl-6 space-y-1">
                <li>èƒŒæ™¯è‰²ç›¸åŒï¼ˆåŒä¸€ç»„åˆæˆ–åŒ…å«è¯¥ç»„åˆLogoï¼‰</li>
                <li>æˆ– äº‹åŠ¡æ‰€Logo + è¯¥äº‹åŠ¡æ‰€æ‰€å±å¶åƒï¼ˆå›¢ä½“Logoï¼‰</li>
              </ul>
            </div>
          </div>
        </section>
        
        <hr class="border-gray-200">
        
        <section>
          <h3 class="text-xl font-semibold text-primary mb-3">æ¸¸æˆæµç¨‹</h3>
          <div class="space-y-4 pl-4">
            <div>
              <h4 class="font-medium text-lg mb-2">1. ç”±åº„å®¶å…ˆå‡ºç‰Œ</h4>
              <ul class="list-disc pl-6">
                <li>å› ä¸ºåº„å®¶æœ‰9å¼ æ‰‹ç‰Œï¼Œæ‰€ä»¥ç¬¬ä¸€å›åˆè¦å…ˆæ‰“å‡º1å¼ ç‰Œ</li>
              </ul>
            </div>
            
            <div>
              <h4 class="font-medium text-lg mb-2">2. æŒ‰é¡ºæ—¶é’ˆè½®æµæ‘¸ç‰Œä¸å‡ºç‰Œ</h4>
              <ul class="list-disc pl-6">
                <li>ä»åº„å®¶å¼€å§‹ï¼Œæ¯ä½ç©å®¶ä»ç‰Œå±±æ‘¸1å¼ ï¼Œç„¶åå†ä¸¢1å¼ ä¸è¦çš„ç‰Œã€‚</li>
              </ul>
            </div>
            
            <div>
              <h4 class="font-medium text-lg mb-2">3. å¼ƒç‰Œåœº</h4>
              <ul class="list-disc pl-6">
                <li>æ‰€æœ‰æ‰“å‡ºçš„ç‰Œæ”¾åœ¨è‡ªå·±é¢å‰å·¦ä¾§ï¼Œä»é‡Œåˆ°å¤–ä¾æ¬¡æ’åˆ—ã€‚</li>
              </ul>
            </div>
            
            <div>
              <h4 class="font-medium text-lg mb-2">4. å¬ç‰Œ</h4>
              <div>
                <h5 class="font-medium mb-1">â‘  å¬ç‰Œï¼ˆãƒªãƒ¼ãƒï¼‰</h5>
                <ul class="list-disc pl-6">
                  <li>å½“åªå·®ä¸€ç»„å³å¯è·èƒœæ—¶ï¼Œå¯å®£å¸ƒ"ãƒªãƒ¼ãƒï¼"</li>
                </ul>
              </div>
              <div>
                <h5 class="font-medium mb-1">â‘¡ ãƒªãƒ¼ãƒè§„åˆ™</h5>
                <ul class="list-disc pl-6">
                  <li>ä¸¢å‡ºæœ€å1å¼ ä¸è¦çš„ç‰Œåï¼Œå°†è¿™å¼ ç‰Œæ¨ªæ”¾è¡¨ç¤ºå¬ç‰ŒçŠ¶æ€ã€‚</li>
                  <li>å®£å¸ƒãƒªãƒ¼ãƒåï¼Œæ‰‹ç‰Œä¸å¾—æ›´æ¢ï¼Œåªèƒ½ã€æ‘¸ä¸€å¼ ã€å‡ºä¸€å¼ ã€‘ã€‚</li>
                  <li>è‹¥æ‘¸åˆ°æˆ–åˆ«äººæ‰“å‡ºä½ æ‰€ç¼ºçš„é‚£å¼ ç‰Œï¼Œå°±å¯ç«‹å³"ãƒ‰ãƒ³ã‚¸ãƒ£ãƒ©ï¼"ã€‚</li>
                </ul>
              </div>
            </div>
            
            <div>
              <h4 class="font-medium text-lg mb-2">4. å®£å¸ƒ"ãƒ‰ãƒ³ã‚¸ãƒ£ãƒ©ï¼"</h4>
              <ul class="list-disc pl-6">
                <li>å½“ç©å®¶å‡‘é½èƒœåˆ©ç‰Œå‹æ—¶ï¼Œå¤§å–Š"ãƒ‰ãƒ³ã‚¸ãƒ£ãƒ©ï¼"</li>
                <li>ç¿»å¼€è‡ªå·±çš„æ‰‹ç‰Œï¼Œè®©å…¶ä»–ç©å®¶ç¡®è®¤ã€‚</li>
              </ul>
            </div>
          </div>
        </section>
        
        <hr class="border-gray-200">
        
        <section>
          <h3 class="text-xl font-semibold text-primary mb-3">ç‰¹åˆ«è§„åˆ™</h3>
          <div class="space-y-4 pl-4">
            <div>
              <h4 class="font-medium text-lg mb-2">1. ã‚ˆã“ã©ã‚Šï¼ˆæŠ¢ç‰Œï¼‰</h4>
              <ul class="list-disc pl-6">
                <li>å½“ä¸Šå®¶æ‰“å‡ºçš„ç‰Œèƒ½è®©ä½ å®Œæˆä¸€ç»„æ—¶ï¼Œå¯å–Šã‚ˆã“ã©ã‚Šï¼</li>
                <li>æŠŠé‚£å¼ ç‰Œæ‹¿èµ°ï¼Œä¸è‡ªå·±æ‰‹ä¸­2å¼ ç‰Œç»„æˆ1ç»„ï¼Œæ­£é¢æœä¸Šæ”¾åœ¨å³æ‰‹è¾¹ã€‚</li>
                <li>ç„¶åå‡º1å¼ ä¸è¦çš„ç‰Œã€‚æ­¤å±€ä¸å†æ‘¸ç‰Œï¼Œä¿æŒæ‰‹ç‰Œ8å¼ ã€‚</li>
              </ul>
            </div>
            
            <div>
              <h4 class="font-medium text-lg mb-2">2. ç‰¹æ®Šç‰Œ</h4>
              <ul class="list-disc pl-6">
                <li>NPCç‰Œå¸¦æœ‰ç‰¹æ®Šæ•ˆæœï¼Œæ‰“å‡ºè¯¥ç‰Œæ—¶ï¼Œå¯ä»¥å‘åŠ¨å¯¹åº”çš„ç‰¹æ®Šèƒ½åŠ›ï¼Œå…·ä½“å¦‚ä¸‹ï¼šï¼ˆç©å®¶å¯è‡ªç”±å†³å®šæ˜¯å¦åŠ å…¥è¯¥åŠŸèƒ½ï¼‰</li>
                <li>ä½è´ºç¾é˜µï¼šé€‰æ‹©ä¸€åå…¶ä»–ç©å®¶ï¼Œè®©è¯¥ç©å®¶ä¸‹ä¸€å›åˆä¼‘æ¯</li>
                <li>é—¨ç« è‡£ï¼šå¯ä»¥æŠŠè‡ªå·±ä¸€å¼ æ‰“å‡ºçš„ç‰Œä¸æ‰‹æŒçš„ä¸€å¼ ç‰Œäº¤æ¢</li>
                <li>å†°é¹°è¯šçŸ¢ï¼šä¸‹ä¸€å›åˆå¯ç¿»é¢ï¼ˆä¸å…¬å¸ƒæ˜¯ä»€ä¹ˆï¼‰æ‰“å‡ºä¸€å¼ ç‰Œï¼Œä¸”è¿™å¼ ç‰Œä¸èƒ½è¢«å¤ºèµ°ï¼ˆåƒï¼‰</li>
                <li>å®ˆé—¨äººï¼šæŒ‡å®šä¸€åç©å®¶ï¼Œç›²é€‰è¯¥ç©å®¶çš„ä¸¤å¼ æ‰‹ç‰Œå’Œè¯¥ç©å®¶æ‰“å‡ºçš„ä¸¤å¼ ç‰Œäº¤æ¢</li>
                <li>é»‘æ ¹ï¼šè‡ªå·±é€‰æ‹©æœ€å¤šä¸‰å¼ æ‰‹ç‰Œæ‰“å‡ºï¼Œå¹¶å†åœ¨ç‰Œå±±ä¸­æ‘¸ç‰Œï¼Œç›´åˆ°æ‰‹ç‰Œæ‘¸æ»¡8å¼ </li>
                <li>NicePï¼šå¯ä»¥ä»æ‰€æœ‰ç©å®¶æ‰“å‡ºçš„ç‰Œä¸­é€‰æ‹©ä¸€å¼ ç‰Œä¸è‡ªå·±çš„ç‰Œäº¤æ¢</li>
                <li>å°åŠ¨ç‰©ç‰Œï¼šæŠŠè‡ªå·±çš„ä¸€å¼ æ‰‹ç‰Œå˜æˆä¸‡èƒ½ç‰Œ</li>
              </ul>
            </div>
          </div>
        </section>
      </div>
      
      <div class="mt-8 text-center">
        <button id="confirm-rules-btn" class="bg-primary hover:bg-primary/90 text-white font-medium px-6 py-2 rounded-lg transition-all">
          æˆ‘çŸ¥é“äº†
        </button>
      </div>
    </div>
  </div>
  
  <!-- æ¸¸æˆè§„åˆ™æ¨¡æ€æ¡† -->
  <div id="rules-modal" class="fixed inset-0 z-50 flex items-center justify-center hidden">
    <div class="absolute inset-0 bg-black/50" id="modal-backdrop"></div>
    <div class="relative bg-white rounded-xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto p-6 animate-fade-in">
      <div class="flex justify-between items-start mb-4">
        <h2 class="text-2xl font-bold text-gray-800">æ¸¸æˆè§„åˆ™</h2>
        <button id="close-rules-modal" class="text-gray-500 hover:text-gray-700 text-xl">
          <i class="fa fa-times"></i>
        </button>
      </div>
      
      <!-- æ¸¸æˆè§„åˆ™å†…å®¹ -->
      <div class="space-y-6">
        <div>
          <h3 class="text-xl font-semibold text-gray-700 mb-3">å¼€å§‹å‰çš„å‡†å¤‡</h3>
          <ul class="list-disc pl-6 space-y-2 text-gray-600">
            <li><strong>å†³å®šåº„å®¶ï¼š</strong>é€šè¿‡æ·éª°å­å†³å®šåˆå§‹åº„å®¶ï¼Œä¹‹åæ¯å±€è½®æ¢</li>
            <li><strong>æ‘†ç‰Œï¼š</strong>å°†144å¼ éº»å°†ç‰ŒæŒ‰ç…§ç‰¹å®šè§„åˆ™æ‘†æ”¾æˆå±±å½¢</li>
            <li><strong>åˆ†ç‰Œï¼š</strong>æ¯ä½ç©å®¶å¼€å§‹æ—¶è·å¾—13å¼ æ‰‹ç‰Œ</li>
          </ul>
        </div>
        
        <div>
          <h3 class="text-xl font-semibold text-gray-700 mb-3">è·èƒœæ–¹å¼</h3>
          <ul class="list-disc pl-6 space-y-2 text-gray-600">
            <li><strong>äº‹åŠ¡æ‰€ç»„åˆï¼š</strong>å‡‘é½åŒäº‹åŠ¡æ‰€çš„ç‰¹å®šè§’è‰²ç»„åˆ</li>
            <li><strong>Unitç»„åˆï¼š</strong>å‡‘é½åŒUnitçš„ç‰¹å®šè§’è‰²ç»„åˆ</li>
          </ul>
        </div>
        
        <div>
          <h3 class="text-xl font-semibold text-gray-700 mb-3">æ¸¸æˆæµç¨‹</h3>
          <ul class="list-disc pl-6 space-y-2 text-gray-600">
            <li><strong>å‡ºç‰Œï¼š</strong>ç©å®¶è½®æµå‡ºä¸€å¼ æ‰‹ç‰Œåˆ°ç‰Œæ± </li>
            <li><strong>æ‘¸ç‰Œï¼š</strong>ä»ç‰Œå±±æ‘¸ä¸€å¼ ç‰Œè¡¥å……æ‰‹ç‰Œ</li>
            <li><strong>å¬ç‰Œï¼š</strong>æ‰‹ç‰Œæ¥è¿‘èƒ¡ç‰ŒçŠ¶æ€æ—¶å¯å®£å¸ƒå¬ç‰Œ</li>
            <li><strong>å®£å¸ƒèƒœåˆ©ï¼š</strong>å½“æ‰‹ç‰Œæ»¡è¶³èƒ¡ç‰Œæ¡ä»¶æ—¶å®£å¸ƒèƒœåˆ©</li>
          </ul>
        </div>
        
        <div>
          <h3 class="text-xl font-semibold text-gray-700 mb-3">ç‰¹åˆ«è§„åˆ™</h3>
          <ul class="list-disc pl-6 space-y-2 text-gray-600">
            <li><strong>æŠ¢ç‰Œï¼š</strong>ç‰¹å®šæƒ…å†µä¸‹å¯ä»¥æŠ¢å…¶ä»–ç©å®¶æ‰“å‡ºçš„ç‰Œ</li>
            <li><strong>ç‰¹æ®Šç‰Œæ•ˆæœï¼š</strong>æŸäº›è§’è‰²ç‰Œå…·æœ‰ç‰¹æ®Šæ•ˆæœï¼Œä¼šå½±å“æ¸¸æˆè¿›ç¨‹</li>
          </ul>
        </div>
      </div>
      
      <div class="mt-6 text-center">
        <button id="confirm-rules-btn" class="bg-primary hover:bg-primary/90 text-white font-medium px-6 py-2 rounded-lg transition-all">
          æˆ‘çŸ¥é“äº†
        </button>
      </div>
    </div>
  </div>

  <script>
    // æ¸¸æˆè§„åˆ™æ¨¡æ€æ¡†æ§åˆ¶
    document.addEventListener('DOMContentLoaded', function() {
      const rulesBtn = document.getElementById('rule-btn'); // ä¿®æ­£IDä¸ºrule-btn
      const rulesModal = document.getElementById('rules-modal');
      const closeRulesModal = document.getElementById('close-rules-modal');
      const confirmRulesBtn = document.getElementById('confirm-rules-btn');
      const modalBackdrop = document.getElementById('modal-backdrop');
      
      // æ˜¾ç¤ºè§„åˆ™æ¨¡æ€æ¡†
      rulesBtn.addEventListener('click', function() {
        rulesModal.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
      });
      
      // éšè—è§„åˆ™æ¨¡æ€æ¡†
      function hideRulesModal() {
        rulesModal.classList.add('hidden');
        document.body.style.overflow = 'auto';
      }
      
      closeRulesModal.addEventListener('click', hideRulesModal);
      confirmRulesBtn.addEventListener('click', hideRulesModal);
      modalBackdrop.addEventListener('click', hideRulesModal);
      
      // ESCé”®å…³é—­æ¨¡æ€æ¡†
      document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape' && !rulesModal.classList.contains('hidden')) {
          hideRulesModal();
        }
      });
    });
  </script>

  <script>
  // æ³¨å†ŒService Worker
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('./service-worker.js')
        .then(registration => {
          console.log('ServiceWorker æ³¨å†ŒæˆåŠŸ:', registration.scope);
        })
        .catch(error => {
          console.log('ServiceWorker æ³¨å†Œå¤±è´¥:', error);
        });
    });
  }
</script>
  
  <!-- è¿”å›é¡¶éƒ¨/åº•éƒ¨æ¼‚æµ®çª— -->
  <div class="fixed right-4 bottom-4 flex flex-col gap-2 z-50 opacity-20 hover:opacity-100 transition-opacity duration-300">
    <button id="scrollToTop" class="bg-primary text-white rounded-full p-3 shadow-lg hover:bg-primary/90 transition-colors duration-300">
      <i class="fas fa-arrow-up"></i>
    </button>
    <button id="scrollToBottom" class="bg-primary text-white rounded-full p-3 shadow-lg hover:bg-primary/90 transition-colors duration-300">
      <i class="fas fa-arrow-down"></i>
    </button>
  </div>
  
  <script>
    // è¿”å›é¡¶éƒ¨/åº•éƒ¨åŠŸèƒ½
    document.getElementById('scrollToTop').addEventListener('click', function() {
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
    });
    
    document.getElementById('scrollToBottom').addEventListener('click', function() {
      window.scrollTo({
        top: document.body.scrollHeight,
        behavior: 'smooth'
      });
    });
  </script>
</body>
</html>