<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ESéº»å°†å½¹ç§æŸ¥è¯¢åŠ©æ‰‹</title>
  <!-- Tailwind CSS v3 -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome -->
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <!-- å¼•å…¥æ•°æ®æ–‡ä»¶ -->
  <script src="data.js"></script>
  <!-- PWAç›¸å…³æ ‡ç­¾ -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#4a5568">
<meta name="description" content="å¶åƒæ¢¦å¹»ç¥­éº»å°†èƒ¡ç‰ŒåŠ©æ‰‹">
<meta name="author" content="Aruai">
<meta name="publisher" content="Aruai">

<!-- iOSæ”¯æŒ -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="ESéº»å°†èƒ¡ç‰ŒåŠ©æ‰‹">
<link rel="apple-touch-icon" href="./es_mahjong_url.png">
<link rel="apple-touch-icon" href="./es_mahjong_url.png" sizes="180x180">

<!-- å¼•å…¥manifest -->
<link rel="manifest" href="./manifest.json">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#7e22ce', // ç´«è‰²
            secondary: '#3b82f6', // è“è‰²
            success: '#16a34a', // ç»¿è‰²
            danger: '#dc2626', // çº¢è‰²
            neutral: '#64748b', // ç°è‰²
            dark: '#1e293b',
            light: '#f8fafc'
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
          },
          animation: {
            'fade-in': 'fadeIn 0.5s ease-in-out',
            'slide-up': 'slideUp 0.5s ease-in-out',
            'pulse-success': 'pulseSuccess 2s infinite',
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' },
            },
            slideUp: {
              '0%': { transform: 'translateY(20px)', opacity: '0' },
              '100%': { transform: 'translateY(0)', opacity: '1' },
            },
            pulseSuccess: {
              '0%, 100%': { backgroundColor: '#16a34a' },
              '50%': { backgroundColor: '#22c55e' },
            }
          }
        }
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .scrollbar-hide::-webkit-scrollbar {
        display: none;
      }
      .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      .card-hover {
        transition: all 0.3s ease;
      }
      .card-hover:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      }
      .member-tag {
        @apply px-2 py-1 rounded-full text-xs mr-1 mb-1;
      }
      .member-tag-completed {
        @apply bg-success/20 text-success;
      }
      .member-tag-pending {
        @apply bg-neutral/20 text-neutral;
      }
    }
  </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen">
  <div class="container mx-auto px-4 py-8 max-w-5xl">
    <!-- æ ‡é¢˜åŒºåŸŸ -->
    <header class="mb-8">
      <div class="flex items-center justify-between mb-2">
        <!-- æ¸¸æˆè§„åˆ™æŒ‰é’® -->
        <button id="rule-btn" class="bg-secondary hover:bg-secondary/90 text-white font-medium px-4 py-2 rounded-lg transition-all flex items-center">
          <i class="fa fa-info-circle mr-2"></i> æ¸¸æˆè§„åˆ™
        </button>
        <!-- å ä½å…ƒç´ ä¿æŒæ ‡é¢˜å±…ä¸­ -->
        <div class="w-[140px]"></div>
      </div>
      <div class="text-center">
        <div class="flex items-center justify-center mb-2">
          <img src="./es_mahjong_yz.png" alt="ESéº»å°†åŠ©æ‰‹" class="h-12 w-12 mr-3">
          <h1 class="text-4xl font-bold text-gray-800">ESéº»å°†å½¹ç§æŸ¥è¯¢åŠ©æ‰‹</h1>
        </div>
        <p class="text-gray-600">å¸®åŠ©ä½ å¿«é€ŸæŸ¥è¯¢å’Œç­›é€‰è§’è‰²ä¹‹é—´çš„ç»„åˆå…³ç³»ï¼Œä¼˜åŒ–æ‰‹ç‰Œç­–ç•¥</p>
         <p class="text-gray-600">ä½¿ç”¨æ–¹æ³•ï¼šåœ¨æœç´¢æ¡†å†…è¾“å…¥æˆå‘˜åç§°å…³é”®è¯-ç‚¹å‡»åç§°å°†å…¶æ·»åŠ åˆ°æ‰‹ç‰Œæ± ï¼ˆè‡³å°‘åŠ å…¥ 1 äººï¼‰-ç‚¹å‡»æŸ¥è¯¢æŒ‰é’®</p>
         <p class="text-gray-600">æ‰‹ç‰Œæ›´æ–°æ—¶å†æ¬¡ç‚¹å‡»æŸ¥è¯¢ï¼Œå³å¯è·å¾—æ–°çš„æ‰‹ç‰Œæ¨è</p>
        <p class="text-sm text-primary mt-2">èƒ¡ç‰Œæ¡ä»¶ï¼šæ¯ä¸ªå½¹ç§éœ€å‡‘å¤Ÿå…¶ä¸­çš„ä¸‰å¼ ç‰Œä¸”è¦å‡‘é½ä¸‰ä¸ªå½¹ç§ï¼Œå½¹ç§é—´äººå‘˜æ— é‡å </p>
      </div>
    </header>

    <!-- è¾“å…¥åŒºåŸŸ -->
    <section class="bg-white rounded-xl shadow-md p-6 mb-8">
      <h2 class="text-xl font-bold text-gray-800 mb-4">é€‰æ‹©æˆå‘˜</h2>
      <div class="relative">
        <div class="flex items-end">
          <div class="relative flex-1">
            <input type="text" id="member-input" placeholder="è¾“å…¥æˆå‘˜åç§°..." class="w-full px-4 py-2 pr-10 bg-white/80 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
            <button id="add-member-btn" type="button" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-primary hover:text-primary/80">
              <i class="fa fa-plus-circle"></i>
            </button>
            <div id="suggestions" class="absolute z-10 w-full bg-white border border-gray-300 rounded-lg shadow-lg mt-1 max-h-60 overflow-y-auto scrollbar-hide hidden"></div>
          </div>
          <button id="search-btn" class="bg-primary hover:bg-primary/90 text-white font-medium px-6 py-2 rounded-lg transition-all flex items-center justify-center ml-2">
            <i class="fa fa-search mr-2"></i> æŸ¥è¯¢
          </button>
        </div>
      </div>
      <p class="text-xs text-gray-500 mt-1">è¯·ç¡®ä¿è¾“å…¥çš„è§’è‰²åç§°ä¸æ•°æ®åº“ä¸­çš„æ ¼å¼ä¸€è‡´ï¼Œä¾‹å¦‚"å¤©åŸç‡éŸ³"è€Œé"å¤©åŸç£·éŸ³"<br>æ³¨æ„ï¼Œè¾“å…¥äº‹åŠ¡æ‰€ç‰Œè‹±æ–‡æ—¶éœ€è¦ä½¿ç”¨å¤§å†™</p>
    </section>

    <!-- å·²é€‰æˆå‘˜æ ‡ç­¾ -->
    <div class="mb-2">
      <h3 class="text-lg font-medium text-gray-700">å½“å‰æ‰‹ç‰Œæ± </h3>
    </div>
    <div id="selected-members" class="mb-4 flex flex-wrap gap-2 min-h-[40px] border border-dashed border-gray-300 rounded-lg p-2"></div>
    <div class="text-right mb-2">
      <span id="selected-count" class="text-sm text-gray-500">å·²é€‰äººæ•°: 0</span>
    </div>
    
    <!-- æ¸…é™¤æŒ‰é’® -->
    <div class="mb-8 text-right">
      <button id="clear-btn" class="text-gray-500 hover:text-gray-700 text-sm flex items-center">
        <i class="fa fa-times-circle mr-1"></i> æ¸…é™¤æ‰€æœ‰
      </button>
    </div>

    <!-- æ¨èæ­é…åŒºåŸŸ -->
    <section id="recommendation-section" class="mb-8 hidden">
      <div class="bg-gradient-to-r from-primary/10 to-secondary/10 rounded-xl shadow-md p-6 animate-fade-in">
        <div class="flex items-start">
          <div class="bg-secondary/20 text-secondary p-3 rounded-full mr-4">
            <i class="fa fa-lightbulb-o text-xl"></i>
          </div>
          <div class="w-full">
            <h2 class="text-xl font-bold text-gray-800 mb-2">æ¨èå½¹ç§</h2>
            
            <!-- å·²å‡‘æˆçš„é…é˜Ÿ -->
            <div id="completed-teams" class="mb-6 hidden">
              <h3 id="completed-teams-title" class="text-lg font-semibold text-success mb-2">ğŸ‰ å·²å‡‘æˆçš„é…é˜Ÿ</h3>
              <div id="completed-teams-content" class="space-y-3"></div>
            </div>
            
            <!-- èƒ¡ç‰Œå»ºè®® -->
            <div id="winning-suggestions" class="mb-6 hidden">
              <h3 class="text-lg font-semibold text-primary mb-2">ğŸ¯ èƒ¡ç‰Œå»ºè®®</h3>
              <div id="winning-suggestions-content" class="space-y-3"></div>
            </div>
            
            <!-- æ¨èæ·»åŠ çš„æˆå‘˜ -->
            <div id="recommended-members">
              <p class="text-gray-600 mb-4">æ ¹æ®ä½ å·²é€‰çš„æˆå‘˜ï¼Œæˆ‘ä»¬æ¨èä»¥ä¸‹æ­é…ä»¥è¾¾æˆæœ€ä½³ç»„åˆï¼š</p>
              <div id="recommendation-content"></div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- å‡‘ç‰Œå»ºè®®åˆ—è¡¨ -->
    <section id="results-section" class="mb-8 hidden">
      <h2 class="text-2xl font-bold text-gray-800 mb-4">å‡‘ç‰Œå»ºè®®</h2>
      <div id="results-container" class="space-y-4"></div>
    </section>

    <!-- èƒœåˆ©è¿›åº¦æç¤º -->
    <section id="progress-section" class="bg-white rounded-xl shadow-md p-6 mb-8 hidden">
      <div class="flex items-center justify-between">
        <div>
          <h2 class="text-xl font-bold text-gray-800">èƒœåˆ©è¿›åº¦</h2>
          <p class="text-gray-600">å·²å‡‘é½ <span id="completed-count" class="font-bold text-success">0</span> / 3 ä¸ªå½¹ç§ï¼ˆæ¯ä¸ªå½¹ç§è‡³å°‘3äººï¼Œä¸”å½¹ç§é—´äººå‘˜æ— é‡å ï¼‰</p>
        </div>
        <div class="w-32 h-32 relative">
          <svg class="w-full h-full" viewBox="0 0 100 100">
            <circle cx="50" cy="50" r="45" fill="none" stroke="#e2e8f0" stroke-width="10"></circle>
            <circle id="progress-circle" cx="50" cy="50" r="45" fill="none" stroke="#16a34a" stroke-width="10" stroke-dasharray="282.74" stroke-dashoffset="282.74" transform="rotate(-90 50 50)"></circle>
          </svg>
          <div class="absolute inset-0 flex items-center justify-center">
            <span id="progress-percentage" class="text-2xl font-bold text-primary">0%</span>
          </div>
        </div>
      </div>
    </section>

    <!-- èƒœåˆ©æç¤ºæ¨¡æ€æ¡† -->
    <div id="victory-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
      <div class="bg-white rounded-xl shadow-xl p-8 max-w-md w-full mx-4 animate-slide-up">
        <div class="text-center">
          <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-success/20 text-success text-3xl mb-4">
            <i class="fa fa-trophy"></i>
          </div>
          <h2 class="text-3xl font-bold text-gray-800 mb-2">æ­å–œï¼</h2>
          <p class="text-xl text-gray-600 mb-6">å·²è¾¾æˆèƒœåˆ©æ¡ä»¶ï¼</p>
          <p class="text-gray-500 mb-6">ä½ å·²æˆåŠŸå‡‘é½ 3 ä¸ªå½¹ç§ï¼ˆæ¯ä¸ªå½¹ç§è‡³å°‘3äººï¼Œä¸”å½¹ç§é—´äººå‘˜æ— é‡å ï¼‰</p>
          <button id="close-victory-modal" class="bg-primary hover:bg-primary/90 text-white font-medium px-6 py-2 rounded-lg transition-all">
            ç»§ç»­æ¸¸æˆ
          </button>
        </div>
      </div>
    </div>

    <!-- æ•°æ®åº“ç®¡ç†é“¾æ¥ -->
    <div class="text-center mb-8">
      <a href="database.html" class="inline-flex items-center justify-center bg-secondary hover:bg-secondary/90 text-white font-medium px-6 py-2 rounded-lg transition-all">
        <i class="fa fa-database mr-2"></i> å½¹ç§æ•°æ®åº“ç®¡ç†
      </a>
    </div>
    
    <!-- åº•éƒ¨ä¿¡æ¯ -->
    <footer class="text-center text-gray-500 text-sm mt-12">
      <p>ESéº»å°†å½¹ç§æŸ¥è¯¢åŠ©æ‰‹ Â© 2025</p>
      <p>åˆ¶ä½œï¼šxhsè´¦å·-yuovoï¼›Github-Aruai</p>
      <p>ç´ æåŠè§„åˆ™æ¥æºï¼šå¶åƒæ¢¦å¹»ç¥­2 & Happy elements K.K</p>
      <p>ç‰¹åˆ«é¸£è°¢ï¼šéº»å‹-å–œæ¬¢æ¶Ÿçº¯çš„å°é»„è€å¸ˆæä¾›çš„è§„åˆ™ä¹¦æ•´ç†</p>
              <p>å°çº¢ä¹¦-10378083769-å¯¹éº»å°†å…¥é—¨ç©æ³•çš„ç¿»è¯‘</p>
    </footer>
  </div>

  <script>
    // å…¨å±€å˜é‡
    let allMembers = new Set();
    let selectedMembersList = [];
    
    // DOMå…ƒç´ 
    const memberInput = document.getElementById('member-input');
    const suggestions = document.getElementById('suggestions');
    const addMemberBtn = document.getElementById('add-member-btn');
    const searchBtn = document.getElementById('search-btn');
    const clearBtn = document.getElementById('clear-btn');
    const selectedMembers = document.getElementById('selected-members');
    const resultsSection = document.getElementById('results-section');
    const resultsContainer = document.getElementById('results-container');
    const progressSection = document.getElementById('progress-section');
    const completedCount = document.getElementById('completed-count');
    const progressCircle = document.getElementById('progress-circle');
    const progressPercentage = document.getElementById('progress-percentage');
    const victoryModal = document.getElementById('victory-modal');
    const closeVictoryModal = document.getElementById('close-victory-modal');
    
    // ä»æ•°æ®ä¸­æå–æ‰€æœ‰å”¯ä¸€æˆå‘˜
    function extractAllMembers() {
      const members = new Set();
      esMahjongData.forEach(combination => {
        combination.members.forEach(member => {
          if (member && member !== '-') {
            members.add(member);
          }
        });
      });
      return members;
    }
    
    // æ·»åŠ æˆå‘˜
    function addMember(member) {
      if (!selectedMembersList.includes(member)) {
        selectedMembersList.push(member);
        renderSelectedMembers();
        console.log('å·²æ·»åŠ æˆå‘˜:', member);
        console.log('å½“å‰å·²é€‰æˆå‘˜åˆ—è¡¨:', selectedMembersList);
      }
    }
    
    // ç§»é™¤æˆå‘˜
    function removeMember(member) {
      selectedMembersList = selectedMembersList.filter(m => m !== member);
      renderSelectedMembers();
      console.log('å·²ç§»é™¤æˆå‘˜:', member);
    }
    
    // æ¸²æŸ“å·²é€‰æˆå‘˜æ ‡ç­¾
    function renderSelectedMembers() {
      console.log('æ¸²æŸ“å·²é€‰æˆå‘˜ï¼Œåˆ—è¡¨é•¿åº¦:', selectedMembersList.length);
      selectedMembers.innerHTML = selectedMembersList
        .map(member => `
          <div class="bg-primary/10 text-primary px-3 py-1 rounded-full text-sm flex items-center">
            ${member}
            <button class="ml-2 text-primary/70 hover:text-primary" onclick="removeMember('${member}')">
              <i class="fa fa-times"></i>
            </button>
          </div>
        `)
        .join('');
      
      // æ›´æ–°å·²é€‰äººæ•°æ˜¾ç¤º
      document.getElementById('selected-count').textContent = `å·²é€‰äººæ•°: ${selectedMembersList.length}`;
    }
    
    // æˆå‘˜è‡ªåŠ¨å®ŒæˆåŠŸèƒ½
    function setupMemberInput() {
      console.log('è®¾ç½®æˆå‘˜è¾“å…¥åŠŸèƒ½...');
      
      // æˆå‘˜è‡ªåŠ¨å®ŒæˆåŠŸèƒ½
      memberInput.addEventListener('input', function() {
        const inputValue = this.value.trim();
        console.log(`è¾“å…¥å†…å®¹: "${inputValue}"`);
        
        // å¦‚æœè¾“å…¥æ¡†ä¸ºç©ºï¼Œéšè—å»ºè®®
        if (!inputValue) {
          suggestions.classList.add('hidden');
          return;
        }
        
        // è¿‡æ»¤åŒ¹é…çš„æˆå‘˜ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰
        const matchedMembers = Array.from(allMembers).filter(member => 
          member.toLowerCase().includes(inputValue.toLowerCase()) && !selectedMembersList.includes(member)
        );
        
        console.log(`æ‰¾åˆ° ${matchedMembers.length} ä¸ªåŒ¹é…çš„æˆå‘˜`);
        
        // æ˜¾ç¤ºå»ºè®®
        if (matchedMembers.length > 0) {
          suggestions.innerHTML = matchedMembers
            .slice(0, 10)
            .map(member => `<div class="px-4 py-2 hover:bg-gray-100 cursor-pointer">${member}</div>`)
            .join('');
          suggestions.classList.remove('hidden');
          
          // æ·»åŠ ç‚¹å‡»äº‹ä»¶
          suggestions.querySelectorAll('div').forEach(item => {
            item.addEventListener('click', function() {
              const memberName = this.textContent.trim();
              console.log('ç‚¹å‡»å»ºè®®é¡¹:', memberName);
              addMember(memberName);
              memberInput.value = '';
              suggestions.classList.add('hidden');
            });
          });
        } else {
          suggestions.innerHTML = '<div class="px-4 py-2 text-gray-500">æœªæ‰¾åˆ°åŒ¹é…çš„æˆå‘˜</div>';
          suggestions.classList.remove('hidden');
        }
      });
      
      // ç‚¹å‡»æ·»åŠ æŒ‰é’®
      if (addMemberBtn) {
        console.log('ç»‘å®šæ·»åŠ æŒ‰é’®äº‹ä»¶...');
        addMemberBtn.addEventListener('click', function() {
          const inputValue = memberInput.value.trim();
          if (inputValue) {
            console.log('ç‚¹å‡»æ·»åŠ æŒ‰é’®:', inputValue);
            // å°è¯•æ·»åŠ è¾“å…¥çš„æˆå‘˜
            if (allMembers.has(inputValue)) {
              addMember(inputValue);
              memberInput.value = '';
              suggestions.classList.add('hidden');
            } else {
              // å°è¯•æŒ‰é€—å·åˆ†éš”æ·»åŠ å¤šä¸ªæˆå‘˜
              const members = inputValue.split(',').map(m => m.trim()).filter(m => m);
              console.log('æŒ‰é€—å·åˆ†éš”çš„æˆå‘˜åˆ—è¡¨:', members);
              members.forEach(member => {
                if (allMembers.has(member)) {
                  addMember(member);
                } else {
                  console.log('æˆå‘˜ä¸å­˜åœ¨:', member);
                }
              });
              memberInput.value = '';
              suggestions.classList.add('hidden');
            }
          }
        });
      }
      
      // å›è½¦é”®è§¦å‘æ·»åŠ æˆå‘˜
      console.log('ç»‘å®šå›è½¦é”®äº‹ä»¶...');
      memberInput.addEventListener('keypress', function(event) {
        if (event.key === 'Enter') {
          const inputValue = this.value.trim();
          if (inputValue) {
            console.log('å›è½¦é”®æ·»åŠ æˆå‘˜:', inputValue);
            // å°è¯•æ·»åŠ è¾“å…¥çš„æˆå‘˜
            if (allMembers.has(inputValue)) {
              addMember(inputValue);
              this.value = '';
            } else {
              // å°è¯•æŒ‰é€—å·åˆ†éš”æ·»åŠ å¤šä¸ªæˆå‘˜
              const members = inputValue.split(',').map(m => m.trim()).filter(m => m);
              console.log('æŒ‰é€—å·åˆ†éš”çš„æˆå‘˜åˆ—è¡¨:', members);
              members.forEach(member => {
                if (allMembers.has(member)) {
                  addMember(member);
                } else {
                  console.log('æˆå‘˜ä¸å­˜åœ¨:', member);
                }
              });
              this.value = '';
            }
          } else {
            search();
          }
        }
      });
      
      // ç‚¹å‡»é¡µé¢å…¶ä»–åœ°æ–¹éšè—å»ºè®®
      document.addEventListener('click', function(event) {
        if (!memberInput.contains(event.target) && !suggestions.contains(event.target) && !addMemberBtn.contains(event.target)) {
          suggestions.classList.add('hidden');
        }
      });
      
      console.log('æˆå‘˜è¾“å…¥åŠŸèƒ½è®¾ç½®å®Œæˆ');
    }
    
    // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
    function setupEventListeners() {
      searchBtn.addEventListener('click', search);
      
      // æ¸…é™¤æŒ‰é’®äº‹ä»¶
      clearBtn.addEventListener('click', function() {
        selectedMembersList = [];
        renderSelectedMembers();
        resultsSection.classList.add('hidden');
        progressSection.classList.add('hidden');
        document.getElementById('recommendation-section').classList.add('hidden');
      });
      
      // å…³é—­èƒœåˆ©æ¨¡æ€æ¡†
      closeVictoryModal.addEventListener('click', function() {
        victoryModal.classList.add('hidden');
      });
    }
    
    // æœç´¢åŠŸèƒ½
    function search() {
      if (selectedMembersList.length === 0) {
        alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªæˆå‘˜');
        return;
      }
      
      // ç­›é€‰åŒ…å«æ‰€é€‰æˆå‘˜çš„å½¹ç§
      const filteredCombinations = esMahjongData.filter(combination => {
        // æ£€æŸ¥å½¹ç§æ˜¯å¦åŒ…å«è‡³å°‘ä¸€ä¸ªæ‰€é€‰æˆå‘˜
        return combination.members.some(member => 
          selectedMembersList.includes(member) && member !== '-'
        );
      });
      
      // ä¸ºæ¯ä¸ªå½¹ç§è®¡ç®—å·²å‡‘é½æˆå‘˜æ•°é‡
      const combinationsWithStatus = filteredCombinations.map(combination => {
        const validMembers = combination.members.filter(m => m !== '-');
        const completedMembers = validMembers.filter(member => 
          selectedMembersList.includes(member)
        );
        const pendingMembers = validMembers.filter(member => 
          !selectedMembersList.includes(member)
        );
        
        // å®šä¹‰äº‹åŠ¡æ‰€ç‰¹æ®Šå•ä½å’Œå¯¹åº”çš„å›¢ä½“LOGO
        const officeUnits = ['STAR PRO', 'NEW DIMENSION', 'COSMIC PRODUCTION', 'Rhythm Linkï¼ˆæå­æ—ï¼‰'];
        const groupLogos = ['Undead', 'ALKALOID', 'Crazy:B', 'Eden', 'fine', 'Valkyrie', '2wink', 'MaM', 'Switch', 'Knights'];
        
        // æ£€æŸ¥äº‹åŠ¡æ‰€ç‰¹æ®Šå•ä½è§„åˆ™
        let meetsOfficeRule = true;
        const hasOfficeUnit = completedMembers.some(member => 
          officeUnits.includes(member)
        );
        const hasGroupLogo = completedMembers.some(member => 
          groupLogos.includes(member)
        );
        
        // å¦‚æœå½¹ç§åŒ…å«äº‹åŠ¡æ‰€ç‰¹æ®Šå•ä½ï¼Œåˆ™å¿…é¡»åŒæ—¶åŒ…å«å›¢ä½“LOGO
        if (hasOfficeUnit && !hasGroupLogo) {
          meetsOfficeRule = false;
        }
        
        return {
          ...combination,
          completedMembers,
          pendingMembers,
          completedCount: completedMembers.length,
          totalMembers: validMembers.length,
          isCompleted: completedMembers.length >= 3 && meetsOfficeRule // ä»…éœ€å‡‘å¤Ÿå…¶ä¸­çš„ä¸‰å¼ ç‰Œï¼Œä¸”ç¬¦åˆç‰¹æ®Šè§„åˆ™
        };
      });
      
      // æŒ‰å·²å‡‘é½æˆå‘˜æ•°é‡é™åºæ’åˆ—ï¼Œç›¸åŒæ•°é‡æŒ‰åŸå§‹é¡ºåº
      combinationsWithStatus.sort((a, b) => {
        if (a.completedCount !== b.completedCount) {
          return b.completedCount - a.completedCount;
        }
        return filteredCombinations.indexOf(a) - filteredCombinations.indexOf(b);
      });
      
      // ç”Ÿæˆæ¨èæ­é…
      generateRecommendations(combinationsWithStatus);
      
      // æ¸²æŸ“ç»“æœ
      renderResults(combinationsWithStatus);
      
      // æ›´æ–°è¿›åº¦
      updateProgress(combinationsWithStatus);
    }
    
    // ç”Ÿæˆæ¨èæ­é…
    function generateRecommendations(combinations) {
      const recommendationSection = document.getElementById('recommendation-section');
      const recommendationContent = document.getElementById('recommendation-content');
      const completedTeams = document.getElementById('completed-teams');
      const completedTeamsContent = document.getElementById('completed-teams-content');
      const recommendedMembers = document.getElementById('recommended-members');
      const winningSuggestions = document.getElementById('winning-suggestions');
      const winningSuggestionsContent = document.getElementById('winning-suggestions-content');
      
      // æ˜¾ç¤ºå·²å‡‘æˆçš„é…é˜Ÿ
      const allCompletedCombinations = combinations.filter(c => c.isCompleted);
      if (allCompletedCombinations.length > 0) {
        // æ‰¾å‡ºä¸é‡å¤æˆå‘˜çš„æœ€ä¼˜ç»„åˆ
        const optimalCombinations = findOptimalCombinations(allCompletedCombinations);
        
        // æ ¹æ®æœ€ä¼˜ç»„åˆæ•°é‡è®¾ç½®æ ‡é¢˜
        const completedTeamsTitle = document.getElementById('completed-teams-title');
        if (optimalCombinations.length === 3) {
          completedTeamsTitle.textContent = 'ğŸ‰ æ­å–œèƒ¡ç‰Œï¼';
        } else {
          completedTeamsTitle.textContent = 'ğŸ‰ å·²å‡‘æˆçš„é…é˜Ÿ';
        }
        
        // æ¸²æŸ“æœ€ä¼˜ç»„åˆï¼ˆæ”¾åœ¨æœ€å‰é¢ï¼‰
        let completedHtml = '';
        
        if (optimalCombinations.length > 0) {
          completedHtml += `
            <div class="bg-gradient-to-r from-success/10 to-success/5 rounded-lg p-4 border border-success/30 mb-4">
              <div class="flex justify-between items-center mb-3">
                <h4 class="font-medium text-success flex items-center">
                  <i class="fa fa-star mr-2"></i> æœ€ä½³ç»„åˆ
                </h4>
                <span class="text-xs bg-success/20 text-success px-2 py-1 rounded-full">
                  æ€»åˆ†: ${optimalCombinations.reduce((sum, c) => sum + c.score, 0)}
                </span>
              </div>
              <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                ${optimalCombinations.map(combination => `
                  <div class="bg-white/70 rounded-lg p-3 border border-success/20">
                    <div class="flex justify-between items-center mb-2">
                      <h5 class="font-medium text-success">${combination.name}</h5>
                      <span class="text-xs bg-success/20 text-success px-2 py-1 rounded-full">
                        ${combination.category} | ${combination.score}åˆ†
                      </span>
                    </div>
                    <div class="flex flex-wrap">
                      ${combination.completedMembers.map(member => 
                        `<span class="member-tag member-tag-completed">${member}</span>`
                      ).join('')}
                    </div>
                  </div>
                `).join('')}
              </div>
            </div>
          `;
        }
        
        // æ¸²æŸ“å…¶ä»–å·²å‡‘æˆçš„å½¹ç§ï¼ˆæ’é™¤æœ€ä¼˜ç»„åˆä¸­å·²åŒ…å«çš„å’Œæˆå‘˜é‡å¤çš„ï¼‰
        // æ”¶é›†æœ€ä¼˜ç»„åˆä¸­å·²ä½¿ç”¨çš„æˆå‘˜
        const usedMembers = new Set();
        optimalCombinations.forEach(combination => {
          combination.completedMembers.forEach(member => usedMembers.add(member));
        });
        
        // è¿‡æ»¤å‡ºä¸åŒ…å«å·²ä½¿ç”¨æˆå‘˜çš„å…¶ä»–å·²å‡‘æˆå½¹ç§
        const otherCompletedCombinations = allCompletedCombinations.filter(c => 
          !optimalCombinations.some(oc => oc.name === c.name) &&
          !c.completedMembers.some(member => usedMembers.has(member))
        );
        
        if (otherCompletedCombinations.length > 0) {
          completedHtml += `
            <div class="space-y-3">
              ${otherCompletedCombinations.map(combination => `
                <div class="bg-white/50 rounded-lg p-4 border border-success/20">
                  <div class="flex justify-between items-center mb-2">
                    <h4 class="font-medium text-success">${combination.name}</h4>
                    <span class="text-xs bg-success/20 text-success px-2 py-1 rounded-full">
                      ${combination.category} | åŠ åˆ†: ${combination.score}
                    </span>
                  </div>
                  <div class="flex flex-wrap">
                    ${combination.completedMembers.map(member => 
                      `<span class="member-tag member-tag-completed">${member}</span>`
                    ).join('')}
                  </div>
                </div>
              `).join('')}
            </div>
          `;
        }
        
        completedTeamsContent.innerHTML = completedHtml;
        completedTeams.classList.remove('hidden');
      } else {
        completedTeams.classList.add('hidden');
      }
      
      // ç”Ÿæˆèƒ¡ç‰Œå»ºè®®ï¼ˆå½“å·²é€‰æˆå‘˜è¾¾åˆ°æˆ–è¶…è¿‡9ä¸ªï¼Œä½†æœªè¾¾æˆèƒœåˆ©æ¡ä»¶æ—¶ï¼‰
      if (selectedMembersList.length >= 9) {
        recommendedMembers.classList.add('hidden');
        
        // æ£€æŸ¥æ˜¯å¦å·²è¾¾æˆèƒœåˆ©æ¡ä»¶
        const optimalCombinations = findOptimalCombinations(allCompletedCombinations);
        
        // å¦‚æœæœªè¾¾æˆèƒœåˆ©æ¡ä»¶ï¼Œç”Ÿæˆèƒ¡ç‰Œå»ºè®®
        if (optimalCombinations.length < 3) {
          const winningSuggestion = generateWinningSuggestion(combinations);
          
          if (winningSuggestion) {
            winningSuggestionsContent.innerHTML = `
              <div class="bg-gradient-to-r from-primary/10 to-primary/5 rounded-lg p-4 border border-primary/30">
                <div class="flex items-center mb-3">
                  <div class="bg-primary/20 text-primary p-2 rounded-full mr-3">
                    <i class="fa fa-exchange"></i>
                  </div>
                  <h4 class="font-medium text-primary">æ›¿æ¢å»ºè®®</h4>
                </div>
                <div class="space-y-3">
                  <div>
                    <p class="text-sm text-gray-600 mb-1">å»ºè®®ç§»é™¤:</p>
                    <div class="flex flex-wrap">
                      ${winningSuggestion.removeMembers.map(member => `
                        <span class="bg-danger/10 text-danger px-2 py-1 rounded-full text-xs mr-1 mb-1 flex items-center">
                          ${member}
                          <i class="fa fa-times-circle ml-1"></i>
                        </span>
                      `).join('')}
                    </div>
                  </div>
                  <div>
                    <p class="text-sm text-gray-600 mb-1">å»ºè®®æŠ“å–:</p>
                    <div class="flex flex-wrap">
                      ${winningSuggestion.addMembers.map(member => `
                        <span class="bg-success/10 text-success px-2 py-1 rounded-full text-xs mr-1 mb-1 flex items-center">
                          ${member}
                          <i class="fa fa-plus-circle ml-1"></i>
                        </span>
                      `).join('')}
                    </div>
                  </div>
                  <p class="text-sm text-gray-500 mt-2">
                    æ›¿æ¢åå¯è¾¾æˆ <span class="font-medium text-primary">${winningSuggestion.newScore}</span> åˆ†çš„èƒ¡ç‰Œç»„åˆ
                  </p>
                </div>
              </div>
            `;
            winningSuggestions.classList.remove('hidden');
          } else {
            winningSuggestions.classList.add('hidden');
          }
        } else {
          winningSuggestions.classList.add('hidden');
        }
      } else {
        // ç”Ÿæˆæ¨èæ·»åŠ çš„æˆå‘˜
        const recommendedMembersList = generateRecommendedMembers(combinations);
        
        if (recommendedMembersList.length > 0) {
          recommendationContent.innerHTML = `
            <div class="space-y-3 mb-3">
              ${recommendedMembersList.slice(0, 5).map(member => `
                <div class="bg-white/50 rounded-lg p-3 border border-secondary/20">
                  <div class="flex items-center justify-between">
                    <span class="bg-secondary/20 text-secondary px-3 py-1 rounded-full text-sm flex items-center">
                      ${member.name}
                      <button class="ml-2 text-secondary/70 hover:text-secondary" onclick="addMember('${member.name}')">
                        <i class="fa fa-plus-circle"></i>
                      </button>
                    </span>
                    <span class="text-xs text-gray-500">æ¨èæŒ‡æ•°: ${member.score}</span>
                  </div>
                  
                  ${member.combinations.length > 0 ? `
                    <div class="mt-2">
                      <p class="text-xs text-gray-500 mb-1">å¯å¸®åŠ©å®Œæˆ:</p>
                      <div class="flex flex-wrap">
                        ${member.combinations.map(combination => `
                          <span class="bg-primary/10 text-primary px-2 py-0.5 rounded-full text-xs mr-1 mb-1">
                            ${combination.name} (${combination.score}åˆ†)
                          </span>
                        `).join('')}
                      </div>
                    </div>
                  ` : ''}
                </div>
              `).join('')}
            </div>
            <p class="text-sm text-gray-500">
              æ·»åŠ è¿™äº›æˆå‘˜å¯ä»¥å¸®åŠ©ä½ æ›´å¿«å‡‘é½é«˜åŠ åˆ†å½¹ç§ï¼ç‚¹å‡»æˆå‘˜æ ‡ç­¾å³å¯å¿«é€Ÿæ·»åŠ ã€‚
            </p>
          `;
        } else {
          recommendationContent.innerHTML = `
            <div class="bg-white/50 rounded-lg p-4 border border-gray-200 text-center">
              <p class="text-gray-600">æš‚æ— æ¨èæˆå‘˜</p>
              <p class="text-sm text-gray-500 mt-1">è¯·å°è¯•é€‰æ‹©æ›´å¤šæˆå‘˜ä»¥è·å–æ¨è</p>
            </div>
          `;
        }
        
        recommendedMembers.classList.remove('hidden');
        winningSuggestions.classList.add('hidden');
      }
      
      recommendationSection.classList.remove('hidden');
    }
    
    // ç”Ÿæˆæ¨èæˆå‘˜
    function generateRecommendedMembers(combinations) {
      // å®šä¹‰äº‹åŠ¡æ‰€ç‰¹æ®Šå•ä½å’Œå›¢ä½“LOGO
      const officeUnits = ['STAR PRO', 'NEW DIMENSION', 'COSMIC PRODUCTION', 'Rhythm Linkï¼ˆæå­æ—ï¼‰'];
      const groupLogos = ['Undead', 'ALKALOID', 'Crazy:B', 'Eden', 'fine', 'Valkyrie', '2wink', 'MaM', 'Switch', 'Knights'];
      
      // æ”¶é›†æ‰€æœ‰å¯èƒ½çš„æˆå‘˜
      const potentialMembers = new Set();
      combinations.forEach(combination => {
        combination.pendingMembers.forEach(member => {
          if (member && member !== '-') {
            potentialMembers.add(member);
          }
        });
      });
      
      // è®¡ç®—æ¯ä¸ªæˆå‘˜çš„æ¨èåˆ†æ•°
      const memberScores = [];
      potentialMembers.forEach(member => {
        let score = 0;
        const memberCombinations = [];
        
        combinations.forEach(combination => {
          // å¦‚æœæˆå‘˜å¯ä»¥å¸®åŠ©å®Œæˆè¿™ä¸ªå½¹ç§
          if (combination.pendingMembers.includes(member) && combination.completedCount >= 2) {
            // æ£€æŸ¥æ˜¯å¦ç¬¦åˆäº‹åŠ¡æ‰€ç‰¹æ®Šå•ä½è§„åˆ™
            let meetsOfficeRule = true;
            
            // ä¸´æ—¶è®¡ç®—æ·»åŠ å½“å‰æˆå‘˜åçš„completedMembers
            const tempCompletedMembers = [...combination.completedMembers, member];
            
            // æ£€æŸ¥æ˜¯å¦åŒ…å«äº‹åŠ¡æ‰€ç‰¹æ®Šå•ä½
            const hasOfficeUnit = tempCompletedMembers.some(m => officeUnits.includes(m));
            // æ£€æŸ¥æ˜¯å¦åŒ…å«å›¢ä½“LOGO
            const hasGroupLogo = tempCompletedMembers.some(m => groupLogos.includes(m.toLowerCase()) || groupLogos.includes(m));
            
            // å¦‚æœå½¹ç§åŒ…å«äº‹åŠ¡æ‰€ç‰¹æ®Šå•ä½ï¼Œåˆ™å¿…é¡»åŒæ—¶åŒ…å«å›¢ä½“LOGO
            if (hasOfficeUnit && !hasGroupLogo) {
              meetsOfficeRule = false;
            }
            
            // åªæœ‰ç¬¦åˆè§„åˆ™çš„å½¹ç§æ‰è®¡å…¥æ¨èåˆ†æ•°
            if (meetsOfficeRule) {
              // è®¡ç®—åˆ†æ•°ï¼šå½¹ç§åŠ åˆ† * (å·²å®Œæˆæˆå‘˜æ•° / æ€»æˆå‘˜æ•°)
              const contribution = combination.score * (combination.completedCount / combination.totalMembers);
              score += contribution;
              memberCombinations.push({
                name: combination.name,
                score: combination.score
              });
            }
          }
        });
        
        if (score > 0) {
          memberScores.push({
            name: member,
            score: Math.round(score),
            combinations: memberCombinations
          });
        }
      });
      
      // æŒ‰åˆ†æ•°é™åºæ’åˆ—
      memberScores.sort((a, b) => b.score - a.score);
      
      return memberScores;
    }
    
    // ç”Ÿæˆèƒ¡ç‰Œå»ºè®®
    function generateWinningSuggestion(combinations) {
      // å®šä¹‰äº‹åŠ¡æ‰€ç‰¹æ®Šå•ä½å’Œå›¢ä½“LOGO
      const officeUnits = ['STAR PRO', 'NEW DIMENSION', 'COSMIC PRODUCTION', 'Rhythm Linkï¼ˆæå­æ—ï¼‰'];
      const groupLogos = ['Undead', 'ALKALOID', 'Crazy:B', 'Eden', 'fine', 'Valkyrie', '2wink', 'MaM', 'Switch', 'Knights'];
      
      // æ‰¾å‡ºæ‰€æœ‰å·²å‡‘é½çš„å½¹ç§
      const completedCombinations = combinations.filter(c => c.isCompleted);
      
      // æ‰¾å‡ºæ‰€æœ‰æ¥è¿‘å‡‘é½çš„å½¹ç§ï¼ˆå·²å‡‘é½2äººï¼‰
      const nearCompletedCombinations = combinations.filter(c => c.completedCount === 2);
      
      // å¦‚æœæœ‰æ¥è¿‘å‡‘é½çš„å½¹ç§ï¼Œå°è¯•æ‰¾å‡ºå¯ä»¥æ›¿æ¢çš„æˆå‘˜
      if (nearCompletedCombinations.length > 0) {
        // æŒ‰åŠ åˆ†é™åºæ’åˆ—
        nearCompletedCombinations.sort((a, b) => b.score - a.score);
        
        // å°è¯•æ¯ä¸ªæ¥è¿‘å‡‘é½çš„å½¹ç§
        for (const combination of nearCompletedCombinations) {
          // éœ€è¦çš„æˆå‘˜
          const neededMember = combination.pendingMembers[0];
          
          // æ£€æŸ¥æ·»åŠ è¿™ä¸ªæˆå‘˜åæ˜¯å¦ç¬¦åˆäº‹åŠ¡æ‰€ç‰¹æ®Šå•ä½è§„åˆ™
          let meetsOfficeRule = true;
          const tempCompletedMembers = [...combination.completedMembers, neededMember];
          const hasOfficeUnit = tempCompletedMembers.some(m => officeUnits.includes(m));
          const hasGroupLogo = tempCompletedMembers.some(m => groupLogos.includes(m.toLowerCase()) || groupLogos.includes(m));
          
          if (hasOfficeUnit && !hasGroupLogo) {
            meetsOfficeRule = false;
          }
          
          // åªæœ‰ç¬¦åˆè§„åˆ™çš„å½¹ç§æ‰ç”Ÿæˆèƒ¡ç‰Œå»ºè®®
          if (meetsOfficeRule) {
            // æ‰¾å‡ºå¯ä»¥ç§»é™¤çš„æˆå‘˜ï¼ˆä¸åœ¨å·²å‡‘é½å½¹ç§ä¸­çš„æˆå‘˜ï¼‰
            const removableMembers = selectedMembersList.filter(member => {
              // æ£€æŸ¥æˆå‘˜æ˜¯å¦åœ¨å·²å‡‘é½çš„å½¹ç§ä¸­
              const inCompletedCombination = completedCombinations.some(c => 
                c.completedMembers.includes(member)
              );
              
              return !inCompletedCombination && !combination.completedMembers.includes(member);
            });
            
            if (removableMembers.length > 0) {
              // è®¡ç®—æ›¿æ¢åçš„æ€»åˆ†
              const currentScore = completedCombinations.reduce((sum, c) => sum + c.score, 0);
              const newScore = currentScore + combination.score;
              
              return {
                removeMembers: [removableMembers[0]],
                addMembers: [neededMember],
                newScore: newScore
              };
            }
          }
        }
      }
      
      return null;
    }
    
    // æ¸²æŸ“ç»“æœ
    function renderResults(combinations) {
      resultsContainer.innerHTML = combinations
        .map(combination => `
          <div class="bg-white rounded-xl shadow-md p-6 card-hover">
            <div class="flex justify-between items-center mb-4">
              <div>
                <h3 class="text-xl font-bold text-gray-800">${combination.name}</h3>
                <div class="flex items-center mt-1">
                  <span class="bg-gray-100 text-gray-800 px-2 py-1 rounded-full text-xs">${combination.category}</span>
                  <span class="bg-primary/10 text-primary px-2 py-1 rounded-full text-xs ml-2">+${combination.score}åˆ†</span>
                </div>
              </div>
              <div class="bg-primary/10 text-primary px-3 py-1 rounded-full text-sm">
                å·²å‡‘ ${combination.completedCount}/${combination.totalMembers} äºº
              </div>
            </div>
            
            <div class="mb-4">
              <h4 class="text-sm font-medium text-gray-700 mb-2">æˆå‘˜åˆ—è¡¨:</h4>
              <div class="flex flex-wrap">
                ${combination.completedMembers.map(member => 
                  `<span class="member-tag member-tag-completed">${member}</span>`
                ).join('')}
                ${combination.pendingMembers.map(member => 
                  `<span class="member-tag member-tag-pending">${member}</span>`
                ).join('')}
              </div>
            </div>
            
            <div class="flex justify-between items-center">
              <div>
                <span class="text-sm font-medium text-gray-700">è¿˜éœ€: </span>
                <span class="text-sm ${combination.pendingMembers.length > 0 ? 'text-neutral' : 'text-success'}">
                  ${combination.pendingMembers.length > 0 
                    ? `${combination.pendingMembers.length} äºº (${combination.pendingMembers.join(', ')})` 
                    : 'å·²å‡‘é½ï¼'}
                </span>
              </div>
              ${combination.isCompleted ? `
                <div class="bg-success/20 text-success px-3 py-1 rounded-full text-sm font-medium">
                  âœ“ å·²å‡‘é½
                </div>
              ` : ''}
            </div>
          </div>
        `)
        .join('');
      
      resultsSection.classList.remove('hidden');
    }
    
    // æ›´æ–°è¿›åº¦
    function updateProgress(combinations) {
      // æ‰¾å‡ºæ‰€æœ‰å·²å‡‘é½çš„å½¹ç§
      const allCompletedCombinations = combinations.filter(c => c.isCompleted);
      
      // è®¡ç®—ä¸é‡å¤æˆå‘˜çš„å½¹ç§ç»„åˆ
      const optimalCombinations = findOptimalCombinations(allCompletedCombinations);
      const count = optimalCombinations.length;
      const percentage = Math.min(100, Math.round((count / 3) * 100));
      
      completedCount.textContent = count;
      progressPercentage.textContent = `${percentage}%`;
      
      // æ›´æ–°è¿›åº¦ç¯
      const circumference = 2 * Math.PI * 45;
      const offset = circumference - (percentage / 100) * circumference;
      progressCircle.style.strokeDashoffset = offset;
      
      progressSection.classList.remove('hidden');
      
      // æ£€æŸ¥æ˜¯å¦è¾¾æˆèƒœåˆ©æ¡ä»¶ï¼ˆ3ä¸ªä¸é‡å¤æˆå‘˜çš„å½¹ç§ï¼‰
      if (count >= 3) {
        // æ˜¾ç¤ºèƒœåˆ©æç¤ºï¼ˆæ¯ä¸ªå½¹ç§ä»…éœ€å‡‘å¤Ÿå…¶ä¸­çš„ä¸‰å¼ ç‰Œï¼Œä¸”å½¹ç§é—´äººå‘˜æ— é‡å ï¼‰
        victoryModal.classList.remove('hidden');
      }
    }
    
    // æ‰¾å‡ºä¸é‡å¤æˆå‘˜çš„æœ€ä¼˜ç»„åˆ
    function findOptimalCombinations(combinations) {
      // å®šä¹‰äº‹åŠ¡æ‰€ç‰¹æ®Šå•ä½å’Œå¯¹åº”çš„å›¢ä½“LOGO
      const officeUnits = ['STAR PRO', 'NEW DIMENSION', 'COSMIC PRODUCTION', 'Rhythm Linkï¼ˆæå­æ—ï¼‰'];
      const groupLogos = ['Undead', 'ALKALOID', 'Crazy:B', 'Eden', 'fine', 'Valkyrie', '2wink', 'MaM', 'Switch', 'Knights'];
      
      // æŒ‰åŠ åˆ†é«˜ä½æ’åº
      const sortedCombinations = [...combinations].sort((a, b) => b.score - a.score);
      
      // ä½¿ç”¨å›æº¯ç®—æ³•å¯»æ‰¾æœ€ä¼˜ç»„åˆ
      let bestCombination = [];
      let bestScore = 0;
      let bestMemberCount = 0;
      
      function backtrack(index, currentCombination, usedMembers) {
        // è®¡ç®—å½“å‰ç»„åˆçš„æ€»åˆ†å’Œæˆå‘˜æ•°
        const totalScore = currentCombination.reduce((sum, c) => sum + c.score, 0);
        const totalMembers = usedMembers.size;
        
        // å¦‚æœå½“å‰ç»„åˆå·²ç»è¾¾åˆ°3ä¸ªå½¹ç§ï¼Œæ£€æŸ¥æ˜¯å¦æ˜¯æœ€ä¼˜è§£
        if (currentCombination.length === 3) {
          // ä¼˜å…ˆé€‰æ‹©æ€»åˆ†é«˜çš„ç»„åˆï¼Œå…¶æ¬¡é€‰æ‹©æˆå‘˜æ•°å¤šçš„ç»„åˆ
          if (totalScore > bestScore || 
              (totalScore === bestScore && totalMembers > bestMemberCount)) {
            bestScore = totalScore;
            bestMemberCount = totalMembers;
            bestCombination = [...currentCombination];
          }
          return;
        }
        
        // å¦‚æœå·²ç»éå†å®Œæ‰€æœ‰å½¹ç§ï¼Œæ£€æŸ¥å½“å‰ç»„åˆæ˜¯å¦æ¯”å·²æœ‰æœ€ä¼˜è§£æ›´å¥½
        if (index >= sortedCombinations.length) {
          if (currentCombination.length > 0 && 
              (totalScore > bestScore || 
               (totalScore === bestScore && totalMembers > bestMemberCount))) {
            bestScore = totalScore;
            bestMemberCount = totalMembers;
            bestCombination = [...currentCombination];
          }
          return;
        }
        
        // å°è¯•ä¸é€‰æ‹©å½“å‰å½¹ç§
        backtrack(index + 1, currentCombination, usedMembers);
        
        // å°è¯•é€‰æ‹©å½“å‰å½¹ç§ï¼ˆå¦‚æœæˆå‘˜ä¸é‡å¤ä¸”ç¬¦åˆç‰¹æ®Šè§„åˆ™ï¼‰
        const currentCombinationMembers = new Set();
        sortedCombinations[index].completedMembers.forEach(member => {
          currentCombinationMembers.add(member);
        });
        
        // æ£€æŸ¥æ˜¯å¦æœ‰é‡å¤æˆå‘˜
        let hasDuplicate = false;
        for (const member of currentCombinationMembers) {
          if (usedMembers.has(member)) {
            hasDuplicate = true;
            break;
          }
        }
        
        // æ£€æŸ¥æ˜¯å¦ç¬¦åˆäº‹åŠ¡æ‰€ç‰¹æ®Šå•ä½è§„åˆ™
        let followsOfficeRule = true;
        const hasOfficeUnit = Array.from(currentCombinationMembers).some(member => 
          officeUnits.includes(member)
        );
        const hasGroupLogo = Array.from(currentCombinationMembers).some(member => 
          groupLogos.includes(member)
        );
        
        // å¦‚æœå½¹ç§åŒ…å«äº‹åŠ¡æ‰€ç‰¹æ®Šå•ä½ï¼Œåˆ™å¿…é¡»åŒæ—¶åŒ…å«å›¢ä½“LOGO
        if (hasOfficeUnit && !hasGroupLogo) {
          followsOfficeRule = false;
        }
        
        if (!hasDuplicate && followsOfficeRule) {
          // æ·»åŠ å½“å‰å½¹ç§çš„æˆå‘˜åˆ°å·²ä½¿ç”¨é›†åˆ
          const newUsedMembers = new Set(usedMembers);
          currentCombinationMembers.forEach(member => {
            newUsedMembers.add(member);
          });
          
          // é€’å½’è°ƒç”¨
          backtrack(index + 1, [...currentCombination, sortedCombinations[index]], newUsedMembers);
        }
      }
      
      // å¼€å§‹å›æº¯
      backtrack(0, [], new Set());
      
      // å¦‚æœæ²¡æœ‰æ‰¾åˆ°ç»„åˆï¼Œå°è¯•æ‰¾å•ä¸ªå½¹ç§
      if (bestCombination.length === 0 && sortedCombinations.length > 0) {
        return [sortedCombinations[0]];
      }
      
      return bestCombination;
    }
    
    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
      console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–...');
      
      // æå–æ‰€æœ‰æˆå‘˜
      allMembers = extractAllMembers();
      console.log('æå–åˆ°', allMembers.size, 'ä¸ªæˆå‘˜');
      
      // è®¾ç½®æˆå‘˜è¾“å…¥åŠŸèƒ½
      setupMemberInput();
      
      // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
      setupEventListeners();
      
      console.log('åˆå§‹åŒ–å®Œæˆï¼');
    });
  </script>
  
  <!-- æ¸¸æˆè§„åˆ™æ¨¡æ€æ¡† -->
  <div id="rules-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-xl shadow-xl p-6 max-w-3xl w-full max-h-[90vh] overflow-y-auto mx-4 animate-slide-up">
      <div class="flex justify-between items-start mb-6">
        <h2 class="text-2xl font-bold text-gray-800">æ¸¸æˆè§„åˆ™è¯´æ˜</h2>
        <button id="close-rules-modal" class="text-gray-500 hover:text-gray-700 text-xl">
          <i class="fa fa-times"></i>
        </button>
      </div>
      
      <div class="space-y-6 text-gray-700">
        <section>
          <h3 class="text-xl font-semibold text-primary mb-3">å¼€å§‹å‰çš„å‡†å¤‡</h3>
          <div class="space-y-4 pl-4">
            <div>
              <h4 class="font-medium text-lg mb-2">1. å†³å®šåº„å®¶</h4>
              <ul class="list-disc pl-6 space-y-1">
                <li>é€šè¿‡ çŒœæ‹³ å†³å®šè°æ˜¯åº„å®¶ã€‚</li>
                <li>æ¯å±€æ¸¸æˆç»“æŸåï¼Œåº„å®¶é¡ºæ—¶é’ˆè½®æ¢ä¸€æ¬¡ã€‚</li>
              </ul>
            </div>
            
            <div>
              <h4 class="font-medium text-lg mb-2">2. æ‘†ç‰Œ</h4>
              <ul class="list-disc pl-6 space-y-1">
                <li>æ‰€æœ‰çš„ç‰ŒèƒŒé¢æœä¸‹æ´—åŒ€ã€‚å››äººå›´åæˆæ–¹å½¢ã€‚</li>
                <li>æ¯äººé¢å‰éƒ½è¦æ‘†å‡ºä¸¤å±‚çš„"ç‰Œå±±"ï¼š</li>
                <li class="list-none pl-6">- åº„å®¶ï¼šä¸€å±‚11å¼  Ã— 2æ’ï¼ˆå…±22å¼ ï¼‰</li>
                <li class="list-none pl-6">- å…¶ä½™ä¸‰äººï¼šä¸€å±‚10å¼  Ã— 2æ’ï¼ˆå…±20å¼ ï¼‰</li>
              </ul>
            </div>
            
            <div>
              <h4 class="font-medium text-lg mb-2">3. åˆ†ç‰Œ</h4>
              <ul class="list-disc pl-6 space-y-1">
                <li>ä»åº„å®¶å³è¾¹å¼€å§‹ï¼Œåº„å®¶èµ·é¡ºæ—¶é’ˆæ–¹å‘ï¼Œæ¯æ¬¡ç»™æ¯ä½ç©å®¶å‘2å¼ ç‰Œã€‚</li>
                <li>é™¤åº„å®¶å¤–æ¯äººå…±æ”¶åˆ°8å¼ ç‰Œï¼Œåº„å®¶æ”¶åˆ°9å¼ ç‰Œã€‚</li>
                <li>æ‰€æœ‰ç©å®¶æŠŠæ‰‹ç‰Œç†å¥½ï¼Œä¸è¦è®©åˆ«äººçœ‹åˆ°ã€‚</li>
              </ul>
            </div>
          </div>
        </section>
        
        <hr class="border-gray-200">
        
        <section>
          <h3 class="text-xl font-semibold text-primary mb-3">è·èƒœæ–¹å¼</h3>
          <p class="mb-2">æ¸¸æˆç›®æ ‡æ˜¯é€šè¿‡æ‘¸ç‰Œä¸æ¢ç‰Œï¼Œä½¿è‡ªå·±çš„ 9å¼ æ‰‹ç‰Œ ç»„æˆå¦‚ä¸‹ç‰¹å®šçš„ç‰Œå‹ã€‚</p>
          <div class="space-y-4 pl-4">
            <div>
              <h4 class="font-medium text-lg mb-2">1. äº‹åŠ¡æ‰€ç»„åˆ</h4>
              <p>9å¼ ç‰Œå…¨éƒ¨å±äºåŒä¸€äº‹åŠ¡æ‰€ï¼ˆå«äº‹åŠ¡æ‰€Logoã€ç»„åˆLogoåŠè¯¥äº‹åŠ¡æ‰€æˆå‘˜ï¼‰ã€‚</p>
            </div>
            
            <div>
              <h4 class="font-medium text-lg mb-2">2. Unitç»„åˆ</h4>
              <p>9å¼ ç‰Œç»„æˆã€Œ3+3+3ã€çš„ç»“æ„ã€‚</p>
              <p>æ¯ç»„ä¸‰å¼ ä¸ºä¸€ç»„ï¼ˆç§°ä¸º"ã‚»ãƒƒãƒˆ"ï¼‰ï¼Œ1ã‚»ãƒƒãƒˆå¯ä»¥æ˜¯ï¼š</p>
              <ul class="list-disc pl-6 space-y-1">
                <li>èƒŒæ™¯è‰²ç›¸åŒï¼ˆåŒä¸€ç»„åˆæˆ–åŒ…å«è¯¥ç»„åˆLogoï¼‰</li>
                <li>æˆ– äº‹åŠ¡æ‰€Logo + è¯¥äº‹åŠ¡æ‰€æ‰€å±å¶åƒï¼ˆå›¢ä½“Logoï¼‰</li>
              </ul>
            </div>
          </div>
        </section>
        
        <hr class="border-gray-200">
        
        <section>
          <h3 class="text-xl font-semibold text-primary mb-3">æ¸¸æˆæµç¨‹</h3>
          <div class="space-y-4 pl-4">
            <div>
              <h4 class="font-medium text-lg mb-2">1. ç”±åº„å®¶å…ˆå‡ºç‰Œ</h4>
              <ul class="list-disc pl-6">
                <li>å› ä¸ºåº„å®¶æœ‰9å¼ æ‰‹ç‰Œï¼Œæ‰€ä»¥ç¬¬ä¸€å›åˆè¦å…ˆæ‰“å‡º1å¼ ç‰Œ</li>
              </ul>
            </div>
            
            <div>
              <h4 class="font-medium text-lg mb-2">2. æŒ‰é¡ºæ—¶é’ˆè½®æµæ‘¸ç‰Œä¸å‡ºç‰Œ</h4>
              <ul class="list-disc pl-6">
                <li>ä»åº„å®¶å¼€å§‹ï¼Œæ¯ä½ç©å®¶ä»ç‰Œå±±æ‘¸1å¼ ï¼Œç„¶åå†ä¸¢1å¼ ä¸è¦çš„ç‰Œã€‚</li>
              </ul>
            </div>
            
            <div>
              <h4 class="font-medium text-lg mb-2">3. å¼ƒç‰Œåœº</h4>
              <ul class="list-disc pl-6">
                <li>æ‰€æœ‰æ‰“å‡ºçš„ç‰Œæ”¾åœ¨è‡ªå·±é¢å‰å·¦ä¾§ï¼Œä»é‡Œåˆ°å¤–ä¾æ¬¡æ’åˆ—ã€‚</li>
              </ul>
            </div>
            
            <div>
              <h4 class="font-medium text-lg mb-2">4. å¬ç‰Œ</h4>
              <div>
                <h5 class="font-medium mb-1">â‘  å¬ç‰Œï¼ˆãƒªãƒ¼ãƒï¼‰</h5>
                <ul class="list-disc pl-6">
                  <li>å½“åªå·®ä¸€ç»„å³å¯è·èƒœæ—¶ï¼Œå¯å®£å¸ƒ"ãƒªãƒ¼ãƒï¼"</li>
                </ul>
              </div>
              <div>
                <h5 class="font-medium mb-1">â‘¡ ãƒªãƒ¼ãƒè§„åˆ™</h5>
                <ul class="list-disc pl-6">
                  <li>ä¸¢å‡ºæœ€å1å¼ ä¸è¦çš„ç‰Œåï¼Œå°†è¿™å¼ ç‰Œæ¨ªæ”¾è¡¨ç¤ºå¬ç‰ŒçŠ¶æ€ã€‚</li>
                  <li>å®£å¸ƒãƒªãƒ¼ãƒåï¼Œæ‰‹ç‰Œä¸å¾—æ›´æ¢ï¼Œåªèƒ½ã€æ‘¸ä¸€å¼ ã€å‡ºä¸€å¼ ã€‘ã€‚</li>
                  <li>è‹¥æ‘¸åˆ°æˆ–åˆ«äººæ‰“å‡ºä½ æ‰€ç¼ºçš„é‚£å¼ ç‰Œï¼Œå°±å¯ç«‹å³"ãƒ‰ãƒ³ã‚¸ãƒ£ãƒ©ï¼"ã€‚</li>
                </ul>
              </div>
            </div>
            
            <div>
              <h4 class="font-medium text-lg mb-2">4. å®£å¸ƒ"ãƒ‰ãƒ³ã‚¸ãƒ£ãƒ©ï¼"</h4>
              <ul class="list-disc pl-6">
                <li>å½“ç©å®¶å‡‘é½èƒœåˆ©ç‰Œå‹æ—¶ï¼Œå¤§å–Š"ãƒ‰ãƒ³ã‚¸ãƒ£ãƒ©ï¼"</li>
                <li>ç¿»å¼€è‡ªå·±çš„æ‰‹ç‰Œï¼Œè®©å…¶ä»–ç©å®¶ç¡®è®¤ã€‚</li>
              </ul>
            </div>
          </div>
        </section>
        
        <hr class="border-gray-200">
        
        <section>
          <h3 class="text-xl font-semibold text-primary mb-3">ç‰¹åˆ«è§„åˆ™</h3>
          <div class="space-y-4 pl-4">
            <div>
              <h4 class="font-medium text-lg mb-2">1. ã‚ˆã“ã©ã‚Šï¼ˆæŠ¢ç‰Œï¼‰</h4>
              <ul class="list-disc pl-6">
                <li>å½“ä¸Šå®¶æ‰“å‡ºçš„ç‰Œèƒ½è®©ä½ å®Œæˆä¸€ç»„æ—¶ï¼Œå¯å–Šã‚ˆã“ã©ã‚Šï¼</li>
                <li>æŠŠé‚£å¼ ç‰Œæ‹¿èµ°ï¼Œä¸è‡ªå·±æ‰‹ä¸­2å¼ ç‰Œç»„æˆ1ç»„ï¼Œæ­£é¢æœä¸Šæ”¾åœ¨å³æ‰‹è¾¹ã€‚</li>
                <li>ç„¶åå‡º1å¼ ä¸è¦çš„ç‰Œã€‚æ­¤å±€ä¸å†æ‘¸ç‰Œï¼Œä¿æŒæ‰‹ç‰Œ8å¼ ã€‚</li>
              </ul>
            </div>
            
            <div>
              <h4 class="font-medium text-lg mb-2">2. ç‰¹æ®Šç‰Œ</h4>
              <ul class="list-disc pl-6">
                <li>NPCç‰Œå¸¦æœ‰ç‰¹æ®Šæ•ˆæœï¼Œæ‰“å‡ºè¯¥ç‰Œæ—¶ï¼Œå¯ä»¥å‘åŠ¨å¯¹åº”çš„ç‰¹æ®Šèƒ½åŠ›ï¼Œå…·ä½“å¦‚ä¸‹ï¼šï¼ˆç©å®¶å¯è‡ªç”±å†³å®šæ˜¯å¦åŠ å…¥è¯¥åŠŸèƒ½ï¼‰</li>
                <li>ä½è´ºç¾é˜µï¼šé€‰æ‹©ä¸€åå…¶ä»–ç©å®¶ï¼Œè®©è¯¥ç©å®¶ä¸‹ä¸€å›åˆä¼‘æ¯</li>
                <li>é—¨ç« è‡£ï¼šå¯ä»¥æŠŠè‡ªå·±ä¸€å¼ æ‰“å‡ºçš„ç‰Œä¸æ‰‹æŒçš„ä¸€å¼ ç‰Œäº¤æ¢</li>
                <li>å†°é¹°è¯šçŸ¢ï¼šä¸‹ä¸€å›åˆå¯ç¿»é¢ï¼ˆä¸å…¬å¸ƒæ˜¯ä»€ä¹ˆï¼‰æ‰“å‡ºä¸€å¼ ç‰Œï¼Œä¸”è¿™å¼ ç‰Œä¸èƒ½è¢«å¤ºèµ°ï¼ˆåƒï¼‰</li>
                <li>å®ˆé—¨äººï¼šæŒ‡å®šä¸€åç©å®¶ï¼Œç›²é€‰è¯¥ç©å®¶çš„ä¸¤å¼ æ‰‹ç‰Œå’Œè¯¥ç©å®¶æ‰“å‡ºçš„ä¸¤å¼ ç‰Œäº¤æ¢</li>
                <li>é»‘æ ¹ï¼šè‡ªå·±é€‰æ‹©æœ€å¤šä¸‰å¼ æ‰‹ç‰Œæ‰“å‡ºï¼Œå¹¶å†åœ¨ç‰Œå±±ä¸­æ‘¸ç‰Œï¼Œç›´åˆ°æ‰‹ç‰Œæ‘¸æ»¡8å¼ </li>
                <li>NicePï¼šå¯ä»¥ä»æ‰€æœ‰ç©å®¶æ‰“å‡ºçš„ç‰Œä¸­é€‰æ‹©ä¸€å¼ ç‰Œä¸è‡ªå·±çš„ç‰Œäº¤æ¢</li>
                <li>å°åŠ¨ç‰©ç‰Œï¼šæŠŠè‡ªå·±çš„ä¸€å¼ æ‰‹ç‰Œå˜æˆä¸‡èƒ½ç‰Œ</li>
              </ul>
            </div>
          </div>
        </section>
      </div>
      
      <div class="mt-8 text-center">
        <button id="confirm-rules-btn" class="bg-primary hover:bg-primary/90 text-white font-medium px-6 py-2 rounded-lg transition-all">
          æˆ‘çŸ¥é“äº†
        </button>
      </div>
    </div>
  </div>
  
  <!-- æ¸¸æˆè§„åˆ™æ¨¡æ€æ¡† -->
  <div id="rules-modal" class="fixed inset-0 z-50 flex items-center justify-center hidden">
    <div class="absolute inset-0 bg-black/50" id="modal-backdrop"></div>
    <div class="relative bg-white rounded-xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto p-6 animate-fade-in">
      <div class="flex justify-between items-start mb-4">
        <h2 class="text-2xl font-bold text-gray-800">æ¸¸æˆè§„åˆ™</h2>
        <button id="close-rules-modal" class="text-gray-500 hover:text-gray-700 text-xl">
          <i class="fa fa-times"></i>
        </button>
      </div>
      
      <!-- æ¸¸æˆè§„åˆ™å†…å®¹ -->
      <div class="space-y-6">
        <div>
          <h3 class="text-xl font-semibold text-gray-700 mb-3">å¼€å§‹å‰çš„å‡†å¤‡</h3>
          <ul class="list-disc pl-6 space-y-2 text-gray-600">
            <li><strong>å†³å®šåº„å®¶ï¼š</strong>é€šè¿‡æ·éª°å­å†³å®šåˆå§‹åº„å®¶ï¼Œä¹‹åæ¯å±€è½®æ¢</li>
            <li><strong>æ‘†ç‰Œï¼š</strong>å°†144å¼ éº»å°†ç‰ŒæŒ‰ç…§ç‰¹å®šè§„åˆ™æ‘†æ”¾æˆå±±å½¢</li>
            <li><strong>åˆ†ç‰Œï¼š</strong>æ¯ä½ç©å®¶å¼€å§‹æ—¶è·å¾—13å¼ æ‰‹ç‰Œ</li>
          </ul>
        </div>
        
        <div>
          <h3 class="text-xl font-semibold text-gray-700 mb-3">è·èƒœæ–¹å¼</h3>
          <ul class="list-disc pl-6 space-y-2 text-gray-600">
            <li><strong>äº‹åŠ¡æ‰€ç»„åˆï¼š</strong>å‡‘é½åŒäº‹åŠ¡æ‰€çš„ç‰¹å®šè§’è‰²ç»„åˆ</li>
            <li><strong>Unitç»„åˆï¼š</strong>å‡‘é½åŒUnitçš„ç‰¹å®šè§’è‰²ç»„åˆ</li>
          </ul>
        </div>
        
        <div>
          <h3 class="text-xl font-semibold text-gray-700 mb-3">æ¸¸æˆæµç¨‹</h3>
          <ul class="list-disc pl-6 space-y-2 text-gray-600">
            <li><strong>å‡ºç‰Œï¼š</strong>ç©å®¶è½®æµå‡ºä¸€å¼ æ‰‹ç‰Œåˆ°ç‰Œæ± </li>
            <li><strong>æ‘¸ç‰Œï¼š</strong>ä»ç‰Œå±±æ‘¸ä¸€å¼ ç‰Œè¡¥å……æ‰‹ç‰Œ</li>
            <li><strong>å¬ç‰Œï¼š</strong>æ‰‹ç‰Œæ¥è¿‘èƒ¡ç‰ŒçŠ¶æ€æ—¶å¯å®£å¸ƒå¬ç‰Œ</li>
            <li><strong>å®£å¸ƒèƒœåˆ©ï¼š</strong>å½“æ‰‹ç‰Œæ»¡è¶³èƒ¡ç‰Œæ¡ä»¶æ—¶å®£å¸ƒèƒœåˆ©</li>
          </ul>
        </div>
        
        <div>
          <h3 class="text-xl font-semibold text-gray-700 mb-3">ç‰¹åˆ«è§„åˆ™</h3>
          <ul class="list-disc pl-6 space-y-2 text-gray-600">
            <li><strong>æŠ¢ç‰Œï¼š</strong>ç‰¹å®šæƒ…å†µä¸‹å¯ä»¥æŠ¢å…¶ä»–ç©å®¶æ‰“å‡ºçš„ç‰Œ</li>
            <li><strong>ç‰¹æ®Šç‰Œæ•ˆæœï¼š</strong>æŸäº›è§’è‰²ç‰Œå…·æœ‰ç‰¹æ®Šæ•ˆæœï¼Œä¼šå½±å“æ¸¸æˆè¿›ç¨‹</li>
          </ul>
        </div>
      </div>
      
      <div class="mt-6 text-center">
        <button id="confirm-rules-btn" class="bg-primary hover:bg-primary/90 text-white font-medium px-6 py-2 rounded-lg transition-all">
          æˆ‘çŸ¥é“äº†
        </button>
      </div>
    </div>
  </div>

  <script>
    // æ¸¸æˆè§„åˆ™æ¨¡æ€æ¡†æ§åˆ¶
    document.addEventListener('DOMContentLoaded', function() {
      const rulesBtn = document.getElementById('rule-btn'); // ä¿®æ­£IDä¸ºrule-btn
      const rulesModal = document.getElementById('rules-modal');
      const closeRulesModal = document.getElementById('close-rules-modal');
      const confirmRulesBtn = document.getElementById('confirm-rules-btn');
      const modalBackdrop = document.getElementById('modal-backdrop');
      
      // æ˜¾ç¤ºè§„åˆ™æ¨¡æ€æ¡†
      rulesBtn.addEventListener('click', function() {
        rulesModal.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
      });
      
      // éšè—è§„åˆ™æ¨¡æ€æ¡†
      function hideRulesModal() {
        rulesModal.classList.add('hidden');
        document.body.style.overflow = 'auto';
      }
      
      closeRulesModal.addEventListener('click', hideRulesModal);
      confirmRulesBtn.addEventListener('click', hideRulesModal);
      modalBackdrop.addEventListener('click', hideRulesModal);
      
      // ESCé”®å…³é—­æ¨¡æ€æ¡†
      document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape' && !rulesModal.classList.contains('hidden')) {
          hideRulesModal();
        }
      });
    });
  </script>

  <script>
  // æ³¨å†ŒService Worker
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('./service-worker.js')
        .then(registration => {
          console.log('ServiceWorker æ³¨å†ŒæˆåŠŸ:', registration.scope);
        })
        .catch(error => {
          console.log('ServiceWorker æ³¨å†Œå¤±è´¥:', error);
        });
    });
  }
</script>
</body>
</html>